{"version":3,"sources":["main/styles/GlobalStyles.tsx","main/styles/Normalize.tsx","features/layout/LayoutActionType.ts","features/layout/LayoutReducer.ts","main/style.tsx","main/useDispatch.ts","features/authentication/Login/Login.style.tsx","features/authentication/authenticationModel.ts","features/joinedConversations/joinedConversationModel.ts","features/users/userModel.ts","features/authentication/Login/Login.tsx","features/authentication/loginCommand.ts","features/chat/Chat/ChatUI.style.tsx","features/layout/Selectors.ts","features/currentConversation/currentConversationModel.ts","features/conversations/conversationModel.ts","foundations/components/icons/AddIcon.tsx","features/joinedConversations/ConversationItem/ConversationItem.style.tsx","foundations/components/icons/LeaveIcon.tsx","foundations/utilities/getUniqueColor.tsx","foundations/hooks/useMediaQuery.ts","features/joinedConversations/ConversationItem/ConversationItem.tsx","foundations/hooks/useHover.ts","features/joinedConversations/MyConversations/MyConversations.style.tsx","features/conversationMembers/conversationMemberModel.ts","features/memberPresence/memberPresenceModel.ts","foundations/components/UserInitialsAvatar.tsx","features/userDetail/userDetailModel.ts","features/layout/LayoutActions.ts","features/conversationMembers/MemberDescription/MemberDescription.style.tsx","features/conversationMembers/MemberDescription/MemberDescription.tsx","foundations/components/icons/CrossIcon.tsx","features/conversationMembers/ConversationMembers/ConversationMembers.style.tsx","foundations/components/icons/PeopleGroupIcon.tsx","features/currentConversation/ConversationOccupancy/ConversationOccupancy.style.tsx","features/currentConversation/ConversationOccupancy/ConversationOccupancy.tsx","features/currentConversation/Header/Header.style.tsx","foundations/components/icons/BackIcon.tsx","features/currentConversation/Header/Header.tsx","features/conversationMembers/ConversationMembers/ConversationMembers.tsx","features/joinedConversations/MyConversations/MyConversations.tsx","features/joinedConversations/leaveConversationCommand.ts","features/chat/Menu/Menu.style.tsx","foundations/components/icons/LogoIcon.tsx","foundations/components/icons/PresenceIndicatorIcon.tsx","features/currentUser/NetworkStatus/NetworkStatus.style.tsx","features/currentUser/NetworkStatus/NetworkStatus.tsx","features/currentUser/MyUserDetails/MyUserDetails.style.tsx","features/currentUser/MyUserDetails/MyUserDetails.tsx","foundations/components/Branding.tsx","features/messages/messageModel.ts","features/chat/Menu/Menu.tsx","features/currentConversation/CurrentConversation/CurrentConversation.style.tsx","features/currentConversation/MessageListItem/MessageListItem.style.tsx","features/messages/TextMessageDisplay/TextMessageDisplay.style.tsx","features/messages/TextMessageDisplay/TextMessageDisplay.tsx","features/messages/RtcMessageDisplay/RtcMessageDisplay.style.tsx","features/typingIndicator/typingIndicatorModel.ts","features/messages/RtcMessageDisplay/RtcMessageDisplay.tsx","features/messages/MessageDisplay/MessageDisplay.tsx","features/currentConversation/MessageListItem/MessageListItem.tsx","foundations/utilities/convertTimestampToTime.tsx","features/currentConversation/MessageList/MessageList.style.tsx","features/currentConversation/MessageList/WelcomeMessage.tsx","features/currentConversation/MessageList/MessageList.tsx","features/joinedConversations/DraftsModel.ts","features/typingIndicator/sendTypingIndicator.ts","foundations/hooks/useClickOutside.ts","foundations/components/icons/FunnyEmojiIcon.tsx","features/emoji/EmojiInput/EmojiInput.style.tsx","features/emoji/EmojiInput/EmojiInput.tsx","features/emoji/EmojiSuggestion/EmojiSuggestion.style.tsx","features/emoji/EmojiSuggestion/EmojiSuggestion.tsx","features/messages/TextMessageEditor/TextMessageEditor.style.tsx","features/messages/draft.ts","foundations/components/icons/SendIcon.tsx","features/messages/TextMessageEditor/TextMessageEditor.tsx","features/messages/MessageEditor/MessageEditor.style.tsx","features/messages/MessageEditor/MessageEditor.tsx","features/currentConversation/MessageInput/MessageInput.style.tsx","features/rtc/RtcCallState.enum.ts","features/rtc/RtcCallType.enum.ts","features/currentConversation/MessageInput/MessageInput.tsx","features/messages/sendMessage.ts","features/joinedConversations/discardMessageDraftCommand.ts","features/joinedConversations/updateMessageDraftCommand.ts","features/typingIndicator/TypingIndicatorDisplay/TypingIndicatorDisplay.style.tsx","features/typingIndicator/TypingIndicatorDisplay/TypingIndicatorDisplay.tsx","features/currentConversation/CurrentConversation/CurrentConversation.tsx","features/joinedConversations/ConversationDescription/ConversationDescription.style.tsx","features/joinedConversations/ConversationDescription/ConversationDescription.tsx","features/joinedConversations/JoinConversationDialog/JoinConversationDialog.style.tsx","foundations/components/Modal.tsx","features/joinedConversations/JoinConversationDialog/JoinConversationDialog.tsx","features/joinedConversations/joinConversationCommand.ts","features/userDetail/UserDetailDialog/UserDetailDialog.style.tsx","features/rtc/RtcModel.ts","features/rtc/RtcCallSignalType.enum.ts","features/rtc/RtcIceSignalType.enum.ts","features/userDetail/UserDetailDialog/UserDetailDialog.tsx","features/rtc/RtcDisplay/RtcDisplay.style.tsx","features/rtc/RtcConnection.ts","features/rtc/RtcSignaling.ts","features/rtc/RtcDisplay/RtcDisplay.tsx","features/chat/Chat/Chat.tsx","foundations/utilities/isPubNubConfigured.tsx","main/styles/ErrorBanner.style.tsx","main/Router.tsx","main/Theme.ts","features/currentUser/networkStatusModel.ts","main/rootReducer.ts","main/preloadedState.ts","main/store.ts","main/App.tsx","main/serviceWorker.ts","index.tsx","features/authentication/Login/background.png","features/authentication/Login/logo.svg","features/authentication/Login/screenshot.png"],"names":["GlobalStyles","createGlobalStyle","theme","fonts","app","fontWeights","regular","space","LayoutActionType","View","Normalize","Wrapper","styled","div","useDispatch","OriginalUseDispatch","mediaQueries","medium","image","Body","Promo","radii","strong","large","TagLine","h1","colors","onPrimary","light","Screenshot","Content","backgrounds","panel","content","square","LoginForm","Logo","img","Label","importantText","Field","input","borders","borderLight","Button","button","none","activeText","initialState","isLoggingIn","getAuthenticationStateSlice","state","authentication","getLoggedInUserId","createSelector","authenticationState","invariant","undefined","loggedInUserId","isUserLoggedIn","getConversationsByUserId","joinedConversations","conversations","byId","JoinedConversationsStateReducer","createMembershipReducer","UsersReducer","createUserReducer","getUsersById","users","Login","dispatch","loggingIn","useSelector","loggedIn","useContext","ThemeContext","usersById","useState","userId","setUserId","user","loginWithRandomlyPickedUser","randomUserId","KnownIds","Math","floor","random","length","getState","context","type","pubnub","api","setUUID","isLoginSuccessful","fetchUserById","then","subscribe","channels","withPresence","fetchMemberships","include","spaceFields","customSpaceFields","customFields","totalCount","conversationChannels","map","membership","id","Promise","all","payload","login","custom","tagLine","alt","src","screenshot","logo","readOnly","value","name","toLowerCase","replace","onClick","views","CurrentConversation","viewDisplayed","view","viewHidden","filter","item","getLayoutSlice","layout","getViews","getViewStates","Menu","includes","ConversationMembers","JoinConversation","UserDetail","Rtc","DEFAULT_CONVERSATION","DefaultConversation","conversationId","focusOnConversation","target","currentConversationId","getCurrentConversationId","currentConversation","conversationStateReducer","combineReducers","createSpaceReducer","allConversations","createSpaceListReducer","getConversationsById","getAllConversations","spaces","allSpaces","spaceIds","AddIcon","title","width","height","transform","fill","fillRule","stroke","cx","cy","r","d","strokeLinecap","strokeLinejoin","sizes","emphasized","black","fontSizes","selected","primaryActive","primaryHover","Name","MessageCount","span","IconWrapper","ConversationIcon","selectedText","color","LeaveIcon","getUniqueColor","string","colorSet","modulo","hash","i","charCodeAt","getNumericHash","useMediaQuery","mediaQuery","parsedQuery","match","mediaQueryList","window","matchMedia","matches","setValue","useEffect","mediaQueryListener","addListener","removeListener","ConversationItem","onLeave","unreadMessageCount","mouseEnterTimer","mouseOutTimer","mouseEnterDelayMS","mouseLeaveDelayMS","isHovering","setIsHovering","onMouseEnter","clearTimeout","setTimeout","onMouseLeave","useHover","hoverProps","currentUserId","canLeave","isTouch","touch","avatars","e","stopPropagation","ConversationList","Title","AddButton","getUsersByConversationId","conversationMembers","ConversationMembersStateReducer","createMembersReducer","MemberPresenceReducer","createPresenceReducer","getPresenceByConversationId","memberPresence","presence","round","props","size","avatarText","UserInitialsAvatar","muted","initials","uniqueColor","selectUser","selectedUserId","getSelectedUserId","userDetail","userDetailViewDisplayed","USER_DETAIL_VIEW_DISPLAYED","rtcViewDisplayed","RTC_VIEW_DISPLAYED","currentConversationViewDisplayed","CURRENT_CONVERSATION_VIEW_DISPLAYED","menuViewHidden","MENU_VIEW_HIDDEN","joinConversationViewHidden","JOIN_CONVERSATION_VIEW_HIDDEN","conversationMembersViewHidden","CONVERSATION_MEMBERS_VIEW_HIDDEN","panelHover","PresenceDot","success","inactive","Avatar","About","UserName","UserTitle","normalText","MemberDescription","you","CrossIcon","strokeWidth","motion","section","Controls","Header","Details","Channel","CloseIcon","ScrollableView","getAnimatedWrapperVariants","isMedium","open","x","display","closed","transitionEnd","PeopleGroupIcon","active","highlighted","OccupancyNumber","getCurrentConversationOccupancy","conversationMemberships","conversationPresence","members","joinedCount","presentCount","occupancy","ConversationOccupancy","isConversationMembersLayoutVisible","CONVERSATION_MEMBERS_VIEW_DISPLAYED","BackIconWrapper","Border","neutral","Information","Description","BackIcon","getCurrentConversationDescription","conversation","MENU_VIEW_DISPLAYED","description","getCurrentConversationMembers","occupants","occupant","uuid","usePubNub","conversationColor","fetchMembers","spaceId","userFields","customUserFields","fetchHereNow","animate","variants","transition","ease","duration","sort","userA","userB","orderByPresence","key","getJoinedConversations","userConversations","MyConversations","conversationsById","fetchSpaces","JOIN_CONVERSATION_VIEW_DISPLAYED","resolve","leaveSpaces","unsubscribe","primary","LogoIcon","viewBox","y","rx","PresenceIndicatorIcon","NetworkStatus","isConnected","networkStatus","MyUserDetails","MessageType","CompanyName","Branding","companyName","useRef","ref","animatedWrapperVariants","contentHover","small","message","messageText","SenderName","showDetails","TimeSent","shadows","TextMessageDisplay","text","TypingIndicatorType","TypingIndicatorActionType","MessageStateReducer","createMessageReducer","getMessagesById","messages","RtcMessageDisplay","RtcIce","iceSignalType","JSON","stringify","senderId","callSignalType","startTime","MessageDisplay","Text","RtcCall","MessageListItem","messageFragment","avatar","sender","hasSender","ts","date","Date","parseInt","minutes","getMinutes","getHours","convertTimestampToTime","timetoken","WelcomeMessage","welcomeMessage","split","token","charAt","toUpperCase","slice","join","welcome","getCurrentConversationMessages","Object","values","channel","String","MessageList","conversationsScrollPositions","setConversationsScrollPositions","memoizedRestoreConversationScrollPositionCallback","useCallback","conversationScrollPosition","wrapper","current","scrollTo","document","createElement","el","scrollToBottom","scrollTop","scrollHeight","clientHeight","hasReachedBottom","onScroll","scrollPosition","updateCurrentConversationScrollPosition","messageDraftById","getMessageDrafts","drafts","sendTypingIndicator","typingIndicatorType","sendSignal","isTarget","event","contains","useClickOutside","onclick","handleClick","click","condition","reduce","conditionAlreadyMet","addEventListener","removeEventListener","FunnyEmojiIcon","Dialog","EmojiButton","EmojiInput","onSelection","showPicker","setPickerState","picker","dismissPicker","emoji","native","onSelect","darkMode","dark","Popup","Suggestions","Heading","EmojiSearchTerm","bold","Results","Result","Emoji","Colons","EmojiSuggestion","suggestions","displayed","emojiSearchTerm","search","colons","emojiIndex","emojis","results","getEmojiSearchTerm","getEmojisFromEmojiSearchTerm","txt","replaceEmoji","Container","TextArea","textarea","messageTextInput","SendButton","isDraftModified","SendIcon","strokeMiterlimit","autoExpand","style","cssText","newTextDraft","draft","newText","TextMessageEditor","sendDraft","updateDraft","textareaRef","emojiInserted","messageWithEmoji","focus","rows","onChange","onKeyPress","shiftKey","preventDefault","placeholder","messageEditor","borderDark","MessageEditor","RtcCallState","RtcCallType","signalReducer","createSignalReducer","defaultState","removeTypingIndicator","newState","signal","publisher","getTypingIndicatorsById","typingIndicators","typingIndicatorRemovedAll","REMOVE_TYPING_INDICATOR_ALL","createTypingIndicatorsListener","ShowTypingIndicator","REMOVE_TYPING_INDICATOR","typingIndicatorRemoved","TYPING_INDICATOR_DURATION_SECONDS","HideTypingIndicator","action","PresenceCategory","LEAVE","TIMEOUT","getConversationMessageDraft","MessageInput","storedDraft","defaultDraft","appMessage","sendPubnubMessage","sendMessage","discardMessageDraft","newDraft","updateMessageDraft","getCurrentConversationTypingIndicators","typingIndicator","grouped","now","TypingIndicatorDisplay","ConversationDescription","ScrollView","CloseButton","Overlay","Modal","getAnimatedModalVariants","getJoinableConversations","conv","JoinConversationDialog","joinSpaces","joinConversation","Call","RtcCallSignalType","RtcIceSignalType","currentCall","callType","NONE","callState","peerUserId","lastIncomingCall","callLog","incomingCallReceived","outgoingCallAccepted","callDeclined","endTime","callCanceled","callCompleted","getCurrentCall","rtc","UserDetailDialog","presenceByConversationId","userName","present","USER_DETAIL_VIEW_HIDDEN","getTime","VideoWrapper","LocalVideoWrapper","RemoteVideoWrapper","MyVideo","video","RemoteVideo","CallStatus","ICE_CONFIG","RtcSettings","rtcIceConfig","peerConnection","RTCPeerConnection","userMediaStream","userMediaClones","inboundStream","negotiatingOffer","negotiatingAnswer","iceCandidates","iceCandidateHandler","candidate","console","log","negotiationNeededHandler","trackHandler","connectionStateHandler","iceConnectionStateHandler","createPeerConnection","a","connectionState","close","disconnectMedia","iceServers","onicecandidate","onnegotiationneeded","ontrack","onconnectionstatechange","onicegatheringstatechange","iceGatheringState","oniceconnectionstatechange","iceConnectionState","onsignalingstatechange","signalingState","connectMedia","constraints","audio","navigator","mediaDevices","getUserMedia","exact","stream","push","clone","forEach","getTracks","track","stop","sendMedia","addTrack","createIceOffer","createOffer","offer","setLocalDescription","localDescription","negotiateIceOffer","createIceAnswer","createAnswer","answer","setRemoteDescription","addIceCandidate","remoteDescription","DIALING_TIMEOUT_SECONDS","rtcDialingTimeoutSeconds","negotingOffer","pendingOutgoingCalls","pendingIncomingCalls","onCallIncoming","callerId","onCallAccepted","onCallEnded","onCallTimeout","onIceCandidate","onIceOffer","onIceAnswer","pubnubIceListener","init","handleCallMessage","handleIceMessage","callMessage","INITIATE","callKey","peerId","callValue","ACCEPT","END","callValueIncoming","callValueOutgoing","iceMessage","CANDIDATE","OFFER","ANSWER","dispatchSignalingMessage","signaling","setHandlers","callInit","myId","callAccept","callEnd","iceCandidate","iceOffer","iceAnswer","getLastCallMessage","userMessages","RtcDisplay","setVideo","setAudio","dialed","setDialed","peerAnswered","setPeerAnswered","incoming","setIncoming","answered","setAnswered","lastCallMessage","releaseMedia","disableLocalMedia","disableRemoteMedia","callPeer","mediaStream","querySelector","srcObject","answerCall","updateCallStatus","cancel","CONNECTED","ACCEPTED","INITIATED","RECEIVING","endCall","closeMedia","OUTGOING","INCOMING","handler","disableAudio","disableVideo","disableRemoteVideo","disableRemoteAudio","enableVideo","mediaConstraints","enableAudio","updateMedia","stopRing","closeCall","RTC_VIEW_HIDDEN","pause","play","setNegotiationNeededHandler","setTrackHandler","remoteVideo","onunmute","streams","setConnectionStateHandler","setIceConnectionStateHandler","unlocked","body","audioElem","currentTime","disabled","autoPlay","playsInline","preload","loop","COMPLETED","CANCELED","DECLINED","NOT_ANSWERED","ChatUI","isPubNubConfigured","keyConfiguration","publishKey","subscribeKey","ErrorBanner","error","ErrorBannerComponent","ApplicationRouter","breakpoints","fontSizesAliases","fontWeightsAliases","colorAliases","radiiAliases","borderWidths","borderStyles","bordersAliases","appTheme","NetworkStatusReducer","createNetworkStatusReducer","rootReducer","CURRENT_CONVERSATION_VIEW_HIDDEN","SignalActionType","SIGNAL_RECEIVED","MessageActionType","MESSAGE_RECEIVED","newCall","acceptedCall","connectedCall","preloadedState","composeEnhancers","compose","pubnubConfig","assign","restore","heartbeatInterval","Pubnub","store","thunkContext","storeEnhancer","applyMiddleware","ReduxThunk","withExtraArgument","createStore","createAppStore","leaveApplication","unsubscribeAll","App","createPubNubListener","client","Boolean","location","hostname","ReactDOM","render","getElementById","serviceWorker","ready","registration","unregister","module","exports"],"mappings":"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","file":"static/js/main.65e776df.chunk.js","sourcesContent":["import { createGlobalStyle } from \"styled-components\";\nimport { Theme } from \"../Theme\";\n\nconst GlobalStyles = createGlobalStyle<{ theme: Theme }>`\n body {\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  margin: ${({ theme }) => theme.space[0]};\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n* {\n  box-sizing: border-box;\n}\nbody,\nhtml,\n#root {\n  height: 100%;\n}\n`;\n\nexport default GlobalStyles;\n","import { createGlobalStyle } from \"styled-components\";\n\nconst Normalize = createGlobalStyle`\n\n//! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css\nhtml{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}\n//# sourceMappingURL=normalize.min.css.map\n      \n`;\n\nexport default Normalize;\n","export enum LayoutActionType {\n  MENU_VIEW_DISPLAYED = \"pubnub/MENU_VIEW_DISPLAYED\",\n  MENU_VIEW_HIDDEN = \"pubnub/MENU_VIEW_HIDDEN\",\n  CURRENT_CONVERSATION_VIEW_DISPLAYED = \"pubnub/CURRENT_CONVERSATION_VIEW_DISPLAYED\",\n  CURRENT_CONVERSATION_VIEW_HIDDEN = \"pubnub/CURRENT_CONVERSATION_VIEW_HIDDEN\",\n  CONVERSATION_MEMBERS_VIEW_DISPLAYED = \"pubnub/CONVERSATION_MEMBERS_VIEW_DISPLAYED\",\n  CONVERSATION_MEMBERS_VIEW_HIDDEN = \"pubnub/CONVERSATION_MEMBERS_VIEW_HIDDEN\",\n  JOIN_CONVERSATION_VIEW_DISPLAYED = \"pubnub/JOIN_CONVERSATION_VIEW_DISPLAYED\",\n  JOIN_CONVERSATION_VIEW_HIDDEN = \"pubnub/JOIN_CONVERSATION_VIEW_HIDDEN\",\n  USER_DETAIL_VIEW_DISPLAYED = \"pubnub/USER_DETAIL_VIEW_DISPLAYED\",\n  USER_DETAIL_VIEW_HIDDEN = \"pubnub/USER_DETAIL_VIEW_HIDDEN\",\n  RTC_VIEW_DISPLAYED = \"pubnub/RTC_VIEW_DISPLAYED\",\n  RTC_VIEW_HIDDEN = \"pubnub/RTC_VIEW_HIDDEN\"\n}\n","import { LayoutActions } from \"./LayoutActions\";\nimport { LayoutActionType } from \"./LayoutActionType\";\n\nexport enum View {\n  Menu,\n  CurrentConversation,\n  ConversationMembers,\n  JoinConversation,\n  UserDetail,\n  Rtc\n}\n\ninterface LayoutState {\n  views: View[];\n}\n\nconst initialState: LayoutState = {\n  views: [View.CurrentConversation]\n};\n\nconst viewDisplayed = (state: LayoutState, view: View): LayoutState => {\n  return { ...state, views: [...state.views, view] };\n};\n\nconst viewHidden = (state: LayoutState, view: View): LayoutState => {\n  return { ...state, views: state.views.filter(item => item !== view) };\n};\n\nconst LayoutStateReducer = (\n  state: LayoutState = initialState,\n  action: LayoutActions\n): LayoutState => {\n  switch (action.type) {\n    case LayoutActionType.MENU_VIEW_DISPLAYED:\n      return viewDisplayed(state, View.Menu);\n    case LayoutActionType.MENU_VIEW_HIDDEN:\n      return viewHidden(state, View.Menu);\n    case LayoutActionType.CURRENT_CONVERSATION_VIEW_DISPLAYED:\n      return viewDisplayed(state, View.CurrentConversation);\n    case LayoutActionType.CURRENT_CONVERSATION_VIEW_HIDDEN:\n      return viewHidden(state, View.CurrentConversation);\n    case LayoutActionType.CONVERSATION_MEMBERS_VIEW_DISPLAYED:\n      return viewDisplayed(state, View.ConversationMembers);\n    case LayoutActionType.CONVERSATION_MEMBERS_VIEW_HIDDEN:\n      return viewHidden(state, View.ConversationMembers);\n    case LayoutActionType.JOIN_CONVERSATION_VIEW_DISPLAYED:\n      return viewDisplayed(state, View.JoinConversation);\n    case LayoutActionType.JOIN_CONVERSATION_VIEW_HIDDEN:\n      return viewHidden(state, View.JoinConversation);\n    case LayoutActionType.USER_DETAIL_VIEW_DISPLAYED:\n      return viewDisplayed(state, View.UserDetail);\n    case LayoutActionType.USER_DETAIL_VIEW_HIDDEN:\n      return viewHidden(state, View.UserDetail);\n    case LayoutActionType.RTC_VIEW_DISPLAYED:\n      return viewDisplayed(state, View.Rtc);\n    case LayoutActionType.RTC_VIEW_HIDDEN:\n      return viewHidden(state, View.Rtc);\n  }\n  return state;\n};\n\nexport { LayoutStateReducer };\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  text-align: left;\n  display: flex;\n  height: 100%;\n  flex-direction: column;\n`;\n","import { useDispatch as OriginalUseDispatch } from \"react-redux\";\nimport { AppDispatch } from \"./storeTypes\";\n\n// Redefine useDispatch to only allow dispatching actions this\n// application's store expects to receive;\n// Fixes a Bug in react-redux 7.1.1 return value that will not\n// allow chaining promises.\n\nconst useDispatch: () => AppDispatch = OriginalUseDispatch;\n\nexport { useDispatch };\n","import styled from \"styled-components/macro\";\nimport image from \"./background.png\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  width: 100%;\n  height: 100%;\n\n  ${({ theme }) => theme.mediaQueries.medium} {\n    background: url(${image});\n    background-size: cover;\n    background-position: center center;\n    padding: 10% 15%;\n  }\n`;\n\nexport const Body = styled.div`\n  flex-grow: 1;\n  display: flex;\n  flex-direction: row;\n`;\n\nexport const Promo = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-end;\n  background: linear-gradient(\n    180deg,\n    rgba(240, 42, 42, 0.670214) 0%,\n    rgba(138, 42, 225, 0.55153) 100%\n  );\n  max-width: 360px;\n  border-top-left-radius: ${({ theme }) => theme.radii.strong};\n  border-bottom-left-radius: ${({ theme }) => theme.radii.strong};\n  display: none;\n\n  ${({ theme }) => theme.mediaQueries.large} {\n    display: flex;\n  }\n`;\n\nexport const TagLine = styled.h1`\n  color: ${({ theme }) => theme.colors.onPrimary};\n  font-size: 24px;\n  font-weight: ${({ theme }) => theme.fontWeights.light};\n  margin: 0px;\n  text-align: center;\n  padding: 20px 50px;\n`;\n\nexport const Screenshot = styled.div`\n  display: flex;\n  justify-content: center;\n`;\n\nexport const Content = styled.div`\n  background: ${({ theme }) => theme.backgrounds.panel};\n  flex-grow: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-top-right-radius: ${({ theme }) => theme.radii.strong};\n  border-bottom-right-radius: ${({ theme }) => theme.radii.strong};\n  border-top-left-radius: ${({ theme }) => theme.radii.strong};\n  border-bottom-left-radius: ${({ theme }) => theme.radii.strong};\n  background: ${({ theme }) => theme.backgrounds.content};\n\n  ${({ theme }) => theme.mediaQueries.large} {\n    border-top-left-radius: ${({ theme }) => theme.radii.square};\n    border-bottom-left-radius: ${({ theme }) => theme.radii.square};\n  }\n`;\n\nexport const LoginForm = styled.div`\n  width: 300px;\n  display: flex;\n  flex-direction: column;\n  font-size: 14px;\n  font-family: ${({ theme }) => theme.fonts.app};\n`;\n\nexport const Logo = styled.img`\n  height: 30px;\n`;\n\nexport const Label = styled.div`\n  color: ${({ theme }) => theme.colors.importantText};\n  padding-bottom: ${({ theme }) => theme.space[1]};\n  padding-top: ${({ theme }) => theme.space[6]};\n`;\n\nexport const Field = styled.input`\n  height: 42px;\n  color: ${({ theme }) => theme.colors.importantText};\n  border-radius: ${({ theme }) => theme.radii.light};\n  border: ${({ theme }) =>\n    `${theme.borders.light} ${theme.colors.borderLight}`};\n  padding: ${({ theme }) => `0 ${theme.space[3]}`};\n  background: ${({ theme }) => theme.backgrounds.content};\n\n  &[type=\"password\"] {\n    letter-spacing: 8px;\n    font-size: 24px;\n  }\n\n  :read-only:focus {\n    outline: none;\n  }\n`;\n\nexport const Button = styled.button`\n  align-self: center;\n  cursor: pointer;\n  border-radius: ${({ theme }) => theme.radii.light};\n  border: ${({ theme }) => theme.borders.none};\n  margin-top: ${({ theme }) => theme.space[8]};\n  padding: ${({ theme }) => `${theme.space[3]} ${theme.space[0]}`};\n  width: 100%;\n  height: 42px;\n  color: ${({ theme }) => theme.colors.activeText};\n  background: linear-gradient(155deg, #e12a66 0%, #5c0ce1 100%);\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  &:focus {\n    outline: none;\n  }\n`;\n","import { createSelector } from \"reselect\";\nimport invariant from \"invariant\";\nimport { AppState } from \"main/storeTypes\";\nimport { AppActions } from \"main/AppActions\";\n\nexport const LOGGING_IN = \"LOGGIN_IN\";\nexport const LOGIN_SUCCEEDED = \"LOGIN_SUCCEEDED\";\n\nexport interface logingInAction {\n  type: typeof LOGGING_IN;\n}\n\nexport const loggingIn = (): logingInAction => ({\n  type: LOGGING_IN\n});\n\ntype loginSucceededPayloadType = {\n  loggedInUserId?: string;\n};\n\nexport interface loginSucceededAction {\n  type: typeof LOGIN_SUCCEEDED;\n  payload: loginSucceededPayloadType;\n}\n\nexport const loginSucceeded = (\n  loginSucceededPayload: loginSucceededPayloadType\n): loginSucceededAction => ({\n  type: LOGIN_SUCCEEDED,\n  payload: loginSucceededPayload\n});\n\nexport interface AuthenticationState {\n  isLoggingIn: boolean;\n  loggedInUserId?: string;\n}\n\nconst initialState: AuthenticationState = {\n  isLoggingIn: false\n};\n\nconst AuthenticationStateReducer = (\n  state: AuthenticationState = initialState,\n  action: AppActions\n): AuthenticationState => {\n  switch (action.type) {\n    case LOGGING_IN: {\n      return { ...state, isLoggingIn: true };\n    }\n    case LOGIN_SUCCEEDED: {\n      return {\n        ...state,\n        isLoggingIn: false,\n        loggedInUserId: action.payload.loggedInUserId\n      };\n    }\n    default:\n      return state;\n  }\n};\n\nconst getAuthenticationStateSlice = (state: AppState) => state.authentication;\n\nexport const getLoggedInUserId = createSelector(\n  [getAuthenticationStateSlice],\n  (authenticationState: AuthenticationState): string => {\n    invariant(\n      authenticationState.loggedInUserId !== undefined,\n      \"getLoggedInUserId should not be used in components of the application that are rendered while there is no logged in user\"\n    );\n    return authenticationState.loggedInUserId;\n  }\n);\n\nexport const isUserLoggedIn = createSelector(\n  getAuthenticationStateSlice,\n  (authenticationState: AuthenticationState): boolean => {\n    return !!authenticationState.loggedInUserId;\n  }\n);\n\nexport const isLoggingIn = createSelector(\n  getAuthenticationStateSlice,\n  (authenticationState: AuthenticationState): boolean => {\n    return authenticationState.isLoggingIn;\n  }\n);\n\nexport { AuthenticationStateReducer };\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { createMembershipReducer } from \"pubnub-redux\";\n\nexport type MembershipHash = { [id: string]: { id: string }[] };\n\nexport interface MemberConversations {\n  [userId: string]: string[];\n}\n\nconst getByUserIdSlice = (state: AppState) => state.joinedConversations;\n\nexport const getConversationsByUserId = createSelector(\n  [getByUserIdSlice],\n  conversations => {\n    return conversations.byId;\n  }\n);\n\nconst JoinedConversationsStateReducer = createMembershipReducer();\nexport { JoinedConversationsStateReducer };\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { createUserReducer, User as PubNubUser } from \"pubnub-redux\";\n\n/**\n * This application uses a custom field called title, which must be defined for\n * every user\n */\ninterface CustomUserFields {\n  title: string;\n}\n\n/**\n * Define which fields of PubNub's User object is accessed by this application.\n * Fields not specified in this definition are not used.\n * We use this oportunity to indicate that some fields which are optional in\n * the PubNub object definition are NOT optional in this application.\n */\nexport type User = Required<Pick<PubNubUser, \"id\" | \"name\" | \"profileUrl\">> & {\n  custom: CustomUserFields;\n};\n\n/**\n * Describes a way to lookup a user from a userId\n */\nexport type UsersIndexedById = { [id: string]: User };\n\n/**\n * create a reducer which holds all known user objects in a normalized form\n */\nconst UsersReducer = createUserReducer<User>();\nexport { UsersReducer };\n\n/**\n * Slice selector is used internally to access the state of the reducer\n */\nconst getUsersSlice = (state: AppState) => state.users;\n\n/**\n * Returns an index which can be used to find user objects\n */\nexport const getUsersById = createSelector(\n  [getUsersSlice],\n  (users): UsersIndexedById => {\n    return users.byId;\n  }\n);\n","import React, { useState, useContext } from \"react\";\nimport { useDispatch } from \"main/useDispatch\";\nimport {\n  Wrapper,\n  Button,\n  Promo,\n  TagLine,\n  Screenshot,\n  Content,\n  LoginForm,\n  Logo,\n  Label,\n  Field,\n  Body\n} from \"./Login.style\";\nimport logo from \"./logo.svg\";\nimport { login } from \"../loginCommand\";\nimport { isLoggingIn } from \"../authenticationModel\";\nimport { isUserLoggedIn } from \"features/authentication/authenticationModel\";\nimport { useSelector } from \"react-redux\";\nimport KnownIds from \"config/knownUserIds.json\";\nimport screenshot from \"./screenshot.png\";\nimport { getUsersById } from \"features/users/userModel\";\nimport { ThemeContext } from \"styled-components\";\n\nconst Login = () => {\n  const dispatch = useDispatch();\n  const loggingIn = useSelector(isLoggingIn);\n  const loggedIn = useSelector(isUserLoggedIn);\n  const theme = useContext(ThemeContext);\n  // show the username in the email field\n  const usersById = useSelector(getUsersById);\n  const [userId, setUserId] = useState(\"\");\n  const user = usersById[userId];\n\n  const loginWithRandomlyPickedUser = () => {\n    if (loggingIn || loggedIn || userId !== \"\") {\n      return;\n    }\n    const randomUserId = KnownIds[Math.floor(Math.random() * KnownIds.length)];\n    setUserId(randomUserId);\n    dispatch(login(randomUserId));\n  };\n\n  if (!loggedIn && !loggingIn) {\n    loginWithRandomlyPickedUser();\n  }\n\n  return (\n    <Wrapper>\n      <Body>\n        <Promo>\n          <TagLine>{theme.custom.tagLine}</TagLine>\n          <Screenshot>\n            <img alt=\"pubnub chat screenshot\" src={screenshot} />\n          </Screenshot>\n        </Promo>\n        <Content>\n          <LoginForm>\n            <Logo alt=\"PubNub\" src={logo} />\n            <Label>Username</Label>\n            <Field\n              readOnly\n              value={user ? user.name.toLowerCase().replace(\" \", \".\") : \"\"}\n            />\n            <Label>Password</Label>\n            <Field readOnly type=\"password\" value={\"password123\"} />\n            <Button onClick={loginWithRandomlyPickedUser}>\n              {loggingIn ? \"Connecting\" : \"Log In\"}\n            </Button>\n          </LoginForm>\n        </Content>\n      </Body>\n    </Wrapper>\n  );\n};\n\nexport { Login };\n","import { ThunkAction } from \"main/storeTypes\";\nimport { loggingIn, loginSucceeded } from \"./authenticationModel\";\nimport { fetchUserById, fetchMemberships } from \"pubnub-redux\";\nimport { getConversationsByUserId } from \"features/joinedConversations/joinedConversationModel\";\n\nexport const login = (userId: string): ThunkAction<Promise<void>> => {\n  return (dispatch, getState, context) => {\n    dispatch(loggingIn());\n\n    // Show the login screen for a minimum amount of time as a splash screen\n    //const timer = new Promise(resolve => setTimeout(resolve, 2000));\n\n    // Set the UUID of the current user to ensure that presence works correctly\n    context.pubnub.api.setUUID(userId);\n\n    // ensure that the current user exists while also populating the store\n    // with their information.\n    const isLoginSuccessful = dispatch(fetchUserById({ userId }))\n      .then(() => {\n        // Subscribe to the user's channel to receive events involving this user\n        context.pubnub.api.subscribe({\n          channels: [userId],\n          withPresence: true\n        });\n      })\n      .then(() => {\n        return dispatch(\n          // Load the conversations that this user has joined\n          fetchMemberships({\n            userId,\n            include: {\n              spaceFields: true,\n              customSpaceFields: false,\n              customFields: false,\n              totalCount: false\n            }\n          })\n        );\n      })\n      .then(() => {\n        // Subscribe to messages on the user's joined conversations\n        const conversationChannels = getConversationsByUserId(getState())[\n          userId\n        ].map(membership => membership.id);\n\n        context.pubnub.api.subscribe({\n          channels: conversationChannels,\n          withPresence: true\n        });\n      });\n\n    return Promise.all([isLoginSuccessful]).then(() => {\n      dispatch(loginSucceeded({ loggedInUserId: userId }));\n    });\n  };\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  height: 100%;\n`;\n","import { createSelector } from \"reselect\";\nimport { AppState } from \"main/storeTypes\";\nimport { View } from \"./LayoutReducer\";\n\nconst getLayoutSlice = (state: AppState) => state.layout;\n\nexport const getView = createSelector(\n  [getLayoutSlice],\n  (app: ReturnType<typeof getLayoutSlice>) => {\n    return app.views[0];\n  }\n);\n\nexport const getViews = createSelector(\n  [getLayoutSlice],\n  (app: ReturnType<typeof getLayoutSlice>) => {\n    return app.views;\n  }\n);\n\nexport const getViewStates = createSelector(\n  [getViews],\n  (views: ReturnType<typeof getViews>) => {\n    return {\n      Menu: views.includes(View.Menu),\n      ConversationMembers: views.includes(View.ConversationMembers),\n      JoinConversation: views.includes(View.JoinConversation),\n      CurrentConversation: views.includes(View.CurrentConversation),\n      UserDetail: views.includes(View.UserDetail),\n      Rtc: views.includes(View.Rtc)\n    };\n  }\n);\n","import { AppState } from \"main/storeTypes\";\nimport { AppActions } from \"main/AppActions\";\nimport { createSelector } from \"reselect\";\nimport DefaultConversation from \"config/defaultConversation.json\";\n\nexport const FOCUS_ON_CONVERSATION = \"FOCUS_ON_CONVERSATION\";\n\nexport const DEFAULT_CONVERSATION = DefaultConversation.conversationId;\n\nexport interface focusOnConversationAction {\n  type: typeof FOCUS_ON_CONVERSATION;\n  payload: string;\n}\n\nexport const focusOnConversation = (\n  target: string\n): focusOnConversationAction => {\n  return {\n    type: FOCUS_ON_CONVERSATION,\n    payload: target\n  };\n};\n\nexport interface CurrentConversationState {\n  currentConversationId: string;\n}\n\nconst initialState: CurrentConversationState = {\n  currentConversationId: DEFAULT_CONVERSATION\n};\n\nconst currentConversationStateReducer = (\n  state: CurrentConversationState = initialState,\n  action: AppActions\n): CurrentConversationState => {\n  switch (action.type) {\n    case FOCUS_ON_CONVERSATION:\n      return { ...state, currentConversationId: action.payload };\n    default:\n      return state;\n  }\n};\n\nexport { currentConversationStateReducer };\n\nconst getCurrentConversationSlice = (state: AppState) =>\n  state.currentConversation;\n\nexport const getCurrentConversationId = createSelector(\n  [getCurrentConversationSlice],\n  (currentConversation: CurrentConversationState): string => {\n    return currentConversation.currentConversationId;\n  }\n);\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { combineReducers } from \"redux\";\nimport {\n  createSpaceReducer,\n  createSpaceListReducer,\n  Space\n} from \"pubnub-redux\";\n\n/**\n * Define which fields of PubNub's User object is accessed by this application.\n * Fields not specified in this definition are not used.\n * We use this oportunity to indicate that some fields which are optional in\n * the PubNub object definition are NOT optional in this application.\n */\nexport type Conversation = Required<Pick<Space, \"id\" | \"name\" | \"description\">>;\n\n/**\n * Describes a way to lookup a conversation from a conversationId\n */\nexport type ConversationsIndexedById = { [id: string]: Conversation };\n\n/**\n * create a reducer which holds all known conversation objects in a normalized form\n */\nconst conversationStateReducer = combineReducers({\n  conversations: createSpaceReducer<Conversation>(),\n  allConversations: createSpaceListReducer<Conversation>()\n});\nexport { conversationStateReducer };\n\n/**\n * Slice selectors are used internally to access the state of the reducer\n */\nconst getConversationsSlice = (state: AppState) => state.conversations;\nconst getSpacesSlice = (state: AppState) => state.conversations.conversations;\nconst getAllSpacesSlice = (state: AppState) =>\n  state.conversations.allConversations;\n\n/**\n * Returns an index which can be used to find conversation objects\n */\nexport const getConversationsById = createSelector(\n  [getConversationsSlice],\n  (conversations): ConversationsIndexedById => {\n    return conversations.conversations.byId;\n  }\n);\n\n/**\n * Returns an array of all spaces\n */\nexport const getAllConversations = createSelector(\n  [getSpacesSlice, getAllSpacesSlice],\n  (spaces, allSpaces) => {\n    return allSpaces.spaceIds.map(id => spaces.byId[id]);\n  }\n);\n","import React, { useContext } from \"react\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface AddIconProps {\n  title: string;\n}\n\nexport const AddIcon = ({ title }: AddIconProps) => {\n  const theme = useContext(ThemeContext);\n  return (\n    <svg width={20} height={20}>\n      <title>{title}</title>\n      <g transform=\"translate(1 1)\" fill=\"none\" fillRule=\"evenodd\">\n        <circle stroke={theme.colors.onPrimary} cx={9} cy={9} r={9} />\n        <path\n          d=\"M5 9h8M9 5v8\"\n          stroke={theme.colors.onPrimary}\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n        />\n      </g>\n    </svg>\n  );\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div<{ selected: boolean; emphasized: boolean }>`\n  cursor: pointer;\n  display: flex;\n  justify-content: space-between;\n  height: ${({ theme }) => theme.sizes[2]};\n  padding: ${({ theme }) => `${theme.space[1]} ${theme.space[6]}`};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme, emphasized }) =>\n    emphasized ? theme.fontWeights.black : theme.fontWeights.regular};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  text-transform: capitalize;\n  color: ${({ theme }) => theme.colors.onPrimary};\n  background: ${({ theme, selected }) =>\n    selected ? theme.backgrounds.primaryActive : \"transparent\"};\n  :hover {\n    background: ${({ theme, selected }) =>\n      selected\n        ? theme.backgrounds.primaryActive\n        : theme.backgrounds.primaryHover};\n  }\n`;\n\nexport const Body = styled.div`\n  display: flex;\n`;\n\nexport const Name = styled.div`\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  margin: ${({ theme }) => `${theme.space[0]} ${theme.space[6]}`};\n  line-height: ${({ theme }) => theme.sizes[1]};\n`;\n\nexport const MessageCount = styled.span`\n  margin: ${({ theme }) => theme.space[3]};\n  :hover {\n    display: none;\n  }\n`;\n\nexport const IconWrapper = styled.div`\n  display: flex;\n  align-items: center;\n`;\n\nexport const ConversationIcon = styled.div<{ color: string }>`\n  border-radius: ${({ theme }) => theme.radii.medium};\n  width: ${({ theme }) => theme.sizes[1]};\n  height: ${({ theme }) => theme.sizes[1]};\n  line-height: ${({ theme }) => theme.sizes[1]};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  color: ${({ theme }) => theme.colors.selectedText};\n  text-align: center;\n  background: ${({ color }) => color};\n`;\n","import React, { useContext } from \"react\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface LeaveIconProps {\n  title: string;\n  selected: boolean;\n}\n\nexport const LeaveIcon = ({ title, selected }: LeaveIconProps) => {\n  const theme = useContext(ThemeContext);\n  return (\n    <svg width={20} height={16}>\n      <title>{title}</title>\n      <g fill={theme.colors.onPrimary} fillRule=\"evenodd\">\n        <path d=\"M10.647 4.854L12.793 7H.5a.499.499 0 100 1h12.293l-2.146 2.145a.5.5 0 00.707.707l3-3a.497.497 0 000-.708l-3-3a.5.5 0 10-.707.71z\" />\n        <path d=\"M19.001 1.5v12c0 .827-.673 1.5-1.5 1.5h-10c-.827 0-1.5-.673-1.5-1.5v-4a.5.5 0 011 0v4a.5.5 0 00.5.5h10a.5.5 0 00.5-.5v-12a.5.5 0 00-.5-.5h-10a.5.5 0 00-.5.5v4a.5.5 0 01-1 0v-4c0-.827.673-1.5 1.5-1.5h10c.827 0 1.5.673 1.5 1.5\" />\n      </g>\n    </svg>\n  );\n};\n","const getUniqueColor = (string: string, colorSet: string[]) => {\n  const getNumericHash = (string: string) => {\n    let hash = 0;\n    if (string.length === 0) return hash;\n    for (let i = 0; i < string.length; i++) {\n      let char = string.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n  };\n  const modulo = colorSet.length;\n  const colorIndex = ((getNumericHash(string) % modulo) + modulo) % modulo;\n  return colorSet[colorIndex];\n};\n\nexport default getUniqueColor;\n","import { useEffect, useState } from \"react\";\n\nexport function useMediaQuery(mediaQuery: string) {\n  // the theme provides media queries with the \"@media screen and\" prefix, which is not supported by window.matchMedia\n  const parsedQuery =\n    (mediaQuery.match(/(\\([\\w\\s-:]+\\))/) || [])[1] || mediaQuery;\n  const mediaQueryList = window.matchMedia(parsedQuery);\n  const [value, setValue] = useState(mediaQueryList.matches);\n\n  useEffect(() => {\n    const mediaQueryListener = () => setValue(mediaQueryList.matches);\n\n    mediaQueryList.addListener(mediaQueryListener);\n\n    return () => mediaQueryList.removeListener(mediaQueryListener);\n  }, [mediaQueryList]);\n\n  return value;\n}\n","import React, { useContext } from \"react\";\nimport {\n  Wrapper,\n  Body,\n  ConversationIcon,\n  Name,\n  MessageCount,\n  IconWrapper\n} from \"./ConversationItem.style\";\nimport { LeaveIcon } from \"foundations/components/icons/LeaveIcon\";\nimport useHover from \"foundations/hooks/useHover\";\nimport { DEFAULT_CONVERSATION } from \"features/currentConversation/currentConversationModel\";\nimport { ThemeContext } from \"styled-components\";\nimport getUniqueColor from \"foundations/utilities/getUniqueColor\";\nimport { useMediaQuery } from \"foundations/hooks/useMediaQuery\";\nimport { useSelector } from \"react-redux\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\n\ninterface ConversationItemProps {\n  selected: boolean;\n  id: string;\n  name: string;\n  unreadMessageCount: number;\n  onClick: () => void;\n  onLeave: () => void;\n}\n\n/**\n * Show a single joined conversation\n *\n * Similiar to ConversationDescription but with different style and more functionality\n */\nconst ConversationItem = ({\n  selected,\n  id,\n  name,\n  onClick,\n  onLeave,\n  unreadMessageCount\n}: ConversationItemProps) => {\n  const [isHovering, hoverProps] = useHover({ mouseEnterDelayMS: 0 });\n  const currentUserId = useSelector(getLoggedInUserId);\n  const canLeave: boolean = id !== DEFAULT_CONVERSATION && id !== currentUserId;\n  const theme = useContext(ThemeContext);\n  const isTouch = useMediaQuery(theme.mediaQueries.touch);\n  const color = getUniqueColor(\n    name,\n    (theme.colors.avatars as unknown) as string[]\n  );\n  return (\n    <Wrapper\n      {...hoverProps}\n      selected={selected}\n      emphasized={unreadMessageCount > 0}\n      onClick={onClick}\n    >\n      <Body>\n        <ConversationIcon color={color}>#</ConversationIcon>\n        <Name>{name}</Name>\n      </Body>\n      {(isHovering || isTouch) && canLeave ? (\n        <IconWrapper\n          onClick={e => {\n            e.stopPropagation();\n            onLeave();\n          }}\n        >\n          <LeaveIcon title=\"Leave Conversation\" selected={selected} />\n        </IconWrapper>\n      ) : (\n        unreadMessageCount > 0 && (\n          <MessageCount>{unreadMessageCount}</MessageCount>\n        )\n      )}\n    </Wrapper>\n  );\n};\n\nexport { ConversationItem };\n","import { useState } from \"react\";\n\n// https://github.com/andrewbranch/react-use-hover\n\nexport interface UseHoverOptions {\n  mouseEnterDelayMS?: number;\n  mouseLeaveDelayMS?: number;\n}\n\nexport type HoverProps = Pick<\n  React.HTMLAttributes<HTMLElement>,\n  \"onMouseEnter\" | \"onMouseLeave\"\n>;\n\nexport default function useHover({\n  mouseEnterDelayMS = 200,\n  mouseLeaveDelayMS = 0\n}: UseHoverOptions = {}): [boolean, HoverProps] {\n  const [isHovering, setIsHovering] = useState(false);\n  let mouseEnterTimer: number | undefined;\n  let mouseOutTimer: number | undefined;\n  return [\n    isHovering,\n    {\n      onMouseEnter: () => {\n        clearTimeout(mouseOutTimer);\n        mouseEnterTimer = setTimeout(\n          () => setIsHovering(true),\n          mouseEnterDelayMS\n        );\n      },\n      onMouseLeave: () => {\n        clearTimeout(mouseEnterTimer);\n        mouseOutTimer = setTimeout(\n          () => setIsHovering(false),\n          mouseLeaveDelayMS\n        );\n      }\n    }\n  ];\n}\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  overflow: auto;\n  margin: ${({ theme }) => theme.space[0]};\n  margin-top: ${({ theme }) => theme.space[1]};\n`;\n\nexport const ConversationList = styled.div`\n  overflow-y: auto;\n  overflow-y: overlay;\n  display: flex;\n  flex-direction: column;\n`;\n\nexport const Title = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin: ${({ theme }) => `${theme.space[1]} ${theme.space[6]}`};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  color: ${({ theme }) => theme.colors.onPrimary};\n`;\n\nexport const AddButton = styled.span`\n  cursor: pointer;\n  font-size: 0px;\n  align-self: center;\n  cursor: pointer;\n`;\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { createMembersReducer } from \"pubnub-redux\";\n\nexport type MembershipHash = { [id: string]: { id: string }[] };\n\nexport interface ConversationMembers {\n  [conversationId: string]: string[];\n}\n\nconst getByConversationIdSlice = (state: AppState) => state.conversationMembers;\n\nexport const getUsersByConversationId = createSelector(\n  [getByConversationIdSlice],\n  (users: { byId: MembershipHash }) => {\n    return users.byId;\n  }\n);\n\nconst ConversationMembersStateReducer = createMembersReducer();\n\nexport { ConversationMembersStateReducer };\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { createPresenceReducer, Presence } from \"pubnub-redux\";\n\nexport interface ConversationPresence {\n  [conversationId: string]: {\n    name: string;\n    occupants: Presence[];\n    occupancy: number;\n  };\n}\n\n/**\n * Create a reducer to precense information for conversation members\n */\nconst MemberPresenceReducer = createPresenceReducer();\nexport { MemberPresenceReducer };\n\nconst getByPresenceSlice = (state: AppState) => state.memberPresence;\n\nexport const getPresenceByConversationId = createSelector(\n  [getByPresenceSlice],\n  (presence: { byId: ConversationPresence }) => {\n    return presence.byId;\n  }\n);\n","import React, { useContext } from \"react\";\nimport styled, { ThemeContext } from \"styled-components/macro\";\nimport getUniqueColor from \"foundations/utilities/getUniqueColor\";\n\nexport const Wrapper = styled.div<{ color: string; size: number }>`\n  vertical-align: middle;\n  border-radius: ${({ theme }) => theme.radii.round};\n  width: ${props => props.size}px;\n  height: ${props => props.size}px;\n  line-height: ${props => props.size}px;\n  font-size: ${props => Math.round(props.size / 3)}px;\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  text-transform: uppercase;\n  text-align: center;\n  color: ${({ theme }) => theme.colors.avatarText};\n  background-color: ${props => props.color};\n`;\n\ntype UserInitialsAvatarProps = {\n  name: string;\n  userId: string;\n  size: number;\n  muted?: boolean;\n  color?: string;\n};\n\nconst UserInitialsAvatar = ({\n  name,\n  userId,\n  size,\n  muted,\n  color\n}: UserInitialsAvatarProps) => {\n  const theme = useContext(ThemeContext);\n  const initials = name.match(/\\b\\w/g) || [];\n  const uniqueColor = getUniqueColor(\n    userId,\n    (theme.colors.avatars as unknown) as string[]\n  );\n  return (\n    <Wrapper size={size} color={color || uniqueColor}>\n      {initials}\n    </Wrapper>\n  );\n};\n\nexport { UserInitialsAvatar };\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { AppActions } from \"../../main/AppActions\";\n\nexport const SELECT_USER = \"SELECT_USER\";\n\nexport const selectUser = (userId: string): userSelectedAction => ({\n  type: SELECT_USER,\n  payload: {\n    selectedUserId: userId\n  }\n});\n\ntype userSelectedPayloadType = {\n  selectedUserId: string;\n};\nexport interface UserDetailState {\n  selectedUserId: string;\n}\n\nexport interface userSelectedAction {\n  type: typeof SELECT_USER;\n  payload: userSelectedPayloadType;\n}\n\nconst initialState: UserDetailState = {\n  selectedUserId: \"\"\n};\n\nconst UserDetailStateReducer = (\n  state: UserDetailState = initialState,\n  action: AppActions\n): UserDetailState => {\n  switch (action.type) {\n    case SELECT_USER: {\n      return { ...state, selectedUserId: action.payload.selectedUserId };\n    }\n    default:\n      return state;\n  }\n};\n\nconst getUserDetailStateSlice = (state: AppState) => state.userDetail;\n\nexport const getSelectedUserId = createSelector(\n  getUserDetailStateSlice,\n  (userDetail: UserDetailState): string => {\n    return userDetail.selectedUserId;\n  }\n);\n\nexport { UserDetailStateReducer };\n","import { LayoutActionType } from \"./LayoutActionType\";\n\nexport interface menuViewHiddenAction {\n  type: typeof LayoutActionType.MENU_VIEW_HIDDEN;\n}\n\nexport interface currentConversationViewHiddenAction {\n  type: typeof LayoutActionType.CURRENT_CONVERSATION_VIEW_HIDDEN;\n}\n\nexport interface conversationMembersViewHiddenAction {\n  type: typeof LayoutActionType.CONVERSATION_MEMBERS_VIEW_HIDDEN;\n}\n\nexport interface joinConversationViewHiddenAction {\n  type: typeof LayoutActionType.JOIN_CONVERSATION_VIEW_HIDDEN;\n}\n\nexport interface menuViewDisplayedAction {\n  type: typeof LayoutActionType.MENU_VIEW_DISPLAYED;\n}\n\nexport interface currentConversationViewDisplayedAction {\n  type: typeof LayoutActionType.CURRENT_CONVERSATION_VIEW_DISPLAYED;\n}\n\nexport interface conversationMembersViewDisplayedAction {\n  type: typeof LayoutActionType.CONVERSATION_MEMBERS_VIEW_DISPLAYED;\n}\n\nexport interface joinConversationViewDisplayedAction {\n  type: typeof LayoutActionType.JOIN_CONVERSATION_VIEW_DISPLAYED;\n}\nexport interface userDetailViewDisplayedAction {\n  type: typeof LayoutActionType.USER_DETAIL_VIEW_DISPLAYED;\n}\nexport interface userDetailViewHiddenAction {\n  type: typeof LayoutActionType.USER_DETAIL_VIEW_HIDDEN;\n}\n\nexport interface rtcViewDisplayedAction {\n  type: typeof LayoutActionType.RTC_VIEW_DISPLAYED;\n}\nexport interface rtcViewHiddenAction {\n  type: typeof LayoutActionType.RTC_VIEW_HIDDEN;\n}\n\nexport type LayoutActions =\n  | menuViewHiddenAction\n  | currentConversationViewHiddenAction\n  | conversationMembersViewHiddenAction\n  | joinConversationViewHiddenAction\n  | menuViewDisplayedAction\n  | currentConversationViewDisplayedAction\n  | conversationMembersViewDisplayedAction\n  | joinConversationViewDisplayedAction\n  | userDetailViewDisplayedAction\n  | userDetailViewHiddenAction\n  | rtcViewDisplayedAction\n  | rtcViewHiddenAction;\n\nexport const menuViewDisplayed = (): menuViewDisplayedAction => {\n  return {\n    type: LayoutActionType.MENU_VIEW_DISPLAYED\n  };\n};\n\nexport const joinConversationViewDisplayed = (): joinConversationViewDisplayedAction => {\n  return {\n    type: LayoutActionType.JOIN_CONVERSATION_VIEW_DISPLAYED\n  };\n};\n\nexport const userDetailViewDisplayed = (): userDetailViewDisplayedAction => {\n  return {\n    type: LayoutActionType.USER_DETAIL_VIEW_DISPLAYED\n  };\n};\n\nexport const rtcViewDisplayed = (): rtcViewDisplayedAction => {\n  return {\n    type: LayoutActionType.RTC_VIEW_DISPLAYED\n  };\n};\n\nexport const currentConversationViewDisplayed = (): currentConversationViewDisplayedAction => {\n  return {\n    type: LayoutActionType.CURRENT_CONVERSATION_VIEW_DISPLAYED\n  };\n};\n\nexport const conversationMembersViewDisplayed = (): conversationMembersViewDisplayedAction => {\n  return {\n    type: LayoutActionType.CONVERSATION_MEMBERS_VIEW_DISPLAYED\n  };\n};\n\nexport const menuViewHidden = (): menuViewHiddenAction => {\n  return {\n    type: LayoutActionType.MENU_VIEW_HIDDEN\n  };\n};\n\nexport const joinConversationViewHidden = (): joinConversationViewHiddenAction => {\n  return {\n    type: LayoutActionType.JOIN_CONVERSATION_VIEW_HIDDEN\n  };\n};\n\nexport const userDetailViewHidden = (): userDetailViewHiddenAction => {\n  return {\n    type: LayoutActionType.USER_DETAIL_VIEW_HIDDEN\n  };\n};\n\nexport const rtcViewHidden = (): rtcViewHiddenAction => {\n  return {\n    type: LayoutActionType.RTC_VIEW_HIDDEN\n  };\n};\n\nexport const currentConversationViewHidden = (): currentConversationViewHiddenAction => {\n  return {\n    type: LayoutActionType.CURRENT_CONVERSATION_VIEW_HIDDEN\n  };\n};\n\nexport const conversationMembersViewHidden = (): conversationMembersViewHiddenAction => {\n  return {\n    type: LayoutActionType.CONVERSATION_MEMBERS_VIEW_HIDDEN\n  };\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  align-items: center;\n  height: ${({ theme }) => theme.sizes[2]};\n  padding: ${({ theme }) => `${theme.space[0]} ${theme.space[6]}`};\n  :hover {\n    background: ${({ theme }) => theme.backgrounds.panelHover};\n  }\n`;\n\nexport const PresenceDot = styled.div<{ presence: boolean; size: number }>`\n  border-radius: ${({ theme }) => theme.radii.round};\n  width: ${({ size }) => size}px;\n  height: ${({ size }) => size}px;\n  top: -${({ size }) => size / 2}px;\n  right: -${({ size }) => size / 2}px;\n  position: absolute;\n  background-color: ${({ theme, presence }) =>\n    presence ? theme.colors.success : theme.colors.inactive};\n  font-size: 0px;\n`;\n\nexport const Avatar = styled.div`\n  width: ${({ theme }) => theme.sizes[1]};\n  height: ${({ theme }) => theme.sizes[1]};\n  position: relative;\n`;\n\nexport const About = styled.div`\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  padding-left: ${({ theme }) => theme.space[6]};\n  height: ${({ theme }) => theme.sizes[1]};\n`;\n\nexport const UserName = styled.div<{ muted: boolean }>`\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  text-transform: capitalize;\n  color: ${({ theme }) => theme.colors.importantText};\n  cursor: pointer;\n`;\n\nexport const UserTitle = styled.div<{ muted: boolean }>`\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  color: ${({ theme }) => theme.colors.normalText};\n`;\n","import React from \"react\";\nimport { UserInitialsAvatar } from \"foundations/components/UserInitialsAvatar\";\nimport { selectUser } from \"../../userDetail/userDetailModel\";\nimport { useDispatch } from \"react-redux\";\nimport { userDetailViewDisplayed } from \"../../layout/LayoutActions\";\n\nimport {\n  Wrapper,\n  Avatar,\n  About,\n  PresenceDot,\n  UserName,\n  UserTitle\n} from \"./MemberDescription.style\";\n\nexport interface UserFragment {\n  name: string;\n  id: string;\n  custom: {\n    title: string;\n  };\n  profileUrl: string;\n  presence: boolean;\n}\n\ninterface MemberDescriptionProps {\n  user: UserFragment;\n  you: boolean;\n}\n\nconst MemberDescription = ({ user, you }: MemberDescriptionProps) => {\n  const dispatch = useDispatch();\n\n  const openUserDetailsOverlay = () => {\n    dispatch(selectUser(user.id));\n    dispatch(userDetailViewDisplayed());\n  };\n\n  return (\n    <Wrapper>\n      <Avatar>\n        <UserInitialsAvatar\n          size={36}\n          name={user.name}\n          userId={user.id}\n          muted={!user.presence}\n        />\n        {user.presence && <PresenceDot presence={user.presence} size={7} />}\n      </Avatar>\n      <About>\n        <UserName muted={!user.presence} onClick={openUserDetailsOverlay}>\n          {user.name}\n          {you && \" (you)\"}\n        </UserName>\n        <UserTitle muted={!user.presence}>{user.custom.title}</UserTitle>\n      </About>\n    </Wrapper>\n  );\n};\n\nexport { MemberDescription };\n","import React from \"react\";\n\ninterface CrossIconProps {\n  title: string;\n  color: string;\n}\n\nexport const CrossIcon = ({ title, color }: CrossIconProps) => {\n  return (\n    <svg width={16} height={16}>\n      <title>{title}</title>\n      <g\n        stroke={color}\n        strokeWidth={2}\n        fill=\"none\"\n        fillRule=\"evenodd\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      >\n        <path d=\"M1 1l13.2 13.2M14.2 1L1 14.2\" />\n      </g>\n    </svg>\n  );\n};\n","import styled from \"styled-components/macro\";\nimport { motion } from \"framer-motion\";\n\nexport const Wrapper = styled(motion.section)`\n  display: none;\n  flex-direction: column;\n  position: fixed;\n  z-index: 100;\n  margin-left: ${({ theme }) => theme.space[0]};\n  width: 100%;\n  max-width: none;\n  height: 100%;\n  background: ${({ theme }) => theme.backgrounds.panel};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    position: relative;\n    min-width: ${({ theme }) => theme.sizes[5]};\n    max-width: ${({ theme }) => theme.sizes[5]};\n  }\n`;\n\nexport const Controls = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  position: absolute;\n  top: 0;\n  min-height: ${({ theme }) => theme.sizes[1]};\n  padding: ${({ theme }) => `${theme.space[6]}`};\n  width: 100%;\n`;\n\nexport const Header = styled.div`\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  justify-content: space-between;\n  min-height: ${({ theme }) => theme.sizes[3]};\n  padding: ${({ theme }) => theme.space[6]};\n  padding-bottom: 0;\n  color: ${({ theme }) => theme.colors.importantText};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n`;\n\nexport const IconWrapper = styled.div`\n  display: flex;\n  align-items: center;\n`;\n\nexport const ConversationIcon = styled.div<{ color: string }>`\n  border-radius: ${({ theme }) => theme.radii.medium};\n  width: ${({ theme }) => theme.sizes[1]};\n  height: ${({ theme }) => theme.sizes[1]};\n  line-height: ${({ theme }) => theme.sizes[1]};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  color: ${({ theme }) => theme.colors.onPrimary};\n  text-align: center;\n  background: ${({ color }) => color};\n`;\n\nexport const Details = styled.div`\n  height: ${({ theme }) => theme.sizes[1]};\n  padding-left: ${({ theme }) => theme.space[6]};\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n`;\n\nexport const Channel = styled.div`\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  color: ${({ theme }) => theme.colors.importantText};\n`;\n\nexport const Title = styled.div`\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  color: ${({ theme }) => theme.colors.importantText};\n  padding: ${({ theme }) => `${theme.space[1]} ${theme.space[6]}`};\n`;\n\nexport const CloseIcon = styled.span`\n  cursor: pointer;\n`;\n\nexport const ScrollableView = styled.span`\n  overflow-y: scroll;\n`;\n\nexport const BackIconWrapper = styled.div`\n  cursor: pointer;\n  display: flex;\n  margin-right: ${({ theme }) => theme.space[7]};\n  justify-self: flex-start;\n  ${({ theme }) => theme.mediaQueries.medium} {\n    display: none;\n  }\n`;\n\nexport const getAnimatedWrapperVariants = (\n  isMedium: boolean,\n  size: string\n) => ({\n  open: {\n    x: isMedium ? \"0px\" : \"0%\",\n    display: \"flex\"\n  },\n  closed: {\n    x: isMedium ? size : \"-100%\",\n    transitionEnd: {\n      display: \"none\"\n    }\n  }\n});\n","import React, { useContext } from \"react\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface PeopleGroupIconProp {\n  title: string;\n  active: boolean;\n}\n\nexport const PeopleGroupIcon = ({ title, active }: PeopleGroupIconProp) => {\n  const theme = useContext(ThemeContext);\n  return (\n    <svg width={20} height={15}>\n      <title>{title}</title>\n      <g\n        fill={active ? theme.colors.active : theme.colors.normalText}\n        fillRule=\"evenodd\"\n      >\n        <path d=\"M7 13.503a.5.5 0 00.5.497h11a.5.5 0 00.5-.497c-.001-.035-.032-.895-.739-1.734C17.287 10.612 15.468 10 13 10s-4.287.612-5.261 1.768c-.707.84-.738 1.699-.739 1.734M18.5 15h-11c-.827 0-1.5-.673-1.5-1.5 0-.048.011-1.19.924-2.315.525-.646 1.241-1.158 2.128-1.522C10.123 9.223 11.452 9 13 9s2.876.223 3.948.662c.887.364 1.603.876 2.128 1.522.914 1.125.924 2.267.924 2.315 0 .827-.673 1.5-1.5 1.5M13 1c-1.654 0-3 1.346-3 3s1.346 3 3 3 3-1.346 3-3-1.346-3-3-3m0 7c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4M4.5 15h-3C.673 15 0 14.327 0 13.5c0-.037.008-.927.663-1.8.378-.505.894-.904 1.533-1.188.764-.34 1.708-.512 2.805-.512.179 0 .356.005.527.014a.5.5 0 01-.053.999 9.1 9.1 0 00-.473-.012c-3.894 0-3.997 2.379-4 2.503a.5.5 0 00.5.497h3a.5.5 0 010 1L4.5 15zM5 4c-1.103 0-2 .897-2 2s.897 2 2 2 2-.897 2-2-.897-2-2-2m0 5C3.346 9 2 7.654 2 6s1.346-3 3-3 3 1.346 3 3-1.346 3-3 3\" />\n      </g>\n    </svg>\n  );\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div<{ highlighted: boolean }>`\n  display: flex;\n  align-items: center;\n  align-self: flex-start;\n  cursor: pointer;\n  flex-direction: column-reverse;\n  margin-left: ${({ theme }) => theme.space[6]};\n  color: ${({ theme, highlighted }) =>\n    highlighted ? theme.colors.active : theme.colors.normalText};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.light};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    flex-direction: row;\n  }\n`;\n\nexport const OccupancyNumber = styled.section`\n  cursor: pointer;\n  margin-right: ${({ theme }) => theme.space[0]};\n  margin-top: ${({ theme }) => theme.space[0]};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    margin-right: ${({ theme }) => theme.space[3]};\n    margin-top: ${({ theme }) => theme.space[0]};\n  }\n  em {\n    font-style: normal;\n    font-family: ${({ theme }) => theme.fonts.app};\n    font-weight: ${({ theme }) => theme.fontWeights.black};\n  }\n`;\n\nexport const IconWrapper = styled.span`\n  cursor: pointer;\n`;\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { createSelector } from \"reselect\";\nimport { getCurrentConversationId } from \"../currentConversationModel\";\nimport {\n  getUsersByConversationId,\n  MembershipHash\n} from \"features/conversationMembers/conversationMemberModel\";\nimport {\n  getPresenceByConversationId,\n  ConversationPresence\n} from \"features/memberPresence/memberPresenceModel\";\nimport { getViewStates } from \"features/layout/Selectors\";\nimport { PeopleGroupIcon } from \"foundations/components/icons/PeopleGroupIcon\";\nimport {\n  Wrapper,\n  OccupancyNumber,\n  IconWrapper\n} from \"./ConversationOccupancy.style\";\nimport {\n  conversationMembersViewDisplayed,\n  conversationMembersViewHidden\n} from \"features/layout/LayoutActions\";\n\nexport interface ConversationOccupancyFragment {\n  joinedCount: number;\n  presentCount: number;\n}\n\nexport const getCurrentConversationOccupancy = createSelector(\n  [\n    getCurrentConversationId,\n    getUsersByConversationId,\n    getPresenceByConversationId\n  ],\n  (\n    currentConversationId: string,\n    conversationMemberships: MembershipHash,\n    conversationPresence: ConversationPresence\n  ): ConversationOccupancyFragment => {\n    const members = conversationMemberships[currentConversationId];\n    const presence = conversationPresence[currentConversationId];\n    return {\n      joinedCount: members ? members.length : 0,\n      presentCount: presence ? presence.occupancy : 0\n    };\n  }\n);\n\nconst ConversationOccupancy = () => {\n  const {\n    joinedCount,\n    presentCount\n  }: ConversationOccupancyFragment = useSelector(\n    getCurrentConversationOccupancy\n  );\n  const views = useSelector(getViewStates);\n  const isConversationMembersLayoutVisible = views.ConversationMembers;\n  const dispatch = useDispatch();\n\n  return (\n    <Wrapper\n      highlighted={isConversationMembersLayoutVisible}\n      onClick={() => {\n        isConversationMembersLayoutVisible\n          ? dispatch(conversationMembersViewHidden())\n          : dispatch(conversationMembersViewDisplayed());\n      }}\n    >\n      <OccupancyNumber>\n        <em>{presentCount}</em> | {joinedCount}\n      </OccupancyNumber>\n      <IconWrapper>\n        <PeopleGroupIcon\n          title={\n            isConversationMembersLayoutVisible\n              ? \"Hide members list\"\n              : \"Show convsersation members\"\n          }\n          active={isConversationMembersLayoutVisible}\n        />\n      </IconWrapper>\n    </Wrapper>\n  );\n};\n\nexport { ConversationOccupancy };\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.section`\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  min-height: ${({ theme }) => theme.sizes[3]};\n  justify-content: space-between;\n  background: ${({ theme }) => theme.backgrounds.panel};\n  padding: ${({ theme }) => `${theme.space[7]} ${theme.space[6]}`};\n  padding-bottom: 0px;\n  ${({ theme }) => theme.mediaQueries.medium} {\n    background: transparent;\n  }\n`;\n\nexport const BackIconWrapper = styled.div`\n  cursor: pointer;\n  display: flex;\n  margin-right: ${({ theme }) => theme.space[7]};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    display: none;\n  }\n`;\n\nexport const Body = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  height: ${({ theme }) => theme.sizes[1]};\n  width: 100%;\n`;\n\nexport const Border = styled.div`\n  display: none;\n  border-bottom: ${({ theme }) =>\n    `${theme.borders.light} ${theme.colors.neutral[2]}`};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    display: inherit;\n  }\n`;\n\nexport const Information = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n`;\n\nexport const Name = styled.div`\n  flex-grow: 1;\n  color: ${({ theme }) => theme.colors.importantText};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  text-transform: capitalize;\n`;\n\nexport const Description = styled.div`\n  flex-grow: 1;\n  color: ${({ theme }) => theme.colors.normalText};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  text-transform: capitalize;\n`;\n","import React, { useContext } from \"react\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface BackIconProps {\n  title: string;\n}\n\nexport const BackIcon = ({ title }: BackIconProps) => {\n  const theme = useContext(ThemeContext);\n  return (\n    <svg width={12} height={22}>\n      <title>{title}</title>\n      <path\n        d=\"M3.621 11l7.94-7.94A1.5 1.5 0 009.439.94l-9 9a1.5 1.5 0 000 2.12l9 9a1.5 1.5 0 002.122-2.12L3.62 11z\"\n        fill={theme.colors.active}\n        fillRule=\"nonzero\"\n      />\n    </svg>\n  );\n};\n","import React from \"react\";\nimport { ConversationOccupancy } from \"../ConversationOccupancy\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { createSelector } from \"reselect\";\nimport {\n  ConversationsIndexedById,\n  getConversationsById\n} from \"features/conversations/conversationModel\";\nimport { getCurrentConversationId } from \"../currentConversationModel\";\nimport {\n  Wrapper,\n  Body,\n  Information,\n  Name,\n  Description,\n  Border,\n  BackIconWrapper\n} from \"./Header.style\";\nimport { BackIcon } from \"foundations/components/icons/BackIcon\";\nimport { menuViewDisplayed } from \"features/layout/LayoutActions\";\n\nexport interface ConversationDescriptionFragment {\n  id: string;\n  name: string;\n  description: string;\n}\n\nexport const getCurrentConversationDescription = createSelector(\n  [getConversationsById, getCurrentConversationId],\n  (\n    conversations: ConversationsIndexedById,\n    currentConversationId: string\n  ): ConversationDescriptionFragment => {\n    return {\n      ...conversations[currentConversationId]\n    };\n  }\n);\n\nconst Header = () => {\n  const conversation: ConversationDescriptionFragment = useSelector(\n    getCurrentConversationDescription\n  );\n\n  const dispatch = useDispatch();\n\n  return (\n    <Wrapper>\n      <Body>\n        <BackIconWrapper\n          onClick={() => {\n            dispatch(menuViewDisplayed());\n          }}\n        >\n          <BackIcon title=\"back\" />\n        </BackIconWrapper>\n        <Information>\n          <Name>{conversation.name}</Name>\n          <Description>{conversation.description}</Description>\n        </Information>\n        <ConversationOccupancy />\n      </Body>\n      <Border />\n    </Wrapper>\n  );\n};\n\nexport { Header };\n","import React, { useEffect, useContext } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { createSelector } from \"reselect\";\nimport { getViewStates } from \"features/layout/Selectors\";\nimport { UsersIndexedById, getUsersById } from \"features/users/userModel\";\nimport {\n  getUsersByConversationId,\n  MembershipHash\n} from \"../conversationMemberModel\";\nimport {\n  getPresenceByConversationId,\n  ConversationPresence\n} from \"features/memberPresence/memberPresenceModel\";\nimport { MemberDescription, UserFragment } from \"../MemberDescription\";\nimport { getCurrentConversationId } from \"features/currentConversation/currentConversationModel\";\nimport { CrossIcon } from \"foundations/components/icons/CrossIcon\";\nimport {\n  Wrapper,\n  getAnimatedWrapperVariants,\n  CloseIcon,\n  ScrollableView,\n  Header,\n  Controls,\n  ConversationIcon,\n  IconWrapper,\n  Details,\n  Title,\n  Channel\n} from \"./ConversationMembers.style\";\nimport { fetchMembers, fetchHereNow } from \"pubnub-redux\";\nimport { usePubNub } from \"pubnub-react\";\nimport { conversationMembersViewHidden } from \"features/layout/LayoutActions\";\nimport { ThemeContext } from \"styled-components\";\nimport { useMediaQuery } from \"foundations/hooks/useMediaQuery\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\nimport getUniqueColor from \"foundations/utilities/getUniqueColor\";\nimport { getCurrentConversationDescription } from \"features/currentConversation/Header\";\n\nexport const getCurrentConversationMembers = createSelector(\n  [\n    getUsersById,\n    getCurrentConversationId,\n    getUsersByConversationId,\n    getPresenceByConversationId\n  ],\n  (\n    users: UsersIndexedById,\n    conversationId: string,\n    conversationMemberships: MembershipHash,\n    conversationPresence: ConversationPresence\n  ): UserFragment[] => {\n    let presence = conversationPresence[conversationId];\n    return conversationMemberships[conversationId]\n      ? conversationMemberships[conversationId].map(user => {\n          return {\n            ...users[user.id],\n            presence: presence\n              ? presence.occupants.filter(occupant => {\n                  return occupant.uuid === user.id;\n                }).length > 0\n              : false\n          };\n        })\n      : [];\n  }\n);\n\nconst orderByPresence = (members: UserFragment[]) => {\n  return members.sort((userA, userB) =>\n    userA.presence === userB.presence ? 0 : userA.presence ? -1 : 1\n  );\n};\nconst ConversationMembers = () => {\n  const userId = useSelector(getLoggedInUserId);\n  const members: UserFragment[] = useSelector(getCurrentConversationMembers);\n  const currentConversationId = useSelector(getCurrentConversationId);\n  const dispatch = useDispatch();\n  const pubnub = usePubNub();\n  const views = useSelector(getViewStates);\n  const theme = useContext(ThemeContext);\n  const isMedium = useMediaQuery(theme.mediaQueries.medium);\n  const conversation = useSelector(getCurrentConversationDescription);\n  const conversationColor = getUniqueColor(\n    conversation.name,\n    (theme.colors.avatars as unknown) as string[]\n  );\n\n  useEffect(() => {\n    if (members.length === 0) {\n      dispatch(\n        fetchMembers({\n          spaceId: currentConversationId,\n          include: {\n            userFields: true,\n            customUserFields: true,\n            totalCount: false\n          }\n        })\n      );\n\n      dispatch(\n        fetchHereNow({\n          channels: [currentConversationId]\n        })\n      );\n    }\n  }, [members, currentConversationId, pubnub, dispatch]);\n\n  return (\n    <Wrapper\n      animate={views.ConversationMembers ? \"open\" : \"closed\"}\n      variants={getAnimatedWrapperVariants(isMedium, theme.sizes[4])}\n      transition={{ ease: \"linear\", duration: 0.15 }}\n    >\n      <Controls>\n        <CloseIcon\n          onClick={() => {\n            dispatch(conversationMembersViewHidden());\n          }}\n        >\n          <CrossIcon\n            color={theme.colors.normalText}\n            title=\"close members list\"\n          />\n        </CloseIcon>\n      </Controls>\n      <Header>\n        <IconWrapper>\n          <ConversationIcon color={conversationColor}>#</ConversationIcon>\n          <Details>\n            <Channel>{conversation.name}</Channel>\n          </Details>\n        </IconWrapper>\n      </Header>\n      <Title>Members</Title>\n      <ScrollableView>\n        {orderByPresence(members).map(user => (\n          <MemberDescription\n            user={user}\n            key={user.id}\n            you={user.id === userId}\n          />\n        ))}\n      </ScrollableView>\n    </Wrapper>\n  );\n};\n\nexport { ConversationMembers };\n","import React from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { createSelector } from \"reselect\";\nimport { getCurrentConversationId } from \"features/currentConversation/currentConversationModel\";\nimport { getConversationsByUserId } from \"../joinedConversationModel\";\nimport { MembershipHash } from \"../joinedConversationModel\";\nimport {\n  ConversationsIndexedById,\n  getConversationsById\n} from \"features/conversations/conversationModel\";\nimport { focusOnConversation } from \"features/currentConversation/currentConversationModel\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\nimport { AddIcon } from \"foundations/components/icons/AddIcon\";\nimport { ConversationItem } from \"../ConversationItem\";\nimport {\n  Wrapper,\n  Title,\n  AddButton,\n  ConversationList\n} from \"./MyConversations.style\";\nimport { fetchSpaces, fetchMembers } from \"pubnub-redux\";\nimport { getCurrentConversationMembers } from \"features/conversationMembers/ConversationMembers/ConversationMembers\";\nimport { UserFragment } from \"features/conversationMembers/MemberDescription/MemberDescription\";\nimport { leaveConversation } from \"../leaveConversationCommand\";\nimport {\n  currentConversationViewDisplayed,\n  joinConversationViewDisplayed,\n  menuViewHidden\n} from \"features/layout/LayoutActions\";\n\nexport interface ConversationFragment {\n  id: string;\n  name: string;\n}\n\nexport const getJoinedConversations = createSelector(\n  [getConversationsById, getLoggedInUserId, getConversationsByUserId],\n  (\n    conversations: ConversationsIndexedById,\n    userId: string,\n    userConversations: MembershipHash\n  ): ConversationFragment[] => {\n    return userConversations[userId]\n      ? userConversations[userId].map(conversation => {\n          return {\n            id: conversation.id,\n            name: conversations[conversation.id].name\n          };\n        })\n      : [];\n  }\n);\n\nconst MyConversations = () => {\n  const currentUserId = useSelector(getLoggedInUserId);\n  const conversationsById = useSelector(getConversationsById);\n  const conversations: ConversationFragment[] = useSelector(\n    getJoinedConversations\n  );\n  const currentConversationId: string = useSelector(getCurrentConversationId);\n  const members: UserFragment[] = useSelector(getCurrentConversationMembers);\n  const dispatch = useDispatch();\n  const openOverlay = () => {\n    dispatch(fetchSpaces());\n    dispatch(joinConversationViewDisplayed());\n  };\n\n  if (conversationsById === undefined) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <Wrapper>\n      <Title>\n        Conversations\n        <AddButton onClick={openOverlay}>\n          <AddIcon title=\"Join conversation\" />\n        </AddButton>\n      </Title>\n      <ConversationList>\n        {conversations.map(conversation => (\n          <ConversationItem\n            id={conversation.id}\n            name={conversation.name}\n            onLeave={() => {\n              dispatch(leaveConversation(currentUserId, conversation.id));\n            }}\n            selected={conversation.id === currentConversationId}\n            key={conversation.id}\n            unreadMessageCount={0}\n            onClick={() => {\n              dispatch(focusOnConversation(conversation.id));\n              dispatch(currentConversationViewDisplayed());\n              dispatch(menuViewHidden());\n\n              if (members.length === 0) {\n                dispatch(\n                  fetchMembers({\n                    spaceId: conversation.id,\n                    include: {\n                      userFields: true,\n                      customUserFields: true,\n                      totalCount: false\n                    }\n                  })\n                );\n              }\n            }}\n          ></ConversationItem>\n        ))}\n        <ConversationItem\n          id={currentUserId}\n          name=\"Direct Messages\"\n          onLeave={() => {}}\n          selected={currentUserId === currentConversationId}\n          key={currentUserId}\n          unreadMessageCount={0}\n          onClick={() => {\n            dispatch(focusOnConversation(currentUserId));\n            dispatch(currentConversationViewDisplayed());\n            dispatch(menuViewHidden());\n          }}\n        ></ConversationItem>\n      </ConversationList>\n    </Wrapper>\n  );\n};\n\nexport { MyConversations };\n","import { ThunkAction } from \"main/storeTypes\";\nimport { leaveSpaces } from \"pubnub-redux\";\nimport {\n  focusOnConversation,\n  DEFAULT_CONVERSATION\n} from \"features/currentConversation/currentConversationModel\";\n\n/**\n * Leave the current conversation and select the default conversation\n * as the current conversation.  (The application expects that some\n * conversation will always be current.)\n */\nexport const leaveConversation = (\n  userId: string,\n  conversationId: string\n): ThunkAction<Promise<void>> => {\n  return (dispatch, getState, context) => {\n    if (conversationId === DEFAULT_CONVERSATION) {\n      return Promise.resolve();\n    }\n    return dispatch(\n      leaveSpaces({\n        userId: userId,\n        spaces: [{ id: conversationId }]\n      })\n    ).then(() => {\n      context.pubnub.api.unsubscribe({\n        channels: [conversationId]\n      });\n      dispatch(focusOnConversation(DEFAULT_CONVERSATION));\n    });\n  };\n};\n","import styled from \"styled-components/macro\";\nimport { motion } from \"framer-motion\";\n\nexport const Wrapper = styled(motion.section)`\n  flex-direction: column;\n  z-index: 100;\n  width: 100%;\n  max-width: none;\n  background: ${({ theme }) => theme.backgrounds.primary};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    min-width: ${({ theme }) => theme.sizes[4]};\n    max-width: ${({ theme }) => theme.sizes[4]};\n  }\n`;\n\nexport const Controls = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n  position: absolute;\n  top: 0;\n  min-height: ${({ theme }) => theme.sizes[1]};\n  padding: ${({ theme }) => `${theme.space[6]}`};\n  width: 100%;\n`;\n\nexport const CloseIcon = styled.span`\n  cursor: pointer;\n  ${({ theme }) => theme.mediaQueries.medium} {\n    display: none;\n  }\n`;\n\nexport const Img = styled.img`\n  align-self: flex-end;\n  margin-top: auto;\n  max-width: 100%;\n`;\n\nexport const getAnimatedWrapperVariants = (\n  isMedium: boolean,\n  size: string\n) => ({\n  open: {\n    x: \"0%\",\n    display: \"flex\"\n  },\n  closed: {\n    x: isMedium ? `-${size}` : \"-100%\",\n    transitionEnd: {\n      display: \"none\"\n    }\n  }\n});\n","import React from \"react\";\n\nexport const LogoIcon = () => {\n  return (\n    <svg height=\"100%\" viewBox=\"0 0 60 60\">\n      <g\n        id=\"Team-Chat\"\n        stroke=\"none\"\n        strokeWidth={1}\n        fill=\"none\"\n        fillRule=\"evenodd\"\n      >\n        <rect\n          id=\"Rectangle\"\n          fill=\"#DE2440\"\n          x={0}\n          y={0}\n          width={60}\n          height={60}\n          rx={10}\n        />\n        <path\n          d=\"M17.8154297,40 L17.8154297,31.0058594 L21.8730469,31.0058594 C23.9726562,31.0058594 25.6108398,30.5493164 26.7875977,29.6362305 C27.9643555,28.7231445 28.5527344,27.2265625 28.5527344,25.1464844 C28.5527344,23.2128906 28.003418,21.8041992 26.9047852,20.9204102 C25.8061523,20.0366211 24.0556641,19.5947266 21.6533203,19.5947266 L21.6533203,19.5947266 L14.6074219,19.5947266 L14.6074219,40 L17.8154297,40 Z M21.2431641,28.5742188 L17.8154297,28.5742188 L17.8154297,22.0263672 L21.2431641,22.0263672 C22.6591797,22.0263672 23.6821289,22.2558594 24.3120117,22.7148438 C24.9418945,23.1738281 25.2568359,23.984375 25.2568359,25.1464844 C25.2568359,26.4648438 24.9272461,27.3657227 24.2680664,27.8491211 C23.6088867,28.3325195 22.6005859,28.5742188 21.2431641,28.5742188 L21.2431641,28.5742188 Z M35.0859375,40 L35.0859375,27.2558594 C35.3691406,27.1484375 35.8671875,27.0043945 36.5800781,26.8237305 C37.2929688,26.6430664 38.0791016,26.5527344 38.9384766,26.5527344 C40.2763672,26.5527344 41.2260742,26.8798828 41.7875977,27.5341797 C42.3491211,28.1884766 42.6298828,29.2236328 42.6298828,30.6396484 L42.6298828,30.6396484 L42.6298828,40 L45.75,40 L45.75,29.3212891 C45.75,27.6025391 45.1689453,26.3330078 44.0068359,25.5126953 C42.8447266,24.6923828 41.1845703,24.2822266 39.0263672,24.2822266 C38.2451172,24.2822266 37.4736328,24.3359375 36.7119141,24.4433594 C35.9501953,24.5507812 35.2495117,24.675293 34.6098633,24.8168945 C33.9702148,24.9584961 33.4208984,25.0976562 32.9619141,25.234375 L32.9619141,25.234375 L31.9804688,25.5419922 L31.9804688,40 L35.0859375,40 Z\"\n          id=\"Pn\"\n          fill=\"#FFFFFF\"\n          fillRule=\"nonzero\"\n        />\n      </g>\n    </svg>\n  );\n};\n","import React, { useContext } from \"react\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface PresenceIndicatorIconProps {\n  title: string;\n  active: boolean;\n  size: number;\n}\n\nexport const PresenceIndicatorIcon = ({\n  title,\n  active,\n  size\n}: PresenceIndicatorIconProps) => {\n  const theme = useContext(ThemeContext);\n  return (\n    <svg width={size} height={size}>\n      <title>{title}</title>\n      <circle\n        cx={size / 2}\n        cy={size / 2}\n        r={size / 2}\n        fill={active ? theme.colors.success : theme.colors.inactive}\n        fillRule=\"evenodd\"\n      />\n    </svg>\n  );\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.span<{ size: number }>`\n  height: ${({ size }) => size}px;\n  width: ${({ size }) => size}px;\n  display: flex;\n`;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { AppState } from \"main/storeTypes\";\nimport { PresenceIndicatorIcon } from \"foundations/components/icons/PresenceIndicatorIcon\";\nimport { Wrapper } from \"./NetworkStatus.style\";\n\ninterface NetworkStatusProps {\n  size: number;\n}\n\nconst NetworkStatus = ({ size }: NetworkStatusProps) => {\n  let isConnected: boolean = useSelector(\n    (state: AppState) => state.networkStatus.isConnected\n  );\n  return (\n    <Wrapper size={size}>\n      <PresenceIndicatorIcon\n        size={size}\n        title={isConnected ? \"connected\" : \"not connected\"}\n        active={isConnected}\n      />\n    </Wrapper>\n  );\n};\n\nexport { NetworkStatus };\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  align-items: center;\n  padding-bottom: 0px;\n  text-transform: capitalize;\n`;\n\nexport const UserName = styled.div`\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  color: ${({ theme }) => theme.colors.onPrimary};\n  padding-right: ${({ theme }) => theme.space[1]};\n`;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\nimport { getUsersById } from \"features/users/userModel\";\nimport { NetworkStatus } from \"../NetworkStatus\";\nimport { Wrapper, UserName } from \"./MyUserDetails.style\";\n\nexport interface MyUserDetailsFragment {\n  name: string;\n  profileUrl: string;\n  custom: {\n    title: string;\n  };\n}\n\nconst MyUserDetails = () => {\n  const userId = useSelector(getLoggedInUserId);\n  const usersById = useSelector(getUsersById);\n  const user = usersById[userId];\n\n  // We must always have a user; change this to a development time error check\n  if (user === undefined) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <Wrapper>\n      <UserName>{user.name}</UserName>\n      <NetworkStatus size={7} />\n    </Wrapper>\n  );\n};\n\nexport { MyUserDetails };\n","import React, { useContext } from \"react\";\nimport styled, { ThemeContext } from \"styled-components\";\nimport { LogoIcon } from \"./icons/LogoIcon\";\nimport { MyUserDetails } from \"features/currentUser/MyUserDetails\";\n\nconst Wrapper = styled.div`\n  display: flex;\n  align-items: center;\n  height: ${({ theme }) => theme.sizes[3]};\n  width: 100%;\n  padding: ${({ theme }) => theme.space[6]};\n  padding-bottom: 0px;\n`;\n\nconst Details = styled.div`\n  display: flex;\n  flex-direction: column;\n  padding-left: ${({ theme }) => theme.space[4]};\n  min-height: ${({ theme }) => theme.sizes[1]};\n  justify-content: space-between;\n`;\n\nconst CompanyName = styled.span`\n  color: ${({ theme }) => theme.colors.onPrimary};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n`;\n\nexport const Branding: React.FC = () => {\n  const theme = useContext(ThemeContext);\n  return (\n    <Wrapper>\n      <LogoIcon></LogoIcon>\n      <Details>\n        <CompanyName>{theme.custom.companyName}</CompanyName>\n        <MyUserDetails />\n      </Details>\n    </Wrapper>\n  );\n};\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport {\n  createMessageReducer,\n  Message as PubNubMessageEnvelope\n} from \"pubnub-redux\";\nimport { RtcCallSignalType } from \"features/rtc/RtcCallSignalType.enum\";\nimport { RtcIceSignalType } from \"features/rtc/RtcIceSignalType.enum\";\n\n/**\n * Define the types of messages that this application is designed to work with.\n *\n * This application only defines \"text\" messages, but you can add more here.\n */\nexport enum MessageType {\n  Text = \"text\",\n  RtcCall = \"rtc-signal\",\n  RtcIce = \"rtc-ice\"\n}\n\n/**\n * BaseMessage defines a structure that ALL messages that the application works should conform to.\n */\nexport interface BaseMessage {\n  /**\n   * An indicator of the type of this message, which must appear in the MessageType enum.\n   */\n  type: MessageType;\n\n  /**\n   * The user id of the user that sent this message\n   */\n  senderId: string;\n}\n\n/**\n * Defines a text message with a UTF-8 encoding\n */\nexport interface TextMessage extends BaseMessage {\n  /**\n   * type must be \"text\"\n   */\n  type: MessageType.Text;\n\n  /**\n   * The message content with a UTF-8 unicode encoding\n   */\n  text: string;\n}\n\n/**\n * RTC signal messages that manage call state\n */\nexport interface RtcCallMessage extends BaseMessage {\n  /**\n   * type must be \"rtc\"\n   */\n  type: MessageType.RtcCall;\n\n  /**\n   * call start time\n   */\n  startTime: number;\n\n  /**\n   * The message content with a UTF-8 unicode encoding\n   */\n  callSignalType: RtcCallSignalType;\n}\n\n/**\n * RTC signal messages that manage ICE negotiation\n */\nexport interface RtcIceMessage extends BaseMessage {\n  /**\n   * type must be \"rtc\"\n   */\n  type: MessageType.RtcIce;\n\n  /**\n   * call start time\n   */\n  startTime: number;\n\n  /**\n   * The message content with a UTF-8 unicode encoding\n   */\n  iceSignalType: RtcIceSignalType;\n\n  offer?: RTCSessionDescription;\n  answer?: RTCSessionDescription;\n  candidate?: RTCIceCandidate | null;\n}\n\n/**\n * This is a union of all of the message types that the application works with.\n *\n * To add a new message type, add a new type identifier to the MessageType enum.\n *\n *    MyCustomMessageType = \"my-custom-message-type\",\n *\n * Then declare a new message type that extends BaseMessage that uses the enum\n *\n *     export interface MyCustomMessage extends BaseMessage {\n *       type: MessageType.MyCustomMessageType;\n *       myField: string;\n *     }\n *\n * Then add that type to this AppMessage union type\n *    export type AppMessage = TextMessage | MyCustomMessage;\n *\n * You will also need to modify the application to work with your new message type.\n * Using your IDE to find references to AppMessage will help find those areas you\n * need to modify.\n */\nexport type AppMessage = TextMessage | RtcCallMessage | RtcIceMessage;\n\n/**\n * Customize the PubNub message envelope declaration to include our custom message types\n * and define which fields from the envelope this application will have access to.\n *\n * Fields that are not included in this list may appear in the data but will be ignored by\n * the application.  To remove the fields entirely (for example to use less memory),\n *  use a filter on the incoming messages from subscribe.\n */\nexport type MessageEnvelope = Required<\n  Pick<PubNubMessageEnvelope, \"channel\" | \"message\" | \"timetoken\">\n> & {\n  message: AppMessage;\n};\n\n/**\n * create a reducer which holds all known messsage envelope objects in a normalized form\n */\nexport const MessageStateReducer = createMessageReducer<MessageEnvelope>();\n\n/**\n * THis Slice selector is used internally to access the state of the reducer,\n * primarily as the base selector function for creating other selectors.\n */\nconst getMessagesSlice = (state: AppState) => state.messages;\n\n/**\n * Returns an index which can be used to find user objects\n */\nexport const getMessagesById = createSelector([getMessagesSlice], messages => {\n  return messages.byId;\n});\n","import React, { useRef, useContext } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { getViewStates } from \"features/layout/Selectors\";\nimport { MyConversations } from \"features/joinedConversations/MyConversations/MyConversations\";\nimport {\n  Wrapper,\n  Controls,\n  CloseIcon,\n  getAnimatedWrapperVariants\n} from \"./Menu.style\";\nimport { ThemeContext } from \"styled-components\";\nimport { useMediaQuery } from \"foundations/hooks/useMediaQuery\";\nimport { Branding } from \"foundations/components/Branding\";\nimport { CrossIcon } from \"foundations/components/icons/CrossIcon\";\nimport { menuViewHidden } from \"features/layout/LayoutActions\";\n\nconst Menu = () => {\n  const view = useRef<HTMLElement>(null);\n  const views = useSelector(getViewStates);\n  const theme = useContext(ThemeContext);\n  const isMedium = useMediaQuery(theme.mediaQueries.medium);\n  const dispatch = useDispatch();\n\n  return (\n    <Wrapper\n      ref={view}\n      animate={views.Menu || isMedium ? \"open\" : \"closed\"}\n      variants={getAnimatedWrapperVariants(isMedium, theme.sizes[4])}\n    >\n      <Controls>\n        <CloseIcon onClick={() => dispatch(menuViewHidden())}>\n          <CrossIcon\n            color={theme.colors.onPrimary}\n            title=\"close conversations\"\n          />\n        </CloseIcon>\n      </Controls>\n      <Branding></Branding>\n      <MyConversations />\n    </Wrapper>\n  );\n};\n\nexport { Menu };\n","import styled from \"styled-components/macro\";\nimport { motion } from \"framer-motion\";\n\nexport const Wrapper = styled(motion.section)`\n  display: flex;\n  flex-direction: column;\n  position: fixed;\n  z-index: 0;\n  margin: ${({ theme }) => theme.space[0]};\n  width: 100%;\n  height: 100%;\n  background: ${({ theme }) => theme.backgrounds.content};\n  border: ${({ theme }) =>\n    `${theme.borders.light} ${theme.colors.borderLight}`};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    position: static;\n  }\n`;\n\nexport const Body = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin: ${({ theme }) => theme.space[5]};\n  margin-top: ${({ theme }) => theme.space[0]};\n  height: 100%;\n`;\n\nexport const animatedWrapperVariants = {\n  open: {\n    display: \"flex\"\n  },\n  closed: {\n    transitionEnd: {\n      display: \"none\"\n    }\n  }\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-shrink: 0;\n  padding: ${({ theme }) => `${theme.space[1]} ${theme.space[5]}`};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    padding: ${({ theme }) => `${theme.space[1]} ${theme.space[6]}`};\n  }\n  :hover {\n    background-color: ${({ theme }) => theme.backgrounds.contentHover};\n  }\n  :first-child {\n    margin-top: auto;\n  }\n  :last-child {\n    padding-bottom: ${({ theme }) => theme.space[4]};\n  }\n`;\n\nexport const Body = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-left: ${({ theme }) => theme.space[5]};\n`;\n\nexport const Header = styled.div`\n  margin: ${({ theme }) => theme.space[0]};\n  margin-bottom: ${({ theme }) => theme.space[1]};\n`;\n\nexport const Content = styled.div`\n  white-space: pre-wrap;\n  width: fit-content;\n  padding: ${({ theme }) => theme.space[5]};\n  font-size: ${({ theme }) => theme.fontSizes.small};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  border-radius: ${({ theme }) => theme.radii.strong};\n  border-top-left-radius: ${({ theme }) => theme.radii.square};\n  text-align: left;\n  background: ${({ theme }) => theme.backgrounds.message};\n  color: ${({ theme }) => theme.colors.messageText};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    font-size: ${({ theme }) => theme.fontSizes.regular};\n  }\n`;\n\nexport const Avatar = styled.div`\n  width: ${({ theme }) => theme.sizes[1]};\n  height: ${({ theme }) => theme.sizes[1]};\n`;\n\nexport const SenderName = styled.span<{ showDetails: boolean }>`\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  text-transform: capitalize;\n  color: ${({ theme }) => theme.colors.importantText};\n  cursor: ${({ theme, showDetails }) => (showDetails ? \"pointer\" : \"default\")};\n  &:hover {\n    text-decoration: ${({ theme, showDetails }) =>\n      showDetails ? \"underline\" : \"default\"};\n  }\n`;\n\nexport const TimeSent = styled.span`\n  font-size: ${({ theme }) => theme.fontSizes.small};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.light};\n  margin-left: ${({ theme }) => theme.space[3]};\n  color: ${({ theme }) => theme.colors.importantText};\n`;\n","import styled from \"styled-components/macro\";\n\nexport const Content = styled.div`\n  white-space: pre-wrap;\n  border-radius: ${({ theme }) => theme.radii.strong};\n  border-top-left-radius: ${({ theme }) => theme.radii.square};\n  padding: ${({ theme }) => theme.space[4]};\n  width: fit-content;\n  line-height: 1.5;\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  text-align: left;\n  background: ${({ theme }) => theme.backgrounds.message};\n  box-shadow: ${({ theme }) => theme.shadows[0]};\n  color: ${({ theme }) => theme.colors.messageText};\n`;\n","import React from \"react\";\nimport { Content } from \"./TextMessageDisplay.style\";\nimport { TextMessage } from \"../messageModel\";\n\ntype TextMessageProps = {\n  message: TextMessage;\n};\n\n/**\n * Display a TextMessage such as it would appear in a list of messages\n */\nexport const TextMessageDisplay = ({ message }: TextMessageProps) => {\n  return <Content>{message.text}</Content>;\n};\n","import styled from \"styled-components/macro\";\n\nexport const Content = styled.div`\n  white-space: pre-wrap;\n  border-radius: ${({ theme }) => theme.radii.strong};\n  border-top-left-radius: ${({ theme }) => theme.radii.square};\n  padding: ${({ theme }) => theme.space[4]};\n  width: fit-content;\n  line-height: 1.5;\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  text-align: left;\n  background: ${({ theme }) => theme.backgrounds.message};\n  box-shadow: ${({ theme }) => theme.shadows[0]};\n  color: ${({ theme }) => theme.colors.messageText};\n`;\n","import { Dispatch } from \"redux\";\nimport { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { createSignalReducer, Signal } from \"pubnub-redux\";\nimport { SignalActionType, PresenceCategory } from \"pubnub-redux\";\nimport { AppActions } from \"main/AppActions\";\nimport { SignalState } from \"pubnub-redux/dist/features/signal/SignalReducer\";\nimport { MessageActionType } from \"pubnub-redux\";\nimport { PresenceEventMessage } from \"pubnub-redux/dist/features/presence/PresenceActions\";\n\nexport const TYPING_INDICATOR_DURATION_SECONDS = 10;\n\nexport enum TypingIndicatorType {\n  ShowTypingIndicator = \"ti_show\",\n  HideTypingIndicator = \"ti_hide\"\n}\n\nexport enum TypingIndicatorActionType {\n  REMOVE_TYPING_INDICATOR = \"REMOVE_TYPING_INDICATOR\",\n  REMOVE_TYPING_INDICATOR_ALL = \"REMOVE_TYPING_INDICATOR_ALL\"\n}\n\nexport interface TypingIndicator extends Signal {\n  type: TypingIndicatorType;\n}\n\nexport type TypingIndicatorEnvelope = Required<\n  Pick<Signal, \"channel\" | \"message\" | \"timetoken\" | \"publisher\">\n> & {\n  message: TypingIndicator;\n};\n\nconst signalReducer = createSignalReducer<TypingIndicatorEnvelope>();\n\nconst defaultState = { byId: {} };\n\nconst removeTypingIndicator = (\n  state: SignalState<TypingIndicatorEnvelope>,\n  channel: string,\n  userId: string,\n  timetoken?: number\n): SignalState<TypingIndicatorEnvelope> => {\n  let newState = {\n    byId: { ...state.byId }\n  };\n\n  if (newState.byId[channel]) {\n    newState.byId[channel] = newState.byId[channel].filter(signal =>\n      timetoken\n        ? !(signal.publisher === userId && signal.timetoken === timetoken)\n        : !(signal.publisher === userId)\n    );\n  }\n\n  return newState;\n};\n\n/**\n * create a reducer which holds all typing indicator signal objects in a normalized form\n */\nexport const TypingIndicatorStateReducer = (\n  state: SignalState<TypingIndicatorEnvelope>,\n  action: AppActions\n): SignalState<TypingIndicatorEnvelope> => {\n  switch (action.type) {\n    case SignalActionType.SIGNAL_RECEIVED:\n      if (\n        action.payload.message.type === TypingIndicatorType.ShowTypingIndicator\n      ) {\n        // we only want to store the show typing indicator signals\n        // the hide signal is handled by the listener below\n        return signalReducer(state, action);\n      }\n\n      return state || defaultState;\n    case TypingIndicatorActionType.REMOVE_TYPING_INDICATOR:\n      return removeTypingIndicator(\n        state,\n        action.payload.channel,\n        action.payload.userId,\n        action.payload.timetoken\n      );\n    case TypingIndicatorActionType.REMOVE_TYPING_INDICATOR_ALL:\n      return removeTypingIndicator(\n        state,\n        action.payload.channel,\n        action.payload.userId\n      );\n    case MessageActionType.MESSAGE_RECEIVED:\n      return removeTypingIndicator(\n        state,\n        action.payload.channel,\n        action.payload.message.senderId\n      );\n    default:\n      return state || defaultState;\n  }\n};\n\nexport interface RemoveTypingIndicatorPayload {\n  userId: string;\n  channel: string;\n  timetoken: number;\n}\n\nexport interface RemoveTypingIndicatorAllPayload {\n  userId: string;\n  channel: string;\n}\n\nexport interface RemoveTypingIndicatorAction {\n  type: typeof TypingIndicatorActionType.REMOVE_TYPING_INDICATOR;\n  payload: RemoveTypingIndicatorPayload;\n}\n\nexport interface RemoveTypingIndicatorAllAction {\n  type: typeof TypingIndicatorActionType.REMOVE_TYPING_INDICATOR_ALL;\n  payload: RemoveTypingIndicatorAllPayload;\n}\n\n/**\n * This Slice selector is used internally to access the state of the reducer,\n * primarily as the base selector function for creating other selectors.\n */\nconst getTypingIndicatorsSlice = (\n  state: AppState\n): SignalState<TypingIndicatorEnvelope> => state.typingIndicators;\n\n/**\n * Returns an index which can be used to find signal objects\n */\nexport const getTypingIndicatorsById = createSelector(\n  [getTypingIndicatorsSlice],\n  typingIndicators => {\n    return typingIndicators.byId;\n  }\n);\n\nexport const typingIndicatorRemoved = (\n  payload: RemoveTypingIndicatorPayload\n): RemoveTypingIndicatorAction => ({\n  type: TypingIndicatorActionType.REMOVE_TYPING_INDICATOR,\n  payload\n});\n\nexport const typingIndicatorRemovedAll = (\n  payload: RemoveTypingIndicatorAllPayload\n): RemoveTypingIndicatorAllAction => ({\n  type: TypingIndicatorActionType.REMOVE_TYPING_INDICATOR_ALL,\n  payload\n});\n\n/**\n * This listener will initiate a timer to dispatch a RemoveTypingIndicatorAction once the\n * TYPING_INDICATOR_DURATION_SECONDS time is passed\n */\nexport const createTypingIndicatorsListener = (\n  dispatch: Dispatch<AppActions>\n): any => ({\n  signal: (payload: TypingIndicatorEnvelope) => {\n    if (payload.message.type === TypingIndicatorType.ShowTypingIndicator) {\n      // hide indicator after display seconds\n      setTimeout(() => {\n        dispatch(\n          typingIndicatorRemoved({\n            userId: payload.publisher,\n            channel: payload.channel,\n            timetoken: payload.timetoken\n          })\n        );\n      }, TYPING_INDICATOR_DURATION_SECONDS * 1000);\n    } else if (\n      payload.message.type === TypingIndicatorType.HideTypingIndicator\n    ) {\n      // hide indicator now, removes all for user regardless of time token\n      dispatch(\n        typingIndicatorRemovedAll({\n          userId: payload.publisher,\n          channel: payload.channel\n        })\n      );\n    }\n  },\n  presence: (payload: PresenceEventMessage) => {\n    if (\n      payload.action === PresenceCategory.LEAVE ||\n      payload.action === PresenceCategory.TIMEOUT\n    ) {\n      dispatch(\n        typingIndicatorRemovedAll({\n          userId: payload.uuid,\n          channel: payload.channel\n        })\n      );\n    }\n  }\n});\n","import React from \"react\";\nimport { Content } from \"./RtcMessageDisplay.style\";\nimport { RtcIceMessage, RtcCallMessage, MessageType } from \"../messageModel\";\n\ntype RtcMessageProps = {\n  message: RtcIceMessage | RtcCallMessage;\n};\n\n/**\n * Display a Rtc messages\n */\nexport const RtcMessageDisplay = ({ message }: RtcMessageProps) => {\n  if (message.type === MessageType.RtcIce) {\n    return (\n      <Content>\n        Ice - {message.iceSignalType} - {JSON.stringify(message)}\n      </Content>\n    );\n  } else {\n    return (\n      <Content>\n        Signal - from: {message.senderId} - {message.callSignalType} -\n        startTime: {message.startTime}\n      </Content>\n    );\n  }\n};\n","import React from \"react\";\nimport invariant from \"invariant\";\nimport { TextMessageDisplay } from \"features/messages/TextMessageDisplay\";\nimport { RtcMessageDisplay } from \"features/messages/RtcMessageDisplay\";\nimport { MessageType, AppMessage } from \"features/messages/messageModel\";\n\ntype MessageProps = {\n  message: AppMessage;\n};\n\n/**\n * Display a Message based on its type\n */\nexport const MessageDisplay = ({ message }: MessageProps) => {\n  switch (message.type) {\n    case MessageType.Text:\n      return <TextMessageDisplay message={message}></TextMessageDisplay>;\n    case MessageType.RtcIce:\n    case MessageType.RtcCall:\n      return <RtcMessageDisplay message={message}></RtcMessageDisplay>;\n    default:\n      invariant(\n        false,\n        `No component available for displaying message of type \"${\n          (message as any).type\n        }\"`\n      );\n  }\n};\n","import React, { ReactNode } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport convertTimestampToTime from \"foundations/utilities/convertTimestampToTime\";\nimport {\n  Wrapper,\n  Body,\n  Header,\n  Avatar,\n  SenderName,\n  TimeSent\n} from \"./MessageListItem.style\";\nimport { MessageDisplay } from \"features/messages/MessageDisplay\";\nimport { AppMessage } from \"features/messages/messageModel\";\nimport { getUsersById } from \"features/users/userModel\";\nimport { userDetailViewDisplayed } from \"../../layout/LayoutActions\";\nimport { selectUser } from \"../../userDetail/userDetailModel\";\n\n// TODO: Explain message fragment\nexport interface MessageFragment {\n  sender: {\n    id: string;\n    name: string;\n  };\n  timetoken: string;\n  message: AppMessage;\n}\n\ninterface MessageProps {\n  messageFragment: MessageFragment;\n  avatar: ReactNode;\n}\n\n/**\n * Display a message as it appears in a list\n */\nconst MessageListItem = ({ messageFragment, avatar }: MessageProps) => {\n  const dispatch = useDispatch();\n  let sender = messageFragment.sender;\n  const usersById = useSelector(getUsersById);\n  let hasSender = false;\n\n  const openUserDetailsOverlay = () => {\n    if (hasSender) {\n      // don't open overlay for PubNub Bot\n      dispatch(selectUser(messageFragment.sender.id));\n      dispatch(userDetailViewDisplayed());\n    }\n  };\n\n  if (messageFragment.sender && messageFragment.sender.id) {\n    const user = usersById[messageFragment.sender.id];\n    hasSender = user !== undefined;\n  }\n  return (\n    <Wrapper>\n      <Avatar>{avatar}</Avatar>\n      <Body>\n        <Header>\n          <SenderName showDetails={hasSender} onClick={openUserDetailsOverlay}>\n            {sender.name}\n          </SenderName>\n          <TimeSent>\n            {convertTimestampToTime(messageFragment.timetoken)}\n          </TimeSent>\n        </Header>\n        <MessageDisplay message={messageFragment.message}></MessageDisplay>\n      </Body>\n    </Wrapper>\n  );\n};\n\nexport { MessageListItem };\n","export default (ts: string) => {\n  const date = new Date(parseInt(ts) / 10000);\n  const minutes = date.getMinutes();\n  return `${date.getHours()}:${minutes > 9 ? minutes : \"0\" + minutes}`;\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  flex-grow: 1;\n  flex-direction: column;\n  overflow-y: scroll;\n  height: 100%;\n`;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { UserInitialsAvatar } from \"foundations/components/UserInitialsAvatar\";\nimport { MessageListItem, MessageFragment } from \"../MessageListItem\";\nimport { MessageType } from \"features/messages/messageModel\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\nimport { getUsersById } from \"features/users/userModel\";\n\nconst capitalize = (string: string): string => {\n  return string\n    .split(\" \")\n    .map(token => token.charAt(0).toUpperCase() + token.slice(1))\n    .join(\" \");\n};\n\nconst welcome = (name: string): MessageFragment => ({\n  sender: {\n    id: \"PUBNUB-BOT\",\n    name: \"PubNub Bot\"\n  },\n  timetoken: \"15735897955841496\",\n  message: {\n    type: MessageType.Text,\n    senderId: \"PUBNUB-BOT\",\n    text: `Welcome to Team Chat. 👋👋 \\nWe logged you in as ${capitalize(\n      name\n    )}. \\nSend a message now to start interacting with other users in the app. ⬇️`\n  }\n});\n\nconst WelcomeMessage = () => {\n  const userId = useSelector(getLoggedInUserId);\n  const usersById = useSelector(getUsersById);\n  const user = usersById[userId];\n  const welcomeMessage = welcome(user.name);\n  return (\n    <MessageListItem\n      messageFragment={welcomeMessage}\n      key={welcomeMessage.timetoken}\n      avatar={\n        <UserInitialsAvatar\n          size={36}\n          name=\"P N\"\n          userId={welcomeMessage.sender.id}\n          color=\"#DE2440\"\n        />\n      }\n    />\n  );\n};\n\nexport default WelcomeMessage;\n","import React, { useRef, useEffect, useState, useCallback } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { createSelector } from \"reselect\";\nimport { MessageListItem, MessageFragment } from \"../MessageListItem\";\nimport { getCurrentConversationId } from \"../currentConversationModel\";\nimport { getUsersById } from \"features/users/userModel\";\nimport { getMessagesById } from \"features/messages/messageModel\";\nimport { Wrapper } from \"./MessageList.style\";\nimport WelcomeMessage from \"./WelcomeMessage\";\nimport { UserInitialsAvatar } from \"foundations/components/UserInitialsAvatar\";\n\n/**\n * Create a selector that that returns the list of messages in the currentConversation joined\n * to the user that sent that message\n *\n * TODO:\n * This implementation will cause the dependant component to re-render if any user data has changed\n * if the current conversation has changed or if any message has changed or if any user has changed.\n * This needs to be reduced in scope\n *\n * TODO: This needs to sort by time token; object keys are not guarenteed to retain order in js.\n */\nexport const getCurrentConversationMessages = createSelector(\n  [getMessagesById, getCurrentConversationId, getUsersById],\n  (messages, conversationId, users): MessageFragment[] => {\n    return messages[conversationId]\n      ? Object.values(messages[conversationId])\n          .filter(message => message.channel === conversationId)\n          .map(\n            (message): MessageFragment => {\n              return {\n                ...message,\n                timetoken: String(message.timetoken),\n                sender:\n                  users[message.message.senderId] ||\n                  (message.message.senderId\n                    ? {\n                        id: message.message.senderId,\n                        name: message.message.senderId\n                      }\n                    : {\n                        id: \"unknown\",\n                        name: \"unknown\"\n                      })\n              };\n            }\n          )\n      : [];\n  }\n);\n\nconst MessageList = () => {\n  type ConversationScrollPositionsType = { [conversationId: string]: number };\n  const conversationId: string = useSelector(getCurrentConversationId);\n  const [\n    conversationsScrollPositions,\n    setConversationsScrollPositions\n  ] = useState<ConversationScrollPositionsType>({});\n\n  const updateCurrentConversationScrollPosition = (scrollPosition: number) => {\n    setConversationsScrollPositions({\n      ...conversationsScrollPositions,\n      [conversationId]: scrollPosition\n    });\n  };\n\n  const handleScroll = (e: any) => {\n    const scrollPosition = e.target.scrollTop;\n    if (scrollPosition !== 0) {\n      updateCurrentConversationScrollPosition(scrollPosition);\n    }\n  };\n\n  const restoreConversationScrollPosition = (conversationId: string) => {\n    const conversationScrollPosition: number =\n      conversationsScrollPositions[conversationId];\n    if (conversationScrollPosition) {\n      wrapper.current.scrollTo(0, conversationScrollPosition);\n    }\n  };\n\n  const memoizedRestoreConversationScrollPositionCallback = useCallback(\n    restoreConversationScrollPosition,\n    [conversationId]\n  );\n\n  const messages: MessageFragment[] = useSelector(\n    getCurrentConversationMessages\n  );\n  const wrapper = useRef<HTMLDivElement>(document.createElement(\"div\"));\n  const el = wrapper.current;\n\n  const scrollToBottom = useCallback(() => {\n    return (el.scrollTop = el.scrollHeight - el.clientHeight);\n  }, [el]);\n\n  const hasReachedBottom = el.scrollHeight - el.clientHeight === el.scrollTop;\n\n  useEffect(() => {\n    if (hasReachedBottom) {\n      scrollToBottom();\n    }\n  }, [messages.length, hasReachedBottom, scrollToBottom]);\n\n  useEffect(() => {\n    memoizedRestoreConversationScrollPositionCallback(conversationId);\n  }, [memoizedRestoreConversationScrollPositionCallback, conversationId]);\n\n  return (\n    <Wrapper ref={wrapper} onScroll={handleScroll}>\n      <WelcomeMessage />\n      {messages.map(message => (\n        <MessageListItem\n          messageFragment={message}\n          key={message.timetoken}\n          avatar={\n            <UserInitialsAvatar\n              size={36}\n              name={message.sender.name}\n              userId={message.sender.id}\n            />\n          }\n        />\n      ))}\n    </Wrapper>\n  );\n};\n\nexport { MessageList };\n","import { AppState } from \"main/storeTypes\";\nimport { AppActions } from \"main/AppActions\";\nimport { createSelector } from \"reselect\";\nimport { DraftMessage } from \"features/messages/draft\";\n\nexport const MESSAGE_DRAFT_UPDATED = \"MESSAGE_DRAFT_UPDATED\";\nexport const MESSAGE_DRAFT_DISCARDED = \"MESSAGE_DRAFT_DISCARDED\";\n\nexport interface MessageDraftUpdatedAction {\n  type: typeof MESSAGE_DRAFT_UPDATED;\n  payload: {\n    conversationId: string;\n    value: DraftMessage;\n  };\n}\n\nexport interface MessageDraftDiscardedAction {\n  type: typeof MESSAGE_DRAFT_DISCARDED;\n  payload: {\n    conversationId: string;\n  };\n}\n\n/**\n * Describes a way to lookup a user from a userId\n */\nexport type DraftsIndex = { [id: string]: DraftMessage };\n\nexport interface ConversationDraftState {\n  messageDraftById: DraftsIndex;\n}\n\nconst initialState: ConversationDraftState = {\n  messageDraftById: {}\n};\n\nexport const ConversationDraftStateReducer = (\n  state: ConversationDraftState = initialState,\n  action: AppActions\n): ConversationDraftState => {\n  switch (action.type) {\n    case MESSAGE_DRAFT_UPDATED: {\n      const messageDraftById = {\n        ...state.messageDraftById,\n        [action.payload.conversationId]: action.payload.value\n      };\n      return {\n        ...state,\n        messageDraftById\n      };\n    }\n    case MESSAGE_DRAFT_DISCARDED: {\n      const {\n        [action.payload.conversationId]: discard,\n        ...messageDraftById\n      } = state.messageDraftById;\n      return {\n        ...state,\n        messageDraftById\n      };\n    }\n  }\n  return state;\n};\n\nconst getDraftSlice = (state: AppState) => state.drafts;\n\n/**\n * Returns an index which can be used to find user objects\n */\nexport const getMessageDrafts = createSelector(\n  [getDraftSlice],\n  (drafts): DraftsIndex => {\n    return drafts.messageDraftById;\n  }\n);\n","import { ThunkAction } from \"main/storeTypes\";\nimport { getCurrentConversationId } from \"features/currentConversation/currentConversationModel\";\nimport { sendSignal } from \"pubnub-redux\";\nimport { TypingIndicatorType } from \"./typingIndicatorModel\";\n\n/**\n * Send a typing indicator to the current conversation\n *\n * This command does not handle failure and leaves the error to the caller\n */\nexport const sendTypingIndicator = (\n  typingIndicatorType: TypingIndicatorType\n): ThunkAction => {\n  return (dispatch, getState) => {\n    const state = getState();\n    return dispatch(\n      sendSignal({\n        channel: getCurrentConversationId(state),\n        message: { type: typingIndicatorType }\n      })\n    );\n  };\n};\n","import { useEffect, useCallback, RefObject } from \"react\";\n\nconst isRefArray = (\n  r: RefObject<any> | RefObject<any>[]\n): r is RefObject<any>[] => {\n  return \"length\" in r;\n};\n\nconst isTarget = (ref: RefObject<any>, event: MouseEvent) => {\n  return ref && ref.current && ref.current.contains(event.target);\n};\n\nconst trueForAny = (array: any[], condition: (props: any) => boolean) => {\n  return array.reduce((conditionAlreadyMet, value) => {\n    return conditionAlreadyMet || condition(value);\n  }, false);\n};\n\nconst useClickOutside = (\n  ref: RefObject<any> | RefObject<any>[],\n  onclick: () => void\n) => {\n  const handleClick = useCallback(\n    (click: MouseEvent) => {\n      if (isRefArray(ref)) {\n        if (trueForAny(ref, (ref: RefObject<any>) => isTarget(ref, click))) {\n          return;\n        }\n      } else {\n        if (isTarget(ref, click)) {\n          return;\n        }\n      }\n      onclick();\n    },\n    [onclick, ref]\n  );\n\n  useEffect(() => {\n    document.addEventListener(\"click\", handleClick);\n\n    return () => {\n      document.removeEventListener(\"click\", handleClick);\n    };\n  }, [handleClick]);\n\n  return ref;\n};\n\nexport default useClickOutside;\n","import React, { useContext } from \"react\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface FunnyEmojiProps {\n  title: string;\n}\n\nexport const FunnyEmojiIcon = ({ title }: FunnyEmojiProps) => {\n  const theme = useContext(ThemeContext);\n  return (\n    <svg width={18} height={18}>\n      <title>{title}</title>\n      <g fill={theme.colors.importantText} fillRule=\"evenodd\">\n        <path d=\"M9 .947C4.56.947.947 4.56.947 9c0 4.441 3.613 8.053 8.053 8.053 4.44 0 8.053-3.612 8.053-8.053C17.053 4.56 13.44.947 9 .947M9 18a8.943 8.943 0 01-6.364-2.636A8.937 8.937 0 010 9.001c0-2.404.936-4.664 2.636-6.364A8.939 8.939 0 019 0a8.94 8.94 0 016.364 2.637A8.94 8.94 0 0118 9a8.94 8.94 0 01-2.636 6.363A8.942 8.942 0 019 18\" />\n        <path d=\"M13.957 6.632h-3.282a1.877 1.877 0 01-.217-1.32l.003-.01c.04-.199.112-.389.215-.565h3.282c.167.287.253.61.253.947 0 .337-.087.66-.253.948zm-6.631 0H4.043a1.877 1.877 0 01-.253-.948c0-.336.087-.661.253-.947h3.283c.102.176.174.366.215.564l.003.012a1.886 1.886 0 01-.217 1.319h-.001zm7.263-2.654a.473.473 0 00-.379-.19h-3.789a.475.475 0 00-.379.19 2.833 2.833 0 00-.406.758h-1.27a2.841 2.841 0 00-.408-.759.473.473 0 00-.38-.19H3.79a.475.475 0 00-.379.19 2.817 2.817 0 00-.568 1.706c0 .622.197 1.211.568 1.706.09.12.23.19.38.19h3.789c.149 0 .289-.07.379-.19a2.816 2.816 0 00.568-1.705h.948c0 .62.197 1.21.568 1.706.09.12.23.19.379.19h3.79c.148 0 .288-.07.378-.19a2.816 2.816 0 00.569-1.705c0-.62-.197-1.21-.569-1.706v-.001zM9 15.158a6.162 6.162 0 01-6.074-5.133.474.474 0 01.935-.157 5.192 5.192 0 005.138 4.342c.916 0 1.817-.241 2.605-.698a.474.474 0 01.475.82A6.158 6.158 0 019 15.156v.002z\" />\n      </g>\n    </svg>\n  );\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  align-self: flex-end;\n`;\n\nexport const Dialog = styled.div`\n  position: absolute;\n  bottom: 0;\n  right: 0;\n`;\n\nexport const EmojiButton = styled.div`\n  cursor: pointer;\n  svg {\n    vertical-align: top;\n  }\n`;\n","import \"emoji-mart/css/emoji-mart.css\";\nimport React, { useState, useCallback, useRef, useContext } from \"react\";\nimport useClickOutside from \"foundations/hooks/useClickOutside\";\nimport { Picker, EmojiData } from \"emoji-mart\";\nimport { FunnyEmojiIcon } from \"foundations/components/icons/FunnyEmojiIcon\";\nimport { Wrapper, Dialog, EmojiButton } from \"./EmojiInput.style\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface EmojiInputProps {\n  value: string;\n  onSelection(contentWithEmoji: string): any;\n}\n\nconst EmojiInput = ({ value, onSelection }: EmojiInputProps) => {\n  const [showPicker, setPickerState] = useState(false);\n  const picker = useRef<HTMLDivElement>(null);\n\n  const theme = useContext(ThemeContext);\n\n  const dismissPicker = useCallback(() => {\n    setPickerState(false);\n  }, [setPickerState]);\n\n  useClickOutside([picker], dismissPicker);\n\n  const togglePicker = () => {\n    setPickerState(!showPicker);\n  };\n\n  const addEmoji = (emoji: EmojiData) => {\n    if (\"native\" in emoji) {\n      onSelection(`${value}${emoji.native}`);\n      dismissPicker();\n    }\n  };\n\n  return (\n    <Wrapper ref={picker}>\n      <Dialog>\n        {showPicker && (\n          <Picker\n            emoji=\"\"\n            title=\"\"\n            native={true}\n            onSelect={addEmoji}\n            darkMode={theme.custom.dark}\n            color={theme.colors.active}\n          />\n        )}\n      </Dialog>\n      <EmojiButton onClick={togglePicker}>\n        <FunnyEmojiIcon title=\"Open emoji selector\" />\n      </EmojiButton>\n    </Wrapper>\n  );\n};\n\nexport { EmojiInput };\n","import styled from \"styled-components/macro\";\n\nexport const Popup = styled.div`\n  position: relative;\n`;\n\nexport const Suggestions = styled.section`\n  position: absolute;\n  bottom: 0;\n  overflow-y: scroll;\n  z-index: 100;\n  max-height: ${({ theme }) => theme.sizes[4]};\n  border: ${({ theme }) =>\n    `${theme.borders.light} ${theme.colors.borderLight}`};\n  border-radius: ${({ theme }) => theme.radii.light};\n  color: ${({ theme }) => theme.colors.importantText};\n`;\n\nexport const Heading = styled.div`\n  border-top-left-radius: ${({ theme }) => theme.radii.light};\n  border-top-right-radius: ${({ theme }) => theme.radii.light};\n  border-bottom: ${({ theme }) =>\n    `${theme.borders.light} ${theme.colors.borderLight}`};\n  padding: ${({ theme }) => theme.space[1]};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  background: ${({ theme }) => theme.backgrounds.panel};\n`;\n\nexport const EmojiSearchTerm = styled.span`\n  font-weight: ${({ theme }) => theme.fontWeights.bold};\n`;\n\nexport const Results = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n  border-bottom-left-radius: ${({ theme }) => theme.radii.light};\n  border-bottom-right-radius: ${({ theme }) => theme.radii.light};\n  padding: ${({ theme }) => theme.space[1]};\n  background: ${({ theme }) => theme.backgrounds.panel};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    flex-direction: column;\n    flex-wrap: nowrap;\n  }\n`;\n\nexport const Result = styled.span`\n  cursor: pointer;\n  flex-grow: 0;\n  border-radius: ${({ theme }) => theme.radii.light};\n  padding: ${({ theme }) => `${theme.space[1]} ${theme.space[2]}`};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  &:hover {\n    background-color: ${({ theme }) => theme.colors.active};\n    color: ${({ theme }) => theme.colors.activeText};\n  }\n  ${({ theme }) => theme.mediaQueries.medium} {\n    padding: ${({ theme }) => theme.space[2]};\n    flex-grow: 1;\n  }\n`;\n\nexport const Emoji = styled.span`\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n`;\n\nexport const Colons = styled.span`\n  padding-right: 0.5em;\n  font-size: ${({ theme }) => theme.fontSizes.small};\n`;\n","import \"emoji-mart/css/emoji-mart.css\";\nimport React, { useRef, useContext } from \"react\";\nimport useClickOutside from \"foundations/hooks/useClickOutside\";\nimport { emojiIndex, EmojiData } from \"emoji-mart\";\nimport {\n  Popup,\n  Suggestions,\n  Heading,\n  EmojiSearchTerm,\n  Results,\n  Result,\n  Emoji,\n  Colons\n} from \"./EmojiSuggestion.style\";\nimport { ThemeContext } from \"styled-components\";\nimport { useMediaQuery } from \"foundations/hooks/useMediaQuery\";\n\ntype EmojiInputProps = {\n  value: string;\n  onSelection(contentWithEmoji: string): any;\n};\n\nconst getEmojisFromEmojiSearchTerm = (emojiSearchTerm: string) =>\n  (emojiIndex.search(emojiSearchTerm) as any) as EmojiData[];\n\nconst getEmojiSearchTerm = (content: string) => {\n  // I don't think this is cross browser - haven't for a better way to detect newlines yet\n  let search = \"\";\n  const colons = content.match(/:([a-z_]+)(:)?/);\n  if (colons) {\n    if (colons[2] !== undefined) {\n      // closing colon is present\n      const match = emojiIndex.emojis[colons[1]];\n      if (match && \"native\" in match) {\n        content = content.replace(colons[0], match.native);\n        search = \"\";\n      } else {\n        const results = (emojiIndex.search(colons[1]) as any) as EmojiData[];\n        if (results[0] && \"native\" in results[0]) {\n          content = content.replace(colons[0], (results[0] as any).native);\n        }\n        search = \"\";\n      }\n    } else if (colons[1].length > 1) {\n      // colons aren't closed, use the search\n      search = colons[1];\n    } else if (colons[1]) {\n      search = \"\";\n    }\n  }\n  return search;\n};\n\nconst EmojiSuggestion = ({ value, onSelection }: EmojiInputProps) => {\n  const suggestions = useRef<HTMLDivElement>(null);\n  const theme = useContext(ThemeContext);\n  const isMedium = useMediaQuery(theme.mediaQueries.medium);\n\n  const replaceEmoji = (search: string, emoji: EmojiData) => {\n    if (\"native\" in emoji) {\n      const txt = value.replace(`:${search}`, emoji.native);\n      onSelection(txt);\n    }\n  };\n\n  let displayed = false;\n\n  const emojiSearchTerm = getEmojiSearchTerm(value);\n  const emojis = getEmojisFromEmojiSearchTerm(emojiSearchTerm);\n\n  if (emojiSearchTerm !== \"\" && emojis.length > 0) {\n    displayed = true;\n  } else {\n    displayed = false;\n  }\n  useClickOutside([suggestions], () => {\n    displayed = false;\n  });\n\n  return (\n    <Popup>\n      {displayed && (\n        <Suggestions ref={suggestions}>\n          <Heading>\n            Suggestions for <EmojiSearchTerm>{emojiSearchTerm}</EmojiSearchTerm>\n          </Heading>\n          <Results>\n            {emojis.slice(0, isMedium ? 35 : 7).map(emoji => (\n              <Result\n                key={emoji.id}\n                onClick={() => replaceEmoji(emojiSearchTerm, emoji)}\n              >\n                <Emoji>{\"native\" in emoji && emoji.native}</Emoji>\n                <Colons>{emoji.colons}</Colons>\n              </Result>\n            ))}\n          </Results>\n        </Suggestions>\n      )}\n    </Popup>\n  );\n};\n\nexport { EmojiSuggestion };\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  flex-grow: 1;\n`;\n\nexport const Container = styled.div`\n  display: flex;\n  align-items: center;\n  height: auto;\n`;\n\nexport const TextArea = styled.textarea`\n  flex-grow: 1;\n  resize: none;\n  overflow: auto;\n  border: ${({ theme }) => theme.borders.none};\n  max-height: ${({ theme }) => theme.sizes[4]};\n  padding: ${({ theme }) => theme.space[0]};\n  font-size: ${({ theme }) => theme.fontSizes.messageTextInput};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  color: ${({ theme }) => theme.colors.importantText};\n  background: ${({ theme }) => theme.backgrounds.content};\n  &::placeholder {\n    color: ${({ theme }) => theme.colors.normalText};\n  }\n  &:focus {\n    outline: none;\n  }\n`;\n\nexport const SendButton = styled.div`\n  align-self: flex-end;\n  display: none;\n  padding: ${({ theme }) => theme.space[1]};\n  margin: ${({ theme }) => `-${theme.space[1]}`};\n  margin-left: ${({ theme }) => theme.space[1]};\n  border-radius: ${({ theme }) => theme.radii.light};\n  background-color: ${({ theme }) => theme.colors.primary[0]};\n  ${({ theme }) => theme.mediaQueries.touch} {\n    display: flex;\n  }\n`;\n","import invariant from \"invariant\";\nimport { MessageType, TextMessage } from \"./messageModel\";\n\n/**\n * We define a draft text message to to be identical to a finalized text message.\n *\n * This does not have to be the case for complext message types.  some fields might\n * be optional in the draft but required in the final version for example.\n */\nexport type DraftTextMessage = TextMessage;\n\n/**\n * This is a union of all draft message types defined by the application.\n *\n * This can differ from the final version of the\n * message in that fields might be missing or temporary editor state may be\n * included.\n *\n * we don't do any of those things in this example, but having a separate type\n * helps to clarify which parts of the code are working with unsent messages.\n */\nexport type DraftMessage = DraftTextMessage;\n\n/**\n * Test if a draft message been modified (used to ignore unmodified drafts).\n */\nexport const isDraftModified = (message: DraftMessage) => {\n  switch (message.type) {\n    case MessageType.Text:\n      return message.text !== \"\";\n    default:\n      invariant(\n        false,\n        `Cannot determin if message of type \"${message.type}\" has been modified.`\n      );\n  }\n};\n","import React, { useContext } from \"react\";\nimport { ThemeContext } from \"styled-components\";\n\ninterface SendIconProps {\n  title: string;\n}\n\nexport const SendIcon = ({ title }: SendIconProps) => {\n  const theme = useContext(ThemeContext);\n  return (\n    <svg width={18} height={18} viewBox=\"0 0 18 18\">\n      <title>{title}</title>\n      <path\n        fill=\"none\"\n        stroke={theme.colors.onPrimary}\n        strokeMiterlimit={10}\n        d=\"M.53,13.46V11.31c0-.74.29-1.1,1-1.15,2.17-.17,4.33-.31,6.5-.46l1.16-.11a.68.68,0,0,0,.67-.67.63.63,0,0,0-.55-.73c-1-.1-2-.16-3-.24L1.45,7.59a.84.84,0,0,1-.88-.82,40.83,40.83,0,0,1,0-5.07,1.36,1.36,0,0,1,2.07-1c2.5,1.26,5,2.54,7.48,3.82l6.14,3.14c.52.26,1,.59,1,1.23s-.45,1-1,1.26Q9.53,13.57,2.8,17A1.46,1.46,0,0,1,.53,15.64C.52,14.91.53,14.19.53,13.46Z\"\n      />\n    </svg>\n  );\n};\n","import React, { useEffect, useRef, useContext } from \"react\";\nimport { EmojiInput } from \"features/emoji/EmojiInput/EmojiInput\";\nimport { EmojiSuggestion } from \"features/emoji/EmojiSuggestion/EmojiSuggestion\";\nimport {\n  Wrapper,\n  Container,\n  TextArea,\n  SendButton\n} from \"./TextMessageEditor.style\";\nimport { MessageType } from \"../messageModel\";\nimport { DraftTextMessage, isDraftModified } from \"../draft\";\nimport { SendIcon } from \"foundations/components/icons/SendIcon\";\nimport { useMediaQuery } from \"foundations/hooks/useMediaQuery\";\nimport { ThemeContext } from \"styled-components\";\n\n/**\n * Expand the height of the input box as multiple lines of text are entered.\n */\nconst autoExpand = (el: HTMLTextAreaElement) => {\n  setTimeout(function() {\n    el.style.cssText = \"height:auto; padding:0\";\n    el.style.cssText = \"height:\" + el.scrollHeight + \"px\";\n  }, 0);\n};\n\n/**\n * Update the text field on a draft text message by returning a new object if\n * the new text is different than the text in the old object.\n * This is the proper way to do updates to avoid unnecessary rerendering.\n */\nconst newTextDraft = (\n  draft: DraftTextMessage,\n  newText: string\n): DraftTextMessage => {\n  if (draft.text === newText) {\n    return draft;\n  }\n  return {\n    type: MessageType.Text,\n    senderId: draft.senderId,\n    text: newText\n  };\n};\n\ntype TextMessageEditorProps = {\n  message: DraftTextMessage;\n  sendDraft: (message: DraftTextMessage) => void;\n  updateDraft: (message: DraftTextMessage) => void;\n};\n\n/**\n * Edit a draft Text Message\n */\nexport const TextMessageEditor = ({\n  message,\n  sendDraft,\n  updateDraft\n}: TextMessageEditorProps) => {\n  const theme = useContext(ThemeContext);\n  const touch = useMediaQuery(theme.mediaQueries.touch);\n  const text = message.text;\n  const textareaRef = useRef<HTMLTextAreaElement>(\n    document.createElement(\"textarea\")\n  );\n\n  const textChanged = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    updateDraft(newTextDraft(message, e.target.value));\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\n    if (e.key === \"Enter\" && !(e.shiftKey || touch)) {\n      const draft = newTextDraft(message, text);\n      if (isDraftModified(draft)) {\n        sendDraft(draft);\n      }\n      e.preventDefault();\n    }\n    autoExpand(e.target as HTMLTextAreaElement);\n  };\n\n  const emojiInserted = (messageWithEmoji: string) => {\n    updateDraft(newTextDraft(message, messageWithEmoji));\n    textareaRef.current.focus();\n  };\n\n  useEffect(() => {\n    autoExpand(textareaRef.current);\n  }, [textareaRef]);\n\n  return (\n    <Wrapper>\n      <EmojiSuggestion value={text} onSelection={emojiInserted} />\n      <Container>\n        <TextArea\n          ref={textareaRef}\n          rows={1}\n          value={text}\n          onChange={textChanged}\n          onKeyPress={handleKeyPress}\n          placeholder=\"Type Message\"\n        />\n        <EmojiInput value={text} onSelection={emojiInserted} />\n        <SendButton\n          onClick={() => isDraftModified(message) && sendDraft(message)}\n        >\n          <SendIcon title=\"Send Message\" />\n        </SendButton>\n      </Container>\n    </Wrapper>\n  );\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  display: flex;\n  align-items: flex-end;\n  position: relative;\n  bottom: 0;\n  border-radius: ${({ theme }) => theme.radii.messageEditor};\n  border: ${({ theme }) => `${theme.borders.light} ${theme.colors.borderDark}`};\n  padding: ${({ theme }) => theme.space[2]};\n`;\n","import React from \"react\";\nimport invariant from \"invariant\";\nimport { DraftMessage } from \"../draft\";\nimport { MessageType } from \"../messageModel\";\nimport { TextMessageEditor } from \"../TextMessageEditor\";\nimport { Wrapper } from \"./MessageEditor.style\";\n\ntype MessageEditorProps = {\n  message: DraftMessage;\n  sendDraft: (message: DraftMessage) => void;\n  updateDraft: (message: DraftMessage) => void;\n};\n\n/**\n * Edit a Draft Message buy selecting the proper editor for the message type\n */\nexport const MessageEditor = ({\n  message,\n  sendDraft,\n  updateDraft\n}: MessageEditorProps) => {\n  switch (message.type) {\n    case MessageType.Text:\n      return (\n        <Wrapper>\n          <TextMessageEditor\n            message={message}\n            sendDraft={sendDraft}\n            updateDraft={updateDraft}\n          ></TextMessageEditor>\n        </Wrapper>\n      );\n\n    // <== Add additional message types here.\n\n    // Don't show anything for an unrecognized message type\n    default:\n      invariant(\n        false,\n        `No editor available for draft message of type \"${message.type}\"`\n      );\n  }\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  left: ${({ theme }) => theme.space[5]};\n  right: ${({ theme }) => theme.space[5]};\n  bottom: ${({ theme }) => theme.space[5]};\n  margin: ${({ theme }) => theme.space[6]};\n  margin-top: ${({ theme }) => theme.space[0]};\n  margin-bottom: ${({ theme }) => theme.space[3]};\n`;\n","export enum RtcCallState {\n  NONE = \"NONE\",\n  INITIATED = \"INITIATED\",\n  RECEIVING = \"RECEIVING\",\n  ACCEPTED = \"ACCEPTED\",\n  NOT_ANSWERED = \"NOT_ANSWERED\",\n  DECLINED = \"DECLINED\",\n  CANCELED = \"CANCELED\",\n  CONNECTED = \"CONNECTED\",\n  COMPLETED = \"COMPLETED\"\n}\n","export enum RtcCallType {\n  NONE = \"NONE\",\n  INCOMING = \"INCOMING\",\n  OUTGOING = \"OUTGOING\"\n}\n","import React from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { createSelector } from \"reselect\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\nimport { getMessageDrafts } from \"features/joinedConversations/DraftsModel\";\nimport { updateMessageDraft } from \"features/joinedConversations/updateMessageDraftCommand\";\nimport { discardMessageDraft } from \"features/joinedConversations/discardMessageDraftCommand\";\nimport { sendMessage } from \"features/messages/sendMessage\";\nimport { sendTypingIndicator } from \"features/typingIndicator/sendTypingIndicator\";\nimport { MessageType } from \"features/messages/messageModel\";\nimport { DraftMessage } from \"features/messages/draft\";\nimport { MessageEditor } from \"features/messages/MessageEditor\";\nimport { getCurrentConversationId } from \"../currentConversationModel\";\nimport { Wrapper } from \"./MessageInput.style\";\nimport {\n  TYPING_INDICATOR_DURATION_SECONDS,\n  TypingIndicatorType\n} from \"features/typingIndicator/typingIndicatorModel\";\n\nconst typingIndicators: {\n  [conversationId: string]: boolean;\n} = {};\n\nconst getConversationMessageDraft = createSelector(\n  [getMessageDrafts, getCurrentConversationId],\n  (drafts, conversationId): DraftMessage | undefined => {\n    return drafts[conversationId];\n  }\n);\n\n/**\n * Allow editing and sending messages\n */\nexport const MessageInput = () => {\n  const conversationId: string = useSelector(getCurrentConversationId);\n  const userId: string = useSelector(getLoggedInUserId);\n  const storedDraft: DraftMessage | undefined = useSelector(\n    getConversationMessageDraft\n  );\n  const defaultDraft: DraftMessage = {\n    type: MessageType.Text,\n    senderId: userId,\n    text: \"\"\n  };\n  const message: DraftMessage = storedDraft ? storedDraft : defaultDraft;\n  const dispatch = useDispatch();\n\n  const notifyTyping = () => {\n    if (!typingIndicators[conversationId]) {\n      typingIndicators[conversationId] = true;\n      dispatch(sendTypingIndicator(TypingIndicatorType.ShowTypingIndicator));\n\n      // allow sending additional typing indicators 1 seconds before display duration ends\n      setTimeout(() => {\n        typingIndicators[conversationId] = false;\n      }, (TYPING_INDICATOR_DURATION_SECONDS - 1) * 1000);\n    }\n  };\n\n  const notifyStopTyping = () => {\n    if (typingIndicators[conversationId]) {\n      typingIndicators[conversationId] = false;\n      dispatch(sendTypingIndicator(TypingIndicatorType.HideTypingIndicator));\n    }\n  };\n\n  const send = (appMessage: DraftMessage) => {\n    dispatch(sendMessage(appMessage));\n    dispatch(discardMessageDraft(conversationId));\n    typingIndicators[conversationId] = false;\n  };\n\n  const update = (appMessage: DraftMessage) => {\n    dispatch(updateMessageDraft(conversationId, appMessage));\n\n    if (appMessage.text.length > 0) {\n      notifyTyping();\n    } else {\n      notifyStopTyping();\n    }\n  };\n\n  return (\n    <Wrapper>\n      <MessageEditor\n        message={message}\n        sendDraft={send}\n        updateDraft={update}\n      ></MessageEditor>\n    </Wrapper>\n  );\n};\n","import { ThunkAction } from \"main/storeTypes\";\nimport { getCurrentConversationId } from \"features/currentConversation/currentConversationModel\";\nimport { DraftMessage } from \"./draft\";\nimport { sendMessage as sendPubnubMessage } from \"pubnub-redux\";\n\n/**\n * Send a message to the current conversation\n *\n * This command does not handle failure and leaves the error to the caller\n */\nexport const sendMessage = (message: DraftMessage): ThunkAction => {\n  return (dispatch, getState) => {\n    const state = getState();\n    return dispatch(\n      sendPubnubMessage({\n        channel: getCurrentConversationId(state),\n        message\n      })\n    );\n  };\n};\n","import { ThunkAction } from \"main/storeTypes\";\nimport { MESSAGE_DRAFT_DISCARDED } from \"./DraftsModel\";\n\n/**\n * Remove a message draft from the store for a specific conversation\n */\nexport const discardMessageDraft = (conversationId: string): ThunkAction => {\n  return dispatch => {\n    return dispatch({\n      type: MESSAGE_DRAFT_DISCARDED,\n      payload: {\n        conversationId\n      }\n    });\n  };\n};\n","import { ThunkAction } from \"main/storeTypes\";\nimport { MESSAGE_DRAFT_UPDATED } from \"./DraftsModel\";\nimport { DraftMessage } from \"features/messages/draft\";\n\n/**\n * Indicate that a draft message has been updated\n */\nexport const updateMessageDraft = (\n  conversationId: string,\n  newDraft: DraftMessage\n): ThunkAction => {\n  return dispatch => {\n    return dispatch({\n      type: MESSAGE_DRAFT_UPDATED,\n      payload: {\n        conversationId,\n        value: newDraft\n      }\n    });\n  };\n};\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  padding-left: ${({ theme }) => theme.space[6]};\n  padding-bottom: ${({ theme }) => theme.space[1]};\n  font-size: ${({ theme }) => theme.fontSizes.small};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  color: ${({ theme }) => theme.colors.importantText};\n`;\n","import React from \"react\";\nimport {\n  getTypingIndicatorsById,\n  TypingIndicator,\n  TypingIndicatorEnvelope,\n  TYPING_INDICATOR_DURATION_SECONDS\n} from \"../typingIndicatorModel\";\nimport { getCurrentConversationId } from \"features/currentConversation/currentConversationModel\";\nimport { getUsersById } from \"features/users/userModel\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\nimport { useSelector } from \"react-redux\";\nimport { createSelector } from \"reselect\";\nimport { Wrapper } from \"./TypingIndicatorDisplay.style\";\n\nexport interface TypingIndicatorFragment {\n  sender: {\n    id: string;\n    name: string;\n  };\n  timetoken: string;\n  message: TypingIndicator;\n}\n\nexport const getCurrentConversationTypingIndicators = createSelector(\n  [\n    getTypingIndicatorsById,\n    getCurrentConversationId,\n    getUsersById,\n    getLoggedInUserId\n  ],\n  (\n    typingIndicators,\n    conversationId,\n    users,\n    loggedInUserId\n  ): TypingIndicatorFragment[] => {\n    return typingIndicators[conversationId]\n      ? Object.values(\n          Object.values(typingIndicators[conversationId] || [])\n            .filter(\n              typingIndicator =>\n                typingIndicator.channel === conversationId &&\n                typingIndicator.publisher !== loggedInUserId\n            )\n            .reduce(\n              (\n                grouped: { [key: string]: TypingIndicatorEnvelope },\n                typingIndicator\n              ) => {\n                grouped[typingIndicator.publisher] = typingIndicator;\n                return grouped;\n              },\n              {}\n            )\n        )\n          .filter(\n            typingIndicator =>\n              Date.now() - typingIndicator.timetoken / 10000 <\n              TYPING_INDICATOR_DURATION_SECONDS * 1000\n          )\n          .map(typingIndicator => {\n            return {\n              ...typingIndicator,\n              timetoken: String(typingIndicator.timetoken),\n              sender:\n                users[typingIndicator.publisher || \"\"] ||\n                (typingIndicator.publisher\n                  ? {\n                      id: typingIndicator.publisher,\n                      name: typingIndicator.publisher\n                    }\n                  : {\n                      id: \"unknown\",\n                      name: \"unknown\"\n                    })\n            };\n          })\n      : [];\n  }\n);\n\n/**\n * Display a Message based on its type\n */\nexport const TypingIndicatorDisplay = () => {\n  const typingIndicators: TypingIndicatorFragment[] = useSelector(\n    getCurrentConversationTypingIndicators\n  );\n\n  if (typingIndicators.length === 0) {\n    return <Wrapper>&nbsp;</Wrapper>;\n  } else if (typingIndicators.length === 1) {\n    return <Wrapper>{typingIndicators[0].sender.name} is typing ...</Wrapper>;\n  } else {\n    return <Wrapper>Multiple users typing ...</Wrapper>;\n  }\n};\n","import React from \"react\";\nimport { Wrapper, animatedWrapperVariants } from \"./CurrentConversation.style\";\nimport { Header } from \"../Header\";\nimport { MessageList } from \"../MessageList\";\nimport { MessageInput } from \"../MessageInput\";\nimport { useSelector } from \"react-redux\";\nimport { getViewStates } from \"features/layout/Selectors\";\nimport { TypingIndicatorDisplay } from \"features/typingIndicator/TypingIndicatorDisplay\";\n\nconst CurrentConversation = () => {\n  const views = useSelector(getViewStates);\n  return (\n    <Wrapper\n      animate={views.CurrentConversation ? \"open\" : \"closed\"}\n      variants={animatedWrapperVariants}\n    >\n      <Header />\n      <MessageList />\n      <MessageInput />\n      <TypingIndicatorDisplay />\n    </Wrapper>\n  );\n};\n\nexport { CurrentConversation };\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div`\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  flex-direction: column;\n  min-height: ${({ theme }) => theme.sizes[3]};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.regular};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  text-transform: capitalize;\n  color: ${({ theme }) => theme.colors.importantText};\n  :hover {\n    background: ${({ theme }) => theme.backgrounds.contentHover};\n  }\n`;\n\nexport const Body = styled.div`\n  display: flex;\n  max-height: ${({ theme }) => theme.sizes[1]};\n  padding: ${({ theme }) => `${theme.space[0]} ${theme.space[1]}`};\n`;\n\nexport const Name = styled.div`\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n`;\n\nexport const Description = styled.div`\n  color: ${({ theme }) => theme.colors.normalText};\n`;\n\nexport const Content = styled.div`\n  display: flex;\n  flex-direction: column;\n  padding-left: ${({ theme }) => theme.space[5]};\n  justify-content: space-between;\n`;\n\nexport const IconWrapper = styled.div`\n  padding: ${({ theme }) => `${theme.space[4]} ${theme.space[0]}`};\n`;\n\nexport const ConversationIcon = styled.div<{ color: string }>`\n  border-radius: ${({ theme }) => theme.radii.medium};\n  width: ${({ theme }) => theme.sizes[1]};\n  height: ${({ theme }) => theme.sizes[1]};\n  line-height: ${({ theme }) => theme.sizes[1]};\n  text-align: center;\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  font-size: ${({ theme }) => theme.fontSizes.regular};\n  color: ${({ theme }) => theme.colors.onPrimary};\n  background: ${({ color }) => color};\n`;\n","import React, { useContext } from \"react\";\nimport {\n  Wrapper,\n  Body,\n  ConversationIcon,\n  Name,\n  Description,\n  Content\n} from \"./ConversationDescription.style\";\nimport { ThemeContext } from \"styled-components\";\nimport getUniqueColor from \"foundations/utilities/getUniqueColor\";\n\n/**\n * This describes the data that this component needs to display a\n * description of a conversation\n */\nexport interface ConversationDescriptionFragment {\n  id: string;\n  name: string;\n  description: string;\n}\n\n/**\n * Define the properties required to produce a conversation description\n */\ninterface ConversationDescriptionProps {\n  conversation: ConversationDescriptionFragment;\n  onClick: () => void;\n}\n\n/**\n * Display a short desscription of a conversation as it would appear in\n * a list of conversations.  Notify the parent component if a click is\n * detected on the description.\n *\n * Similiar to ConversationItem but with different style and less functionality\n */\nconst ConversationDescription = ({\n  conversation,\n  onClick\n}: ConversationDescriptionProps) => {\n  const theme = useContext(ThemeContext);\n  const color = getUniqueColor(\n    conversation.name,\n    (theme.colors.avatars as unknown) as string[]\n  );\n  return (\n    <Wrapper onClick={onClick}>\n      <Body>\n        <ConversationIcon color={color}>#</ConversationIcon>\n        <Content>\n          <Name>{conversation.name}</Name>\n          <Description>{conversation.description}</Description>\n        </Content>\n      </Body>\n    </Wrapper>\n  );\n};\n\nexport { ConversationDescription };\n","import styled from \"styled-components/macro\";\n\nexport const ScrollView = styled.section`\n  text-align: left;\n  overflow-y: scroll;\n  > div {\n    border-top: ${({ theme }) =>\n      `${theme.borders.light} ${theme.colors.neutral[1]}`};\n    border-bottom: ${({ theme }) =>\n      `${theme.borders.light} ${theme.colors.neutral[1]}`};\n  }\n`;\n\nexport const CloseButton = styled.div`\n  cursor: pointer;\n  color: ${({ theme }) => theme.colors.normalText};\n  ${({ theme }) => theme.mediaQueries.medium} {\n  }\n`;\n\nexport const Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: ${({ theme }) => `${theme.space[8]} ${theme.space[3]}`};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    padding: ${({ theme }) => theme.space[0]};\n    padding-bottom: ${({ theme }) => theme.space[8]};\n  }\n`;\n\nexport const Title = styled.div`\n  font-size: ${({ theme }) => theme.fontSizes.large};\n  font-weight: ${({ theme }) => theme.fontWeights.bold};\n  text-align: left;\n  color: ${({ theme }) => theme.colors.importantText};\n`;\n","import styled from \"styled-components/macro\";\nimport { motion } from \"framer-motion\";\n\nexport const Overlay = styled.div<{ displayed: boolean }>`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: ${({ displayed }) => (displayed ? \"flex\" : \"none\")};\n  z-index: 200;\n  width: 100%;\n  height: 100%;\n  background: ${({ theme }) => theme.backgrounds.panel};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    padding: 10% 15%;\n    background-color: rgba(0, 0, 0, 0.5);\n  }\n  ${({ theme }) => theme.mediaQueries.large} {\n    padding: 10% 25%;\n  }\n`;\n\nexport const Modal = styled(motion.section)`\n  z-index: 300;\n  box-shadow: ${({ theme }) => theme.shadows[1]};\n  border-radius: ${({ theme }) => theme.radii.square};\n  width: 100%;\n  height: 100%;\n  padding: ${({ theme }) => theme.space[0]};\n  text-align: center;\n  flex-direction: column;\n  overflow: auto;\n  background: ${({ theme }) => theme.backgrounds.panel};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    border-radius: ${({ theme }) => theme.radii.strong};\n    padding: ${({ theme }) => theme.space[8]};\n  }\n`;\n\nexport const getAnimatedModalVariants = (isMedium: boolean) => ({\n  open: {\n    y: \"0%\",\n    display: \"flex\"\n  },\n  closed: {\n    y: isMedium ? \"-200%\" : \"50%\",\n    transitionEnd: {\n      display: \"none\"\n    }\n  }\n});\n","import React, { useContext } from \"react\";\nimport { getViewStates } from \"features/layout/Selectors\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { getLoggedInUserId } from \"features/authentication/authenticationModel\";\nimport {\n  ConversationDescription,\n  ConversationDescriptionFragment\n} from \"../ConversationDescription\";\nimport {\n  getConversationsByUserId,\n  MembershipHash\n} from \"../joinedConversationModel\";\nimport { CrossIcon } from \"foundations/components/icons/CrossIcon\";\nimport {\n  ScrollView,\n  CloseButton,\n  Title,\n  Header\n} from \"./JoinConversationDialog.style\";\nimport {\n  Overlay,\n  Modal,\n  getAnimatedModalVariants\n} from \"foundations/components/Modal\";\nimport { createSelector } from \"reselect\";\nimport {\n  getAllConversations,\n  Conversation\n} from \"features/conversations/conversationModel\";\nimport { joinConversation } from \"../joinConversationCommand\";\nimport { joinConversationViewHidden } from \"features/layout/LayoutActions\";\nimport { ThemeContext } from \"styled-components\";\nimport { useMediaQuery } from \"foundations/hooks/useMediaQuery\";\n\n// Fetch all conversations and remove the ones we're already a member of\nconst getJoinableConversations = createSelector(\n  [getAllConversations, getLoggedInUserId, getConversationsByUserId],\n  (\n    conversations: Conversation[],\n    userId: string,\n    joinedConversations: MembershipHash\n  ): ConversationDescriptionFragment[] => {\n    return conversations.filter(conversation => {\n      return !joinedConversations[userId]\n        .map(conv => conv.id)\n        .includes(conversation.id);\n    });\n  }\n);\n\n/**\n * Present list to the user of conversations that they could join, but have not.\n * Allow the user to select the conversation to join or back out.\n *\n * TODO: This renders unconditionally as display:none so it will fetch the\n * list of conversations to join when the UI is rendered even if the user has not\n * opened the dialog.\n */\nconst JoinConversationDialog = () => {\n  const conversations: ConversationDescriptionFragment[] = useSelector(\n    getJoinableConversations\n  );\n  const views = useSelector(getViewStates);\n  const currentUserId = useSelector(getLoggedInUserId);\n  const dispatch = useDispatch();\n  const theme = useContext(ThemeContext);\n  const isMedium = useMediaQuery(theme.mediaQueries.medium);\n\n  return (\n    <Overlay displayed={views.JoinConversation}>\n      <Modal\n        animate={views.JoinConversation ? \"open\" : \"closed\"}\n        variants={getAnimatedModalVariants(isMedium)}\n      >\n        <Header>\n          <Title>Join a Conversation</Title>\n          <CloseButton\n            onClick={() => {\n              dispatch(joinConversationViewHidden());\n            }}\n          >\n            <CrossIcon color={theme.colors.normalText} title=\"close\" />\n          </CloseButton>\n        </Header>\n        <ScrollView>\n          {conversations.map(conversation => (\n            <ConversationDescription\n              key={`conversationDescription-${conversation.id}`}\n              onClick={() => {\n                const conversationId = conversation.id;\n                dispatch(joinConversation(currentUserId, conversationId));\n                dispatch(joinConversationViewHidden());\n              }}\n              conversation={conversation}\n            />\n          ))}\n        </ScrollView>\n      </Modal>\n    </Overlay>\n  );\n};\n\nexport { JoinConversationDialog };\n","import { ThunkAction } from \"main/storeTypes\";\nimport { joinSpaces } from \"pubnub-redux\";\nimport { focusOnConversation } from \"features/currentConversation/currentConversationModel\";\n\n/**\n * Join a conversation.\n * The membership in the conversation will be stored.\n * The channel for the converstation will be subscribed to to receive messages.\n * The new conversation will be made the selected conversation\n */\nexport const joinConversation = (\n  userId: string,\n  conversationId: string\n): ThunkAction<Promise<void>> => {\n  return (dispatch, getState, context) => {\n    return dispatch(\n      joinSpaces({\n        userId: userId,\n        spaces: [{ id: conversationId }]\n      })\n    ).then(() => {\n      context.pubnub.api.subscribe({\n        channels: [conversationId],\n        withPresence: true\n      });\n      dispatch(focusOnConversation(conversationId));\n    });\n  };\n};\n","import styled from \"styled-components/macro\";\n\nexport const UserName = styled.span`\n  padding-right: ${({ theme }) => theme.space[1]};\n`;\n\nexport const ScrollView = styled.section`\n  text-align: left;\n  overflow-y: scroll;\n  > div {\n    border-top: ${({ theme }) =>\n      `${theme.borders.light} ${theme.colors.neutral[1]}`};\n    border-bottom: ${({ theme }) =>\n      `${theme.borders.light} ${theme.colors.neutral[1]}`};\n  }\n`;\n\nexport const CloseButton = styled.div`\n  cursor: pointer;\n  color: ${({ theme }) => theme.colors.normalText};\n  ${({ theme }) => theme.mediaQueries.medium} {\n  }\n`;\n\nexport const Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: ${({ theme }) => `${theme.space[8]} ${theme.space[3]}`};\n  ${({ theme }) => theme.mediaQueries.medium} {\n    padding: ${({ theme }) => theme.space[0]};\n    padding-bottom: ${({ theme }) => theme.space[8]};\n  }\n`;\n\nexport const Title = styled.div`\n  padding: 10px;\n  display: flex;\n  align-items: center;\n  background: ${({ theme }) => theme.backgrounds.primary};\n  color: ${({ theme }) => theme.colors.onPrimary};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  text-align: left;\n`;\n\nexport const Call = styled.div<{ isConnected: boolean }>`\n  cursor: pointer;\n  color: ${({ theme, isConnected }) =>\n    isConnected ? theme.colors.primary[0] : theme.colors.neutral[3]};\n  background: ${({ theme, isConnected }) =>\n    isConnected ? theme.colors.neutral[1] : theme.colors.neutral[4]};\n  border-radius: 5px;\n  border: 1px solid #9b9b9b;\n  padding: 12px;\n`;\n","import { AppState } from \"main/storeTypes\";\nimport { createSelector } from \"reselect\";\nimport { AppActions } from \"../../main/AppActions\";\nimport { RtcCallState } from \"./RtcCallState.enum\";\nimport { RtcCallType } from \"./RtcCallType.enum\";\n\nexport const OUTGOING_CALL_INITIATED = \"OUTGOING_CALL_INITIATED\";\nexport const INCOMING_CALL_RECEIVED = \"INCOMING_CALL_RECEIVED\";\n\nexport const INCOMING_CALL_ACCEPTED = \"INCOMING_CALL_ACCEPTED\";\nexport const OUTGOING_CALL_ACCEPTED = \"OUTGOING_CALL_ACCEPTED\";\n\nexport const CALL_CANCELED = \"CALL_CANCELED\";\nexport const CALL_DECLINED = \"CALL_DECLINED\";\nexport const CALL_CONNECTED = \"CALL_CONNECTED\";\nexport const CALL_COMPLETED = \"CALL_COMPLETED\";\nexport const CALL_NOT_ANSWERED = \"CALL_NOT_ANSWERED\";\n\nexport interface RtcCallInfo {\n  callType: RtcCallType;\n  callState: RtcCallState;\n  peerUserId: string;\n  startTime: number;\n  endTime?: number;\n}\n\nexport interface RtcState {\n  currentCall: RtcCallInfo;\n  lastIncomingCall: RtcCallInfo;\n  callLog: RtcCallInfo[];\n}\n\nconst initialState: RtcState = {\n  currentCall: {\n    callType: RtcCallType.NONE,\n    callState: RtcCallState.NONE,\n    peerUserId: \"\",\n    startTime: 0\n  },\n  lastIncomingCall: {\n    callType: RtcCallType.NONE,\n    callState: RtcCallState.NONE,\n    peerUserId: \"\",\n    startTime: 0\n  },\n  callLog: []\n};\n\nexport const outgoingCallInitiated = (\n  userId: string,\n  startTime: number\n): OutgoingCallInitiatedAction => ({\n  type: OUTGOING_CALL_INITIATED,\n  payload: {\n    userId,\n    startTime\n  }\n});\n\nexport const incomingCallReceived = (\n  userId: string,\n  startTime: number\n): IncomingCallReceivedAction => ({\n  type: INCOMING_CALL_RECEIVED,\n  payload: {\n    userId,\n    startTime\n  }\n});\n\nexport const incomingCallAccepted = (\n  userId: string,\n  startTime: number\n): IncomingCallAcceptedAction => ({\n  type: INCOMING_CALL_ACCEPTED,\n  payload: {\n    userId,\n    startTime\n  }\n});\n\nexport const outgoingCallAccepted = (\n  userId: string,\n  startTime: number\n): OutgoingCallAcceptedAction => ({\n  type: OUTGOING_CALL_ACCEPTED,\n  payload: {\n    userId,\n    startTime\n  }\n});\n\nexport const callNotAnswered = (\n  userId: string,\n  startTime: number,\n  endTime: number\n): CallNotAnsweredAction => ({\n  type: CALL_NOT_ANSWERED,\n  payload: {\n    userId,\n    startTime,\n    endTime\n  }\n});\n\nexport const callDeclined = (\n  userId: string,\n  startTime: number,\n  endTime: number\n): CallDeclinedAction => ({\n  type: CALL_DECLINED,\n  payload: {\n    userId,\n    startTime,\n    endTime\n  }\n});\n\nexport const callCanceled = (\n  userId: string,\n  startTime: number,\n  endTime: number\n): CallCanceledAction => ({\n  type: CALL_CANCELED,\n  payload: {\n    userId,\n    startTime,\n    endTime\n  }\n});\n\nexport const callConnected = (\n  userId: string,\n  startTime: number\n): CallConnectedAction => ({\n  type: CALL_CONNECTED,\n  payload: {\n    userId,\n    startTime\n  }\n});\n\nexport const callCompleted = (\n  userId: string,\n  startTime: number,\n  endTime: number\n): CallCompletedAction => ({\n  type: CALL_COMPLETED,\n  payload: {\n    userId,\n    startTime,\n    endTime\n  }\n});\n\ntype CallActionPayload = {\n  userId: string;\n  startTime: number;\n};\n\ntype CompletedCallActionPayload = {\n  userId: string;\n  startTime: number;\n  endTime: number;\n};\n\nexport interface OutgoingCallInitiatedAction {\n  type: typeof OUTGOING_CALL_INITIATED;\n  payload: CallActionPayload;\n}\n\nexport interface IncomingCallReceivedAction {\n  type: typeof INCOMING_CALL_RECEIVED;\n  payload: CallActionPayload;\n}\n\nexport interface IncomingCallAcceptedAction {\n  type: typeof INCOMING_CALL_ACCEPTED;\n  payload: CallActionPayload;\n}\n\nexport interface OutgoingCallAcceptedAction {\n  type: typeof OUTGOING_CALL_ACCEPTED;\n  payload: CallActionPayload;\n}\n\nexport interface CallDeclinedAction {\n  type: typeof CALL_DECLINED;\n  payload: CompletedCallActionPayload;\n}\n\nexport interface CallCanceledAction {\n  type: typeof CALL_CANCELED;\n  payload: CompletedCallActionPayload;\n}\n\nexport interface CallNotAnsweredAction {\n  type: typeof CALL_NOT_ANSWERED;\n  payload: CompletedCallActionPayload;\n}\n\nexport interface CallConnectedAction {\n  type: typeof CALL_CONNECTED;\n  payload: CallActionPayload;\n}\n\nexport interface CallCompletedAction {\n  type: typeof CALL_COMPLETED;\n  payload: CompletedCallActionPayload;\n}\n\nconst RtcStateReducer = (\n  state: RtcState = initialState,\n  action: AppActions\n): RtcState => {\n  switch (action.type) {\n    case OUTGOING_CALL_INITIATED:\n      return {\n        ...state,\n        currentCall: {\n          peerUserId: action.payload.userId,\n          callType: RtcCallType.OUTGOING,\n          callState: RtcCallState.INITIATED,\n          startTime: action.payload.startTime\n        }\n      };\n    case INCOMING_CALL_RECEIVED:\n      if (state.currentCall.callState === RtcCallState.CONNECTED) {\n        // calls received while already in a call will be missed call and added to the call log.\n        // we may want to add the ability to end the current call and accept a new one in the future.\n\n        const newCall = {\n          peerUserId: action.payload.userId,\n          callType: RtcCallType.INCOMING,\n          callState: RtcCallState.NOT_ANSWERED,\n          startTime: action.payload.startTime\n        };\n\n        return {\n          ...state,\n          lastIncomingCall: newCall,\n          callLog: [...state.callLog, newCall]\n        };\n      }\n\n      // most recent incoming call wins, we don't have busy\n      // signal and we don't block simultaneous incoming calls\n\n      const newCall = {\n        peerUserId: action.payload.userId,\n        callType: RtcCallType.INCOMING,\n        callState: RtcCallState.RECEIVING,\n        startTime: action.payload.startTime\n      };\n\n      return {\n        ...state,\n        currentCall: newCall,\n        lastIncomingCall: newCall\n      };\n    case INCOMING_CALL_ACCEPTED:\n      // only the lastIncomingCall can be answered\n\n      if (\n        state.lastIncomingCall.callState === RtcCallState.RECEIVING &&\n        state.lastIncomingCall.peerUserId === action.payload.userId &&\n        state.lastIncomingCall.startTime === action.payload.startTime\n      ) {\n        const currentCall = {\n          ...state.lastIncomingCall,\n          callState: RtcCallState.ACCEPTED\n        };\n\n        return {\n          ...state,\n          currentCall,\n          lastIncomingCall: currentCall\n        };\n      } else {\n        return state;\n      }\n    case OUTGOING_CALL_ACCEPTED:\n      const acceptedCall = {\n        ...state.currentCall,\n        callState: RtcCallState.ACCEPTED\n      };\n\n      return {\n        ...state,\n        currentCall: acceptedCall\n      };\n    case CALL_DECLINED:\n      // only the currentCall can be completed\n\n      if (\n        state.currentCall.peerUserId === action.payload.userId &&\n        state.currentCall.startTime === action.payload.startTime\n      ) {\n        const currentCall = {\n          ...state.currentCall,\n          callState: RtcCallState.DECLINED,\n          endTime: action.payload.endTime\n        };\n\n        return {\n          ...state,\n          currentCall,\n          callLog: [...state.callLog, currentCall]\n        };\n      } else {\n        return state;\n      }\n    case CALL_CANCELED:\n      // only the currentCall can be completed\n\n      if (\n        state.currentCall.peerUserId === action.payload.userId &&\n        state.currentCall.startTime === action.payload.startTime\n      ) {\n        const currentCall = {\n          ...state.currentCall,\n          callState: RtcCallState.CANCELED,\n          endTime: action.payload.endTime\n        };\n\n        return {\n          ...state,\n          currentCall,\n          callLog: [...state.callLog, currentCall]\n        };\n      } else {\n        return state;\n      }\n    case CALL_NOT_ANSWERED:\n      // only the currentCall can be completed\n\n      if (\n        state.currentCall.peerUserId === action.payload.userId &&\n        state.currentCall.startTime === action.payload.startTime\n      ) {\n        const currentCall = {\n          ...state.currentCall,\n          callState: RtcCallState.NOT_ANSWERED,\n          endTime: action.payload.endTime\n        };\n\n        return {\n          ...state,\n          currentCall,\n          callLog: [...state.callLog, currentCall]\n        };\n      } else {\n        return state;\n      }\n    case CALL_CONNECTED:\n      const connectedCall = {\n        ...state.currentCall,\n        callState: RtcCallState.CONNECTED\n      };\n\n      return {\n        ...state,\n        currentCall: connectedCall\n      };\n    case CALL_COMPLETED:\n      // only the currentCall can be completed\n\n      if (\n        state.currentCall.peerUserId === action.payload.userId &&\n        state.currentCall.startTime === action.payload.startTime\n      ) {\n        const currentCall = {\n          ...state.currentCall,\n          callState: RtcCallState.COMPLETED,\n          endTime: action.payload.endTime\n        };\n\n        return {\n          ...state,\n          currentCall,\n          callLog: [...state.callLog, currentCall]\n        };\n      } else {\n        return state;\n      }\n    default:\n      return state;\n  }\n};\n\nconst getRtcStateSlice = (state: AppState) => state.rtc;\n\nexport const getCurrentCall = createSelector(\n  getRtcStateSlice,\n  (rtc: RtcState): RtcCallInfo => {\n    return rtc.currentCall;\n  }\n);\n\n// export const getLastIncomingCall = createSelector(\n//   getRtcStateSlice,\n//   (rtc: RtcState): RtcCallInfo => {\n//     return rtc.lastIncomingCall;\n//   }\n// );\n\nexport { RtcStateReducer };\n","export enum RtcCallSignalType {\n  INITIATE = \"INITIATE\",\n  ACCEPT = \"ACCEPT\",\n  END = \"END\"\n}\n","export enum RtcIceSignalType {\n  OFFER = \"OFFER\",\n  ANSWER = \"ANSWER\",\n  CANDIDATE = \"CANDIDATE\"\n}\n","import React, { useContext } from \"react\";\nimport { getViewStates } from \"features/layout/Selectors\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { CrossIcon } from \"foundations/components/icons/CrossIcon\";\nimport {\n  Call,\n  CloseButton,\n  Title,\n  Header,\n  UserName\n} from \"./UserDetailDialog.style\";\nimport {\n  Overlay,\n  Modal,\n  getAnimatedModalVariants\n} from \"foundations/components/Modal\";\nimport { ThemeContext } from \"styled-components\";\nimport { useMediaQuery } from \"foundations/hooks/useMediaQuery\";\nimport {\n  rtcViewDisplayed,\n  userDetailViewHidden\n} from \"../../layout/LayoutActions\";\nimport { getSelectedUserId } from \"../userDetailModel\";\nimport { getUsersById } from \"../../users/userModel\";\nimport { PresenceIndicatorIcon } from \"../../../foundations/components/icons/PresenceIndicatorIcon\";\nimport { getPresenceByConversationId } from \"features/memberPresence/memberPresenceModel\";\nimport { getCurrentConversationId } from \"features/currentConversation/currentConversationModel\";\nimport { outgoingCallInitiated } from \"../../rtc/RtcModel\";\nimport { getLoggedInUserId } from \"../../authentication/authenticationModel\";\n\nconst UserDetailDialog = () => {\n  const dispatch = useDispatch();\n  const views = useSelector(getViewStates);\n  const theme = useContext(ThemeContext);\n  const isMedium = useMediaQuery(theme.mediaQueries.medium);\n  const loggedInUserId = useSelector(getLoggedInUserId);\n  const selectedUserId = useSelector(getSelectedUserId);\n  const usersById = useSelector(getUsersById);\n  const currentConversationId = useSelector(getCurrentConversationId);\n  const presenceByConversationId = useSelector(getPresenceByConversationId);\n  const user = usersById[selectedUserId];\n  const userName = user ? user.name : \"\";\n  const present = presenceByConversationId[currentConversationId];\n  const isConnected =\n    present &&\n    present.occupants.filter(occupant => {\n      return occupant.uuid === selectedUserId;\n    }).length > 0;\n\n  const initiateCall = () => {\n    dispatch(outgoingCallInitiated(selectedUserId, new Date().getTime()));\n    dispatch(rtcViewDisplayed());\n  };\n\n  return (\n    <Overlay displayed={views.UserDetail}>\n      <Modal\n        animate={views.UserDetail ? \"open\" : \"closed\"}\n        variants={getAnimatedModalVariants(isMedium)}\n      >\n        <Header>\n          <Title>\n            <UserName>{userName}</UserName>\n            {isConnected && (\n              <PresenceIndicatorIcon\n                size={7}\n                title={isConnected ? \"connected\" : \"not connected\"}\n                active={isConnected}\n              />\n            )}\n          </Title>\n          <CloseButton\n            onClick={() => {\n              dispatch(userDetailViewHidden());\n            }}\n          >\n            <CrossIcon color={theme.colors.normalText} title=\"close\" />\n          </CloseButton>\n        </Header>\n        {loggedInUserId !== selectedUserId && (\n          <Call isConnected={isConnected} onClick={initiateCall}>\n            Initiate a call\n            {isConnected || \" (\" + userName + \" may not be online)\"}\n          </Call>\n        )}\n        {loggedInUserId === selectedUserId && <div>My Profile</div>}\n      </Modal>\n    </Overlay>\n  );\n};\n\nexport { UserDetailDialog };\n","import styled from \"styled-components/macro\";\n\nexport const Wrapper = styled.div<{ displayed: boolean }>`\n  resize: both;\n  overflow: auto;\n  z-index: 1000;\n  position: fixed;\n  background: black;\n  color: white;\n  line-height: normal;\n  display: ${({ theme, displayed }) => (displayed ? \"flex\" : \"none\")};\n  flex-direction: column;\n`;\n\nexport const VideoWrapper = styled.div``;\n\nexport const CloseButton = styled.div`\n  margin-top: 2px;\n  margin-right: 2px;\n  cursor: pointer;\n  color: ${({ theme }) => theme.colors.normalText};\n`;\n\nexport const Header = styled.div`\n  display: flex;\n  justify-content: space-between;\n  border-bottom-style: solid;\n  border-bottom-width: 1px;\n  border-bottom-color: ${({ theme }) => theme.colors.neutral[3]};\n`;\n\nexport const Body = styled.div``;\n\nexport const Title = styled.div`\n  padding-left: 10px;\n  padding-right: 10px;\n  display: flex;\n  align-items: center;\n  background: ${({ theme }) => theme.backgrounds.primary};\n  color: ${({ theme }) => theme.colors.onPrimary};\n  font-size: ${({ theme }) => theme.fontSizes.medium};\n  font-family: ${({ theme }) => theme.fonts.app};\n  font-weight: ${({ theme }) => theme.fontWeights.medium};\n  text-align: left;\n`;\n\nexport const LocalVideoWrapper = styled.div`\n  padding-right: 40px;\n  float: right;\n  display: inline-block;\n`;\n\nexport const RemoteVideoWrapper = styled.div`\n  padding-left: 40px;\n  float: left;\n  display: inline-block;\n`;\n\nexport const MyVideo = styled.video`\n  object-fit: scale-down;\n  width: 160px;\n  height: 160px;\n`;\n\nexport const RemoteVideo = styled.video`\n  object-fit: scale-down;\n  width: 320px;\n  height: 320px;\n`;\n\nexport const CallStatus = styled.div`\n  padding: 5px;\n  margin-top: 20px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: ${({ theme }) => theme.colors.neutral[3]};\n`;\n","import RtcSettings from \"config/rtcSettings.json\";\n\nconst ICE_CONFIG = RtcSettings.rtcIceConfig;\n\ninterface RtcState {\n  peerConnection: RTCPeerConnection;\n  userMediaStream?: MediaStream;\n  userMediaClones: MediaStream[];\n  inboundStream?: MediaStream;\n  negotiatingOffer: boolean;\n  negotiatingAnswer: boolean;\n  iceCandidates: RTCIceCandidate[];\n  iceCandidateHandler: (candidate: RTCIceCandidate | null) => void;\n  negotiationNeededHandler: (event: Event) => void;\n  trackHandler: (event: RTCTrackEvent) => void;\n  connectionStateHandler: (state: RTCPeerConnectionState) => void;\n  iceConnectionStateHandler: (state: RTCIceConnectionState) => void;\n}\n\nlet state: RtcState = {\n  peerConnection: new RTCPeerConnection(),\n  userMediaStream: undefined,\n  userMediaClones: [],\n  inboundStream: undefined,\n  negotiatingOffer: false,\n  negotiatingAnswer: false,\n  iceCandidates: [],\n  iceCandidateHandler: (candidate: RTCIceCandidate | null) => {\n    console.log(\"default ice candidate handler\");\n  },\n  negotiationNeededHandler: (event: Event) => {\n    console.log(\"default negotiation needed handler\");\n  },\n  trackHandler: (event: RTCTrackEvent) => {\n    console.log(\"default track handler\");\n  },\n  connectionStateHandler: (state: RTCPeerConnectionState) => {\n    console.log(\"default connection state handler: \", state);\n  },\n  iceConnectionStateHandler: (state: RTCIceConnectionState) => {\n    console.log(\"default ice connection state handler: \", state);\n  }\n};\n\nexport const createPeerConnection = async () => {\n  console.log(\"create peer connection\");\n\n  state.negotiatingOffer = false;\n  state.negotiatingAnswer = false;\n  state.inboundStream = undefined;\n  state.iceCandidates = [];\n\n  if (state.peerConnection.connectionState !== \"closed\") {\n    try {\n      console.log(\"create peer connection: closing previous peer connection\");\n      state.peerConnection.close();\n      await disconnectMedia();\n    } catch (e) {\n      console.log(\"error closing peer connection: \", e);\n    }\n  }\n\n  console.log(\"create peer connection: creating new peer connection\");\n  state.peerConnection = new RTCPeerConnection({\n    iceServers: ICE_CONFIG\n  });\n\n  state.peerConnection.onicecandidate = event => {\n    return state.iceCandidateHandler(event.candidate);\n  };\n\n  state.peerConnection.onnegotiationneeded = event => {\n    return state.negotiationNeededHandler(event);\n  };\n\n  state.peerConnection.ontrack = event => {\n    return state.trackHandler(event);\n  };\n\n  state.peerConnection.onconnectionstatechange = event => {\n    return state.connectionStateHandler(state.peerConnection.connectionState);\n  };\n\n  state.peerConnection.onconnectionstatechange = event => {\n    console.log(\n      \"onconnectionstatechange - connectionState: \",\n      state.peerConnection.connectionState\n    );\n  };\n\n  state.peerConnection.onicegatheringstatechange = event => {\n    console.log(\n      \"onicegatheringstatechange - iceGatheringState: \",\n      state.peerConnection.iceGatheringState\n    );\n  };\n\n  state.peerConnection.oniceconnectionstatechange = event => {\n    return state.iceConnectionStateHandler(\n      state.peerConnection.iceConnectionState\n    );\n  };\n\n  state.peerConnection.onsignalingstatechange = event => {\n    console.log(\n      \"onsignalingstatechange - signalingState: \",\n      state.peerConnection.signalingState\n    );\n  };\n};\n\nexport const connectMedia = async (constraints: MediaStreamConstraints) => {\n  console.log(\"connect media \", constraints);\n\n  if (!constraints.audio && !constraints.video) {\n    console.log(\"connect media: audio and video both false. exiting.\");\n    return;\n  }\n\n  if (!state.userMediaStream) {\n    console.log(\"connect media: getting user media\");\n    const stream = await navigator.mediaDevices.getUserMedia({\n      ...constraints,\n      video: constraints.video && {\n        width: { exact: 640 },\n        height: { exact: 480 }\n      }\n    });\n\n    state.userMediaClones.push(stream);\n    state.userMediaStream = stream.clone();\n  }\n\n  return state.userMediaStream;\n};\n\nexport const disconnectMedia = async () => {\n  state.peerConnection.close();\n\n  state.userMediaClones.forEach((stream: MediaStream) => {\n    stream.getTracks().forEach(track => track.stop());\n  });\n\n  if (state.userMediaStream) {\n    state.userMediaStream.getTracks().forEach(track => track.stop());\n    state.userMediaStream = undefined;\n  }\n\n  if (state.inboundStream) {\n    state.inboundStream.getTracks().forEach(track => track.stop());\n    state.inboundStream = undefined;\n  }\n};\n\nexport const sendMedia = async () => {\n  console.log(\"send media\");\n\n  if (state.userMediaStream) {\n    console.log(\"send media: adding tracks\");\n\n    const stream = state.userMediaStream;\n\n    // state.userMediaClones.push(stream);\n\n    stream.getTracks().forEach(track => {\n      state.peerConnection.addTrack(track, stream); //.clone();\n    });\n\n    console.log(\"send media: tracks added\");\n  }\n};\n\nexport const createIceOffer = async () => {\n  const offer = await state.peerConnection.createOffer();\n\n  console.log(\"createIceOffer: attempting local offer\", offer);\n\n  try {\n    await state.peerConnection.setLocalDescription(offer);\n    console.log(\n      \"createIceOffer: created: \",\n      state.peerConnection.localDescription\n    );\n  } catch (e) {\n    console.log(\"createIceOffer: error setting local offer: \", e);\n  }\n\n  return state.peerConnection.localDescription;\n};\n\nexport const negotiateIceOffer = async () => {\n  const offer = await state.peerConnection.createOffer();\n\n  if (state.peerConnection.signalingState !== \"stable\") return;\n\n  console.log(\"negotiateIceOffer: attempting local offer\", offer);\n\n  try {\n    if (\n      state.peerConnection.signalingState === \"stable\" ||\n      state.peerConnection.signalingState === \"have-local-offer\" ||\n      state.peerConnection.signalingState === \"have-remote-pranswer\"\n    ) {\n      await state.peerConnection.setLocalDescription(offer);\n      console.log(\n        \"negotiateIceOffer: created: \",\n        state.peerConnection.localDescription\n      );\n    } else {\n      console.log(\n        \"negotiateIceOffer: invalid state to set local description: \",\n        state.peerConnection.signalingState\n      );\n    }\n  } catch (e) {\n    console.log(\"negotiateIceOffer: error setting local offer: \", e);\n  }\n\n  return state.peerConnection.localDescription;\n};\n\nexport const createIceAnswer = async () => {\n  if (\n    state.peerConnection.signalingState === \"stable\" ||\n    state.peerConnection.signalingState === \"have-remote-offer\" ||\n    state.peerConnection.signalingState === \"have-local-pranswer\"\n  ) {\n    const answer = await state.peerConnection.createAnswer();\n\n    console.log(\"createIceAnswer: attempting local answer\", answer);\n\n    try {\n      if (\n        state.peerConnection.signalingState === \"stable\" ||\n        state.peerConnection.signalingState === \"have-local-pranswer\" ||\n        state.peerConnection.signalingState === \"have-remote-offer\"\n      ) {\n        await state.peerConnection.setLocalDescription(answer);\n        console.log(\n          \"createIceAnswer: created: \",\n          state.peerConnection.localDescription\n        );\n      } else {\n        console.log(\n          \"createIceAnswer: invalid state to set local description: \",\n          state.peerConnection.signalingState\n        );\n      }\n    } catch (e) {\n      console.log(\"createIceAnswer: error setting local answer: \", e);\n    }\n  } else {\n    console.log(\n      \"createIceAnswer: invalid state to create answer: \",\n      state.peerConnection.signalingState\n    );\n  }\n\n  return state.peerConnection.localDescription;\n};\n\nexport const setLocalDescription = async (offer: RTCSessionDescription) => {\n  console.log(\n    \"setLocalDescription: \",\n    state.negotiatingOffer,\n    state.peerConnection.signalingState\n  );\n\n  try {\n    if (\n      state.peerConnection.signalingState === \"stable\" ||\n      state.peerConnection.signalingState === \"have-local-offer\" ||\n      state.peerConnection.signalingState === \"have-remote-pranswer\"\n    ) {\n      await state.peerConnection.setLocalDescription(offer);\n    } else {\n      console.log(\n        \"invalid state to set local description: \",\n        state.peerConnection.signalingState\n      );\n    }\n  } catch (e) {\n    console.log(\"setLocalDescription: error setting remote desc: \", e);\n  }\n};\n\nexport const setRemoteDescription = async (offer: RTCSessionDescription) => {\n  console.log(\n    \"setRemoteDescription: \",\n    state.negotiatingOffer,\n    state.peerConnection.signalingState\n  );\n\n  try {\n    if (\n      state.peerConnection.signalingState === \"stable\" ||\n      state.peerConnection.signalingState === \"have-local-offer\" ||\n      state.peerConnection.signalingState === \"have-remote-offer\" ||\n      state.peerConnection.signalingState === \"have-local-pranswer\" ||\n      state.peerConnection.signalingState === \"have-remote-pranswer\"\n    ) {\n      await state.peerConnection.setRemoteDescription(offer);\n    } else {\n      console.log(\n        \"invalid state to set remote description: \",\n        state.peerConnection.signalingState\n      );\n    }\n  } catch (e) {\n    console.log(\"setRemoteDescription: error setting remote desc: \", e);\n  }\n\n  state.iceCandidates.forEach(candidate => {\n    state.peerConnection.addIceCandidate(candidate);\n  });\n};\n\nexport const addIceCandidate = async (candidate: RTCIceCandidate) => {\n  console.log(\"ice candidate adding\", candidate);\n  if (\n    !state.peerConnection.remoteDescription ||\n    !state.peerConnection.remoteDescription.type\n  ) {\n    state.iceCandidates.push(candidate);\n  } else {\n    state.iceCandidates.forEach(candidate => {\n      state.peerConnection.addIceCandidate(candidate);\n    });\n    state.peerConnection.addIceCandidate(candidate);\n  }\n};\n\nexport const setIceCandidateHandler = (\n  handler: (candidate: RTCIceCandidate | null) => void\n) => {\n  state.iceCandidateHandler = handler;\n\n  state.peerConnection.onicecandidate = event => {\n    return state.iceCandidateHandler(event.candidate);\n  };\n};\n\nexport const setNegotiationNeededHandler = (\n  handler: (event: Event) => void\n) => {\n  state.negotiationNeededHandler = handler;\n\n  state.peerConnection.onnegotiationneeded = event => {\n    return state.negotiationNeededHandler(event);\n  };\n};\n\nexport const setTrackHandler = (handler: (event: RTCTrackEvent) => void) => {\n  state.trackHandler = handler;\n\n  state.peerConnection.ontrack = event => {\n    return state.trackHandler(event);\n  };\n};\n\nexport const setConnectionStateHandler = (\n  handler: (state: RTCPeerConnectionState) => void\n) => {\n  state.connectionStateHandler = handler;\n  state.peerConnection.onconnectionstatechange = event => {\n    return state.connectionStateHandler(state.peerConnection.connectionState);\n  };\n};\n\nexport const setIceConnectionStateHandler = (\n  handler: (state: RTCIceConnectionState) => void\n) => {\n  state.iceConnectionStateHandler = handler;\n  state.peerConnection.oniceconnectionstatechange = event => {\n    return state.iceConnectionStateHandler(\n      state.peerConnection.iceConnectionState\n    );\n  };\n};\n","import Pubnub from \"pubnub\";\nimport { sendMessage as sendPubnubMessage, Message } from \"pubnub-redux\";\nimport {\n  MessageType,\n  RtcCallMessage,\n  RtcIceMessage\n} from \"features/messages/messageModel\";\nimport { RtcCallSignalType } from \"./RtcCallSignalType.enum\";\nimport { RtcIceSignalType } from \"./RtcIceSignalType.enum\";\nimport { AppDispatch } from \"main/storeTypes\";\nimport RtcSettings from \"config/rtcSettings.json\";\n\nconst DIALING_TIMEOUT_SECONDS = RtcSettings.rtcDialingTimeoutSeconds;\n\ninterface SignalingState {\n  pubnub?: Pubnub;\n  dispatch?: AppDispatch;\n  negotingOffer: boolean;\n  pendingOutgoingCalls: {\n    [key: string]: { peerId: string; startTime: number };\n  };\n  pendingIncomingCalls: {\n    [key: string]: { peerId: string; startTime: number };\n  };\n  onCallIncoming: (callerId: string, startTime: number) => void;\n  onCallAccepted: (callerId: string, startTime: number) => void;\n  onCallEnded: (callerId: string, startTime: number) => void;\n  onCallTimeout: (callerId: string, startTime: number) => void;\n  onIceCandidate: (\n    callerId: string,\n    startTime: number,\n    candidate: RTCIceCandidate | null\n  ) => void;\n  onIceOffer: (\n    callerId: string,\n    startTime: number,\n    offer: RTCSessionDescription\n  ) => void;\n  onIceAnswer: (\n    callerId: string,\n    startTime: number,\n    offer: RTCSessionDescription\n  ) => void;\n}\n\nconst state: SignalingState = {\n  pubnub: undefined,\n  dispatch: undefined,\n  negotingOffer: false,\n  pendingOutgoingCalls: {},\n  pendingIncomingCalls: {},\n  onCallIncoming: (callerId: string, startTime: number) => {},\n  onCallAccepted: (callerId: string, startTime: number) => {},\n  onCallEnded: (callerId: string, startTime: number) => {},\n  onCallTimeout: (callerId: string, startTime: number) => {},\n  onIceCandidate: (\n    callerId: string,\n    startTime: number,\n    candidate: RTCIceCandidate | null\n  ) => {},\n  onIceOffer: (\n    callerId: string,\n    startTime: number,\n    offer: RTCSessionDescription\n  ) => {},\n  onIceAnswer: (\n    callerId: string,\n    startTime: number,\n    offer: RTCSessionDescription\n  ) => {}\n};\n\nconst pubnubIceListener: Pubnub.ListenerParameters = {};\n\n// initialize signaling\nexport const init = async (pubnub: Pubnub, dispatch: AppDispatch) => {\n  state.pubnub = pubnub;\n  state.dispatch = dispatch;\n  state.negotingOffer = false;\n\n  if (state.pubnub) {\n    pubnub.removeListener(pubnubIceListener);\n  }\n\n  pubnubIceListener.message = async message => {\n    console.log(\"message\", message);\n    if (message.message.type === MessageType.RtcCall) {\n      handleCallMessage(message.message as RtcCallMessage);\n    } else if (message.message.type === MessageType.RtcIce) {\n      handleIceMessage(message.message as RtcIceMessage);\n    }\n  };\n\n  pubnub.addListener(pubnubIceListener);\n};\n\nconst setHandlers = (\n  onCallIncoming: (callerId: string, startTime: number) => void,\n  onCallAccepted: (callerId: string, startTime: number) => void,\n  onCallEnded: (callerId: string, startTime: number) => void,\n  onCallTimeout: () => void,\n  onIceCandidate: (\n    callerId: string,\n    startTime: number,\n    candidate: RTCIceCandidate | null\n  ) => void,\n  onIceOffer: (\n    callerId: string,\n    startTime: number,\n    offer: RTCSessionDescription\n  ) => void,\n  onIceAnswer: (\n    callerId: string,\n    startTime: number,\n    offer: RTCSessionDescription\n  ) => void\n) => {\n  console.log(\"setting rtc signaling handlers\");\n  state.onCallIncoming = onCallIncoming;\n  state.onCallAccepted = onCallAccepted;\n  state.onCallEnded = onCallEnded;\n  state.onCallTimeout = onCallTimeout;\n  state.onIceCandidate = onIceCandidate;\n  state.onIceOffer = onIceOffer;\n  state.onIceAnswer = onIceAnswer;\n};\n\nconst handleCallMessage = (callMessage: RtcCallMessage) => {\n  console.log(callMessage);\n  switch (callMessage.callSignalType) {\n    case RtcCallSignalType.INITIATE:\n      console.log(\"call received from peer: \", callMessage.senderId);\n\n      try {\n        const callKey = callMessage.senderId + callMessage.startTime;\n        state.pendingIncomingCalls[callKey] = {\n          peerId: callMessage.senderId,\n          startTime: callMessage.startTime\n        };\n\n        setTimeout(() => {\n          const callValue = state.pendingIncomingCalls[callKey];\n\n          if (callValue) {\n            delete state.pendingIncomingCalls[callKey];\n            state.onCallTimeout(callValue.peerId, callValue.startTime);\n          }\n        }, DIALING_TIMEOUT_SECONDS * 1000);\n\n        state.onCallIncoming(callMessage.senderId, callMessage.startTime);\n      } catch (e) {\n        console.log(\"call incoming: error on incoming call: \", e);\n      }\n\n      break;\n    case RtcCallSignalType.ACCEPT:\n      console.log(\"call accepted by peer: \", callMessage.senderId);\n\n      try {\n        const callKey = callMessage.senderId + callMessage.startTime;\n        const callValue = state.pendingOutgoingCalls[callKey];\n\n        if (callValue) {\n          delete state.pendingOutgoingCalls[callKey];\n        }\n        state.onCallAccepted(callMessage.senderId, callMessage.startTime);\n      } catch (e) {\n        console.log(\"call accepted: error on accepted call: \", e);\n      }\n\n      break;\n    case RtcCallSignalType.END:\n      console.log(\"call ended by peer: \", callMessage.senderId);\n\n      try {\n        const callKey = callMessage.senderId + callMessage.startTime;\n        const callValueIncoming = state.pendingIncomingCalls[callKey];\n        const callValueOutgoing = state.pendingOutgoingCalls[callKey];\n\n        if (callValueIncoming) {\n          delete state.pendingIncomingCalls[callKey];\n        }\n\n        if (callValueOutgoing) {\n          delete state.pendingOutgoingCalls[callKey];\n        }\n\n        state.onCallEnded(callMessage.senderId, callMessage.startTime);\n      } catch (e) {\n        console.log(\"call ended: error on ended call: \", e);\n      }\n\n      break;\n  }\n};\n\nconst handleIceMessage = (iceMessage: RtcIceMessage) => {\n  switch (iceMessage.iceSignalType) {\n    case RtcIceSignalType.CANDIDATE:\n      console.log(\"candidate received from peer\", iceMessage.candidate);\n\n      try {\n        if (iceMessage.candidate || iceMessage.candidate === null) {\n          state.onIceCandidate(\n            iceMessage.senderId,\n            iceMessage.startTime,\n            iceMessage.candidate\n          );\n        } else {\n          console.log(\"candidate empty: \", iceMessage);\n        }\n      } catch (e) {\n        console.log(\"candidate: error setting ice candidate: \", e);\n      }\n\n      break;\n    case RtcIceSignalType.OFFER:\n      console.log(\"offer received from peer\", iceMessage.offer);\n\n      if (state.negotingOffer) {\n        // exit if already negotiating offer\n        return;\n      }\n\n      try {\n        if (iceMessage.offer) {\n          state.onIceOffer(\n            iceMessage.senderId,\n            iceMessage.startTime,\n            iceMessage.offer\n          );\n        } else {\n          console.log(\"offer empty: \", iceMessage);\n        }\n      } catch (e) {\n        console.log(\"candidate: error setting ice offer: \", e);\n      }\n\n      break;\n\n    case RtcIceSignalType.ANSWER:\n      console.log(\"answer received from peer\", iceMessage.answer);\n\n      try {\n        if (iceMessage.answer) {\n          state.onIceAnswer(\n            iceMessage.senderId,\n            iceMessage.startTime,\n            iceMessage.answer\n          );\n        } else {\n          console.log(\"answer empty: \", iceMessage);\n        }\n      } catch (e) {\n        console.log(\"candidate: error setting ice answer: \", e);\n      }\n\n      break;\n  }\n};\n\nconst dispatchSignalingMessage = async (message: Message) => {\n  console.log(\"message to pubnub\", message.channel, message.message);\n\n  if (state.dispatch) {\n    state.dispatch(sendPubnubMessage(message));\n  } else {\n    console.log(\n      \"rtc signaling missing dispatch, unable to dispatch: \",\n      message\n    );\n  }\n};\n\nconst callInit = async (myId: string, peerId: string, startTime: number) => {\n  const message: RtcCallMessage = {\n    type: MessageType.RtcCall,\n    callSignalType: RtcCallSignalType.INITIATE,\n    startTime,\n    senderId: myId\n  };\n\n  dispatchSignalingMessage({\n    channel: peerId,\n    message\n  });\n\n  const callKey = peerId + startTime;\n  state.pendingOutgoingCalls[callKey] = { peerId, startTime };\n\n  setTimeout(() => {\n    const callValue = state.pendingOutgoingCalls[callKey];\n\n    if (callValue) {\n      delete state.pendingOutgoingCalls[callKey];\n      state.onCallTimeout(callValue.peerId, callValue.startTime);\n    }\n  }, DIALING_TIMEOUT_SECONDS * 1000);\n};\n\nconst callAccept = async (myId: string, peerId: string, startTime: number) => {\n  const message: RtcCallMessage = {\n    type: MessageType.RtcCall,\n    callSignalType: RtcCallSignalType.ACCEPT,\n    startTime,\n    senderId: myId\n  };\n\n  dispatchSignalingMessage({\n    channel: peerId,\n    message\n  });\n\n  const callKey = peerId + startTime;\n  const callValue = state.pendingIncomingCalls[callKey];\n\n  if (callValue) {\n    delete state.pendingIncomingCalls[callKey];\n  }\n};\n\nconst callEnd = async (myId: string, peerId: string, startTime: number) => {\n  const message: RtcCallMessage = {\n    type: MessageType.RtcCall,\n    callSignalType: RtcCallSignalType.END,\n    startTime,\n    senderId: myId\n  };\n\n  dispatchSignalingMessage({\n    channel: peerId,\n    message\n  });\n\n  const callKey = peerId + startTime;\n  const callValue = state.pendingOutgoingCalls[callKey];\n\n  if (callValue) {\n    delete state.pendingOutgoingCalls[callKey];\n  }\n};\n\nconst iceCandidate = async (\n  myId: string,\n  peerId: string,\n  startTime: number,\n  candidate: RTCIceCandidate\n) => {\n  const message: RtcIceMessage = {\n    type: MessageType.RtcIce,\n    iceSignalType: RtcIceSignalType.CANDIDATE,\n    startTime,\n    senderId: myId,\n    candidate\n  };\n\n  dispatchSignalingMessage({\n    channel: peerId,\n    message\n  });\n};\n\nconst iceOffer = async (\n  myId: string,\n  peerId: string,\n  startTime: number,\n  offer: RTCSessionDescription\n) => {\n  const message: RtcIceMessage = {\n    type: MessageType.RtcIce,\n    iceSignalType: RtcIceSignalType.OFFER,\n    startTime,\n    senderId: myId,\n    offer\n  };\n\n  dispatchSignalingMessage({\n    channel: peerId,\n    message\n  });\n};\n\nconst iceAnswer = async (\n  myId: string,\n  peerId: string,\n  startTime: number,\n  answer: RTCSessionDescription\n) => {\n  const message: RtcIceMessage = {\n    type: MessageType.RtcIce,\n    iceSignalType: RtcIceSignalType.ANSWER,\n    startTime,\n    senderId: myId,\n    answer\n  };\n\n  dispatchSignalingMessage({\n    channel: peerId,\n    message\n  });\n};\n\nexport const signaling = {\n  init,\n  setHandlers,\n\n  // call signals\n  callInit,\n  callAccept,\n  callEnd,\n\n  // ice signals\n  iceCandidate,\n  iceOffer,\n  iceAnswer\n};\n","import React, { useContext, useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { usePubNub } from \"pubnub-react\";\nimport { CrossIcon } from \"foundations/components/icons/CrossIcon\";\nimport {\n  Wrapper,\n  VideoWrapper,\n  Header,\n  Body,\n  Title,\n  CloseButton,\n  MyVideo,\n  RemoteVideo,\n  LocalVideoWrapper,\n  RemoteVideoWrapper,\n  CallStatus\n} from \"./RtcDisplay.style\";\nimport { ThemeContext } from \"styled-components\";\nimport { getViewStates } from \"../../layout/Selectors\";\nimport { rtcViewHidden, rtcViewDisplayed } from \"../../layout/LayoutActions\";\nimport {\n  callCompleted,\n  callNotAnswered,\n  incomingCallReceived,\n  incomingCallAccepted,\n  outgoingCallAccepted,\n  getCurrentCall,\n  callCanceled,\n  callDeclined,\n  callConnected\n} from \"../RtcModel\";\nimport { RtcCallState } from \"../RtcCallState.enum\";\nimport { RtcCallType } from \"../RtcCallType.enum\";\nimport { getMessagesById } from \"../../messages/messageModel\";\nimport { getUsersById } from \"../../users/userModel\";\nimport { createSelector } from \"reselect\";\nimport { getLoggedInUserId } from \"../../authentication/authenticationModel\";\nimport {\n  connectMedia,\n  createIceOffer,\n  negotiateIceOffer,\n  createIceAnswer,\n  createPeerConnection,\n  disconnectMedia,\n  setRemoteDescription,\n  addIceCandidate,\n  setIceCandidateHandler,\n  setNegotiationNeededHandler,\n  setConnectionStateHandler,\n  setIceConnectionStateHandler,\n  setTrackHandler,\n  sendMedia\n} from \"../RtcConnection\";\nimport { signaling } from \"../RtcSignaling\";\n\nexport const getLastCallMessage = createSelector(\n  [getMessagesById, getLoggedInUserId, getUsersById],\n  (messages, userId, users): any => {\n    let userMessages = messages[userId]\n      ? Object.values(messages[userId])\n          .filter(message => message.channel === userId)\n          .map((message): any => {\n            return {\n              ...message.message,\n              timetoken: String(message.timetoken),\n              sender:\n                users[message.message.senderId] ||\n                (message.message.senderId\n                  ? {\n                      id: message.message.senderId,\n                      name: message.message.senderId\n                    }\n                  : {\n                      id: \"unknown\",\n                      name: \"unknown\"\n                    })\n            };\n          })\n      : [];\n\n    return userMessages.length > 0\n      ? userMessages[userMessages.length - 1]\n      : undefined;\n  }\n);\n\nconst RtcDisplay = () => {\n  const pubnub = usePubNub();\n  const dispatch = useDispatch();\n  const [video, setVideo] = useState(true);\n  const [audio, setAudio] = useState(true);\n  const [dialed, setDialed] = useState(false);\n  const [peerAnswered, setPeerAnswered] = useState(false);\n  const [incoming, setIncoming] = useState(false);\n  const [answered, setAnswered] = useState(false);\n  const currentCall = useSelector(getCurrentCall);\n  const lastCallMessage = useSelector(getLastCallMessage);\n  const views = useSelector(getViewStates);\n  const myId = useSelector(getLoggedInUserId);\n  const theme = useContext(ThemeContext);\n\n  const releaseMedia = async () => {\n    await disableLocalMedia();\n    await disableRemoteMedia();\n    await disconnectMedia();\n  };\n\n  const callPeer = async () => {\n    console.log(\"call peer: calling\", currentCall.peerUserId);\n    setDialed(true);\n\n    await releaseMedia();\n\n    // prompt current user for camera access\n    const mediaStream = await connectMedia({ audio, video });\n\n    if (video) {\n      if (document.querySelector(\"#myvideo\")) {\n        (document.querySelector(\"#myvideo\") as any).srcObject = mediaStream;\n      }\n    }\n\n    // send calling signal to peer\n    await signaling.callInit(\n      myId,\n      currentCall.peerUserId,\n      currentCall.startTime\n    );\n  };\n\n  const answerCall = async () => {\n    console.log(\"answer call\");\n    setAnswered(true);\n\n    await releaseMedia();\n\n    // prompt user for camera access\n    const mediaStream = await connectMedia({ audio, video });\n\n    if (video) {\n      if (document.querySelector(\"#myvideo\")) {\n        (document.querySelector(\"#myvideo\") as any).srcObject = mediaStream;\n      }\n    }\n\n    // update local store with accepted call information\n    dispatch(\n      incomingCallAccepted(lastCallMessage.sender.id, lastCallMessage.startTime)\n    );\n\n    await createPeerConnection();\n\n    console.log(\"answer: sending answer to peer\", lastCallMessage.sender.id);\n\n    signaling.callAccept(\n      myId,\n      lastCallMessage.sender.id,\n      lastCallMessage.startTime\n    );\n  };\n\n  const updateCallStatus = async (cancel?: boolean) => {\n    console.log(\"update call status from: \", currentCall.callState);\n\n    // update local store with completed call information\n    if (\n      currentCall.callState === RtcCallState.CONNECTED ||\n      currentCall.callState === RtcCallState.ACCEPTED\n    ) {\n      dispatch(\n        callCompleted(\n          currentCall.peerUserId,\n          currentCall.startTime,\n          new Date().getTime()\n        )\n      );\n    } else if (\n      currentCall.callState === RtcCallState.INITIATED ||\n      currentCall.callState === RtcCallState.RECEIVING\n    ) {\n      if (cancel) {\n        if (currentCall.callState === RtcCallState.INITIATED) {\n          dispatch(\n            callCanceled(\n              currentCall.peerUserId,\n              currentCall.startTime,\n              new Date().getTime()\n            )\n          );\n        } else {\n          dispatch(\n            callDeclined(\n              currentCall.peerUserId,\n              currentCall.startTime,\n              new Date().getTime()\n            )\n          );\n        }\n      } else {\n        dispatch(\n          callNotAnswered(\n            currentCall.peerUserId,\n            currentCall.startTime,\n            new Date().getTime()\n          )\n        );\n      }\n    }\n  };\n\n  const endCall = async () => {\n    console.log(\"end call\");\n\n    updateCallStatus(true);\n\n    console.log(\"end call: sending\", currentCall.peerUserId);\n\n    await signaling.callEnd(\n      myId,\n      currentCall.peerUserId,\n      currentCall.startTime\n    );\n\n    closeMedia();\n  };\n\n  const onCallIncoming = async (callerId: string, startTime: number) => {\n    console.log(\"incoming call: receiving call from peer\");\n    setIncoming(true);\n\n    // update local store with receiving call information\n    dispatch(incomingCallReceived(callerId, startTime));\n\n    // ensure the rtc view is displayed\n    dispatch(rtcViewDisplayed());\n  };\n\n  const onCallAccepted = async (callerId: string, startTime: number) => {\n    console.log(\"accepted: outgoing call accepted by peer\");\n    setPeerAnswered(true);\n\n    // update local store with call accepted status\n    dispatch(outgoingCallAccepted(callerId, startTime));\n\n    await createPeerConnection();\n\n    await sendMedia();\n\n    const offer = await createIceOffer();\n\n    if (offer) {\n      await signaling.iceOffer(\n        myId,\n        currentCall.peerUserId,\n        currentCall.startTime,\n        offer\n      );\n    } else {\n      console.log(\"accepted: unable to create ice offer\");\n    }\n  };\n\n  const onCallEnded = async (callerId: string, startTime: number) => {\n    console.log(\"ended: outgoing call ended by peer\");\n\n    // update local store with completed call information\n    if (\n      currentCall.peerUserId === callerId &&\n      currentCall.startTime === startTime\n    ) {\n      if (\n        currentCall.callType === RtcCallType.OUTGOING &&\n        currentCall.callState === RtcCallState.INITIATED\n      ) {\n        dispatch(\n          callDeclined(\n            currentCall.peerUserId,\n            currentCall.startTime,\n            new Date().getTime()\n          )\n        );\n      } else if (\n        currentCall.callType === RtcCallType.INCOMING &&\n        currentCall.callState === RtcCallState.RECEIVING\n      ) {\n        dispatch(\n          callCanceled(\n            currentCall.peerUserId,\n            currentCall.startTime,\n            new Date().getTime()\n          )\n        );\n      } else if (\n        currentCall.callState === RtcCallState.ACCEPTED ||\n        currentCall.callState === RtcCallState.CONNECTED\n      ) {\n        dispatch(\n          callCompleted(\n            currentCall.peerUserId,\n            currentCall.startTime,\n            new Date().getTime()\n          )\n        );\n      }\n\n      closeMedia();\n    }\n  };\n\n  const onIceCandidate = async (\n    callerId: string,\n    startTime: number,\n    candidate: RTCIceCandidate | null\n  ) => {\n    if (\n      currentCall.peerUserId === callerId &&\n      currentCall.startTime === startTime\n    ) {\n      if (candidate !== null) {\n        addIceCandidate(candidate);\n      }\n    }\n  };\n\n  const onIceOffer = async (\n    callerId: string,\n    startTime: number,\n    offer: RTCSessionDescription\n  ) => {\n    if (\n      currentCall.peerUserId === callerId &&\n      currentCall.startTime === startTime\n    ) {\n      setRemoteDescription(offer);\n\n      await sendMedia();\n\n      const answer = await createIceAnswer();\n\n      if (answer) {\n        if (answer) {\n          await signaling.iceAnswer(\n            myId,\n            currentCall.peerUserId,\n            currentCall.startTime,\n            answer\n          );\n        } else {\n          console.log(\"onIceOffer: unable to signal ice answer\");\n        }\n      } else {\n        console.log(\"onIceOffer: unable to create ice answer\");\n      }\n    }\n  };\n\n  const onIceAnswer = async (\n    callerId: string,\n    startTime: number,\n    answer: RTCSessionDescription\n  ) => {\n    if (\n      currentCall.peerUserId === callerId &&\n      currentCall.startTime === startTime\n    ) {\n      setRemoteDescription(answer);\n    }\n  };\n\n  const onCallTimeout = async () => {\n    if (currentCall.callType === RtcCallType.OUTGOING) {\n      console.log(\"outgoing call timed out\");\n      console.log(\"dialed\", dialed);\n      console.log(\"peer ansswered\", peerAnswered);\n      if (dialed && !peerAnswered) {\n        updateCallStatus();\n      }\n    } else {\n      setIncoming(false);\n      console.log(\"incoming call timed out\");\n      console.log(\"incoming\", incoming);\n      console.log(\"answered\", dialed);\n      if (incoming && !answered) {\n        updateCallStatus();\n      }\n    }\n  };\n\n  /**\n   * Initialize signaling\n   */\n  useEffect(() => {\n    signaling.init(pubnub, dispatch);\n  }, [pubnub, dispatch]);\n\n  const disableAudio = async () => {\n    return;\n  };\n\n  const disableVideo = async () => {\n    if (document.querySelector(\"#myvideo\")) {\n      (document.querySelector(\"#myvideo\") as any).srcObject &&\n        (document.querySelector(\"#myvideo\") as any).srcObject\n          .getTracks()\n          .forEach((track: MediaStreamTrack) => {\n            track.stop();\n          });\n\n      (document.querySelector(\"#myvideo\") as any).srcObject = undefined;\n    }\n  };\n\n  const disableLocalMedia = async () => {\n    await disableVideo();\n    await disableAudio();\n  };\n\n  const disableRemoteVideo = async () => {\n    if (document.querySelector(\"#remotevideo\")) {\n      (document.querySelector(\"#remotevideo\") as any).srcObject &&\n        (document.querySelector(\"#remotevideo\") as any).srcObject\n          .getTracks()\n          .forEach((track: MediaStreamTrack) => {\n            track.stop();\n          });\n\n      (document.querySelector(\"#remotevideo\") as any).srcObject = undefined;\n    }\n  };\n\n  const disableRemoteAudio = async () => {\n    if (document.querySelector(\"#remoteaudio\")) {\n      (document.querySelector(\"#remoteaudio\") as any).srcObject &&\n        (document.querySelector(\"#remoteaudio\") as any).srcObject\n          .getTracks()\n          .forEach((track: MediaStreamTrack) => {\n            track.stop();\n          });\n\n      (document.querySelector(\"#remoteaudio\") as any).srcObject = undefined;\n    }\n  };\n\n  const disableRemoteMedia = async () => {\n    await disableRemoteVideo();\n    await disableRemoteAudio();\n  };\n\n  const enableVideo = async (mediaConstraints: MediaStreamConstraints) => {\n    let stream = await connectMedia(mediaConstraints);\n\n    if (document.querySelector(\"#myvideo\")) {\n      (document.querySelector(\"#myvideo\") as any).srcObject = stream;\n    }\n  };\n\n  const enableAudio = async (mediaConstraints: MediaStreamConstraints) => {\n    await connectMedia(mediaConstraints);\n    return;\n  };\n\n  const updateMedia = async (mediaConstraints: MediaStreamConstraints) => {\n    await releaseMedia();\n\n    if (mediaConstraints.video) {\n      await enableVideo(mediaConstraints);\n    } else if (mediaConstraints.audio) {\n      await enableAudio(mediaConstraints);\n    } else {\n      await disableLocalMedia();\n    }\n  };\n\n  const toggleVideo = () => {\n    updateMedia({ audio, video: !video });\n    setVideo(!video);\n  };\n\n  const toggleAudio = () => {\n    updateMedia({ audio: !audio, video });\n    setAudio(!audio);\n  };\n\n  const closeMedia = async () => {\n    await releaseMedia();\n    setDialed(false);\n    setAnswered(false);\n    setIncoming(false);\n    setVideo(true);\n    setAudio(true);\n    stopRing();\n  };\n\n  const isDialing = () => {\n    return currentCall.callState === RtcCallState.INITIATED;\n  };\n\n  const isIncomingCall = () => {\n    return !isDialing() && currentCall.callState === RtcCallState.RECEIVING;\n  };\n\n  const closeCall = () => {\n    if (currentCall.callState === RtcCallState.INITIATED) {\n      dispatch(\n        callCompleted(\n          currentCall.peerUserId,\n          currentCall.startTime,\n          new Date().getTime()\n        )\n      );\n    }\n    endCall();\n    dispatch(rtcViewHidden());\n  };\n\n  const getStateDisplayString = () => {\n    if (currentCall.callState === RtcCallState.INITIATED) {\n      return \"Calling\";\n    } else if (currentCall.callState === RtcCallState.ACCEPTED) {\n      return \"Call Accepted\";\n    } else if (currentCall.callState === RtcCallState.RECEIVING) {\n      return \"Receiving Call\";\n    } else if (currentCall.callState === RtcCallState.CONNECTED) {\n      return \"Call Connected\";\n    } else if (currentCall.callState === RtcCallState.COMPLETED) {\n      return \"Call Completed\";\n    } else if (currentCall.callState === RtcCallState.CANCELED) {\n      return \"Call Canceled\";\n    } else if (currentCall.callState === RtcCallState.DECLINED) {\n      return \"Call Declined\";\n    } else if (\n      currentCall.callState === RtcCallState.NOT_ANSWERED &&\n      currentCall.callType === RtcCallType.INCOMING\n    ) {\n      return \"Call Missed\";\n    } else if (\n      currentCall.callState === RtcCallState.NOT_ANSWERED &&\n      currentCall.callType === RtcCallType.OUTGOING\n    ) {\n      return \"Call Not Answered\";\n    } else {\n      return \"Disconnected\";\n    }\n  };\n\n  const startRing = () => {\n    if (document.querySelector(\"#ring\")) {\n      (document.querySelector(\"#ring\") as any).play();\n    }\n  };\n\n  const stopRing = () => {\n    if (document.querySelector(\"#ring\")) {\n      (document.querySelector(\"#ring\") as any).pause();\n    }\n  };\n\n  if (incoming && currentCall.callState === RtcCallState.RECEIVING) {\n    startRing();\n  } else {\n    stopRing();\n  }\n\n  signaling.setHandlers(\n    onCallIncoming,\n    onCallAccepted,\n    onCallEnded,\n    onCallTimeout,\n    onIceCandidate,\n    onIceOffer,\n    onIceAnswer\n  );\n\n  setIceCandidateHandler((candidate: RTCIceCandidate | null) => {\n    console.log(\"ice candidate handler peer: \", currentCall.peerUserId);\n    if (candidate !== null) {\n      signaling.iceCandidate(\n        myId,\n        currentCall.peerUserId,\n        currentCall.startTime,\n        candidate\n      );\n    }\n  });\n\n  setNegotiationNeededHandler(async (event: Event) => {\n    console.log(\"negotiation needed: creating new offer\");\n    const offer = await negotiateIceOffer();\n\n    if (offer) {\n      await signaling.iceOffer(\n        myId,\n        currentCall.peerUserId,\n        currentCall.startTime,\n        offer\n      );\n    } else {\n      console.log(\"negotiation needed: unable to create ice offer\");\n    }\n  });\n\n  setTrackHandler((e: RTCTrackEvent) => {\n    const remoteVideo = document.querySelector(\"#remotevideo\") as any;\n    e.track.onunmute = () => {\n      if (remoteVideo.srcObject) {\n        return;\n      }\n      (document.querySelector(\"#remotevideo\") as any).srcObject = e.streams[0];\n    };\n  });\n\n  setConnectionStateHandler((state: RTCPeerConnectionState) => {\n    if (state === \"connected\") {\n      console.log(\"connected: rtc connection is established\");\n\n      // update local store with call connected status\n      dispatch(callConnected(currentCall.peerUserId, currentCall.startTime));\n    }\n  });\n\n  setIceConnectionStateHandler((state: RTCIceConnectionState) => {\n    if (state === \"disconnected\") {\n      console.log(\"disconnected: rtc ice connection is no longer stable\");\n\n      // update local store with call completed status\n      dispatch(\n        callCompleted(\n          currentCall.peerUserId,\n          currentCall.startTime,\n          new Date().getTime()\n        )\n      );\n\n      closeMedia();\n    }\n  });\n\n  if (\n    !dialed &&\n    !incoming &&\n    currentCall.callState === RtcCallState.INITIATED\n  ) {\n    callPeer();\n  }\n\n  // run this once\n  useEffect(() => {\n    let unlocked = false;\n    document.body.addEventListener(\"touchstart\", function() {\n      if (!unlocked && document.querySelector(\"#ring\")) {\n        unlocked = true;\n        const audioElem = document.querySelector(\"#ring\") as any;\n        audioElem.play();\n        audioElem.pause();\n        audioElem.currentTime = 0;\n      }\n    });\n    document.addEventListener(\"click\", function() {\n      if (!unlocked && document.querySelector(\"#ring\")) {\n        unlocked = true;\n        const audioElem = document.querySelector(\"#ring\") as any;\n        audioElem.play();\n        audioElem.pause();\n        audioElem.currentTime = 0;\n      }\n    });\n  }, []);\n\n  return (\n    <Wrapper displayed={views.Rtc}>\n      <Header>\n        <Title>Call</Title>\n        <CloseButton\n          onClick={() => {\n            closeCall();\n          }}\n        >\n          <CrossIcon color={theme.colors.normalText} title=\"close\" />\n        </CloseButton>\n      </Header>\n      <Body>\n        <button\n          disabled={\n            currentCall.callState !== RtcCallState.INITIATED &&\n            currentCall.callState !== RtcCallState.RECEIVING\n          }\n          onClick={toggleVideo}\n        >\n          Video ({video ? \"on\" : \"off\"})\n        </button>\n        <button\n          disabled={\n            currentCall.callState !== RtcCallState.INITIATED &&\n            currentCall.callState !== RtcCallState.RECEIVING\n          }\n          onClick={toggleAudio}\n        >\n          Audio ({audio ? \"on\" : \"off\"})\n        </button>\n        {(currentCall.callState === RtcCallState.INITIATED ||\n          currentCall.callState === RtcCallState.ACCEPTED ||\n          currentCall.callState === RtcCallState.RECEIVING ||\n          currentCall.callState === RtcCallState.CONNECTED) && (\n          <button onClick={endCall}>End Call</button>\n        )}\n        <VideoWrapper>\n          {isIncomingCall() && (\n            <div>\n              <div>&nbsp;</div>\n              <button onClick={answerCall}>Answer</button>\n            </div>\n          )}\n          <RemoteVideoWrapper>\n            <RemoteVideo\n              id=\"remotevideo\"\n              autoPlay={true}\n              playsInline={true}\n            ></RemoteVideo>\n            <audio id=\"remoteaudio\" autoPlay={true}></audio>\n          </RemoteVideoWrapper>\n          <LocalVideoWrapper>\n            <MyVideo\n              id=\"myvideo\"\n              autoPlay={true}\n              playsInline={true}\n              muted={true}\n            ></MyVideo>\n          </LocalVideoWrapper>\n        </VideoWrapper>\n        <audio id=\"ring\" src=\"/ring.wav\" preload=\"preload\" loop={true}></audio>\n      </Body>\n      <CallStatus>{getStateDisplayString()}</CallStatus>\n    </Wrapper>\n  );\n};\n\nexport { RtcDisplay };\n","import React from \"react\";\nimport { Wrapper } from \"./ChatUI.style\";\nimport { Menu } from \"features/chat/Menu/Menu\";\nimport { CurrentConversation } from \"features/currentConversation/CurrentConversation/CurrentConversation\";\nimport { ConversationMembers } from \"features/conversationMembers/ConversationMembers/ConversationMembers\";\nimport { JoinConversationDialog } from \"features/joinedConversations/JoinConversationDialog/JoinConversationDialog\";\nimport { UserDetailDialog } from \"features/userDetail/UserDetailDialog/UserDetailDialog\";\nimport { RtcDisplay } from \"features/rtc/RtcDisplay/RtcDisplay\";\n\nconst ChatUI = () => {\n  return (\n    <Wrapper>\n      <Menu />\n      <CurrentConversation />\n      <ConversationMembers />\n      <JoinConversationDialog />\n      <UserDetailDialog />\n      <RtcDisplay></RtcDisplay>\n    </Wrapper>\n  );\n};\n\nexport { ChatUI };\n","type PubNubConfigurationObject = {\n  publishKey: string;\n  subscribeKey: string;\n};\n\nconst isPubNubConfigured = (keyConfiguration: PubNubConfigurationObject) =>\n  keyConfiguration.publishKey.length !== 0 &&\n  keyConfiguration.subscribeKey.length !== 0;\n\nexport default isPubNubConfigured;\n","import styled from \"styled-components/macro\";\n\nexport const ErrorBanner = styled.div`\n  text-align: center;\n  justify-content: center;\n  display: flex;\n  padding: ${({ theme }) => theme.space[3]};\n  background-color: ${({ theme }) => theme.colors.error};\n  color: ${({ theme }) => theme.colors.activeText};\n`;\n","import React from \"react\";\n\nimport { Wrapper } from \"./style\";\nimport { Login } from \"features/authentication/Login/Login\";\nimport { ChatUI } from \"features/chat/Chat\";\nimport { isUserLoggedIn } from \"features/authentication/authenticationModel\";\nimport { useSelector } from \"react-redux\";\nimport keyConfiguration from \"config/pubnub-keys.json\";\nimport isPubNubConfigured from \"foundations/utilities/isPubNubConfigured\";\nimport { ErrorBanner } from \"main/styles/ErrorBanner.style\";\n\nconst ErrorBannerComponent = (\n  <ErrorBanner>\n    <div>\n      Please run <pre>npm setup</pre>\n    </div>\n  </ErrorBanner>\n);\n\nexport const ApplicationRouter = () => {\n  const loggedIn = useSelector(isUserLoggedIn);\n  const view = loggedIn ? <ChatUI /> : <Login />;\n  return (\n    <Wrapper>\n      {!isPubNubConfigured(keyConfiguration) && ErrorBannerComponent}\n      {view}\n    </Wrapper>\n  );\n};\n","// theme based on the system-ui specification https://github.com/system-ui/theme-specification\n\n/* breakpoints */\nconst breakpoints = [\"600px\", \"1200px\"] as const;\nconst mediaQueries = {\n  medium: `@media screen and (min-width: ${breakpoints[0]})`,\n  large: `@media screen and (min-width: ${breakpoints[1]})`,\n  touch: `@media (hover: none)`\n} as const;\nconst fonts = {\n  app: '\"Roboto\", sans-serif'\n} as const;\n/* fonts */\nconst fontSizes = [\"0px\", \"11px\", \"13px\", \"15px\", \"20px\", \"16px\"] as const;\nconst fontSizesAliases = {\n  none: fontSizes[0],\n  small: fontSizes[1],\n  regular: fontSizes[2],\n  medium: fontSizes[3],\n  large: fontSizes[4],\n  messageTextInput: fontSizes[5] // stop ios from zooming by setting font size to 16\n};\nconst fontWeights = [0, 300, 400, 500, 700, 900] as const;\nconst fontWeightsAliases = {\n  none: fontWeights[0],\n  light: fontWeights[1],\n  regular: fontWeights[2],\n  medium: fontWeights[3],\n  bold: fontWeights[4],\n  black: fontWeights[5]\n};\n/* colors */\nconst colors = {\n  error: \"#B63133\",\n  success: \"#62E905\",\n  inactive: \"#F5A623\",\n  primary: [\"#8E2DE2\", \"#4A00E0\"],\n  neutral: [\"#FFFFFF\", \"#F8F6FD\", \"#F1EDFD\", \"#9B9B9B\", \"#585858\"],\n  avatars: [\"#F7861C\", \"#35B7DF\", \"#DE2440\", \"#1F68EF\", \"#9F34C3\"]\n} as const;\nconst colorAliases = {\n  onPrimary: colors.neutral[0],\n  selectedText: \"rgba(0, 0, 0, 0.5)\",\n  active: colors.primary[0],\n  activeText: colors.neutral[0],\n  messageText: colors.neutral[4],\n  normalText: colors.neutral[3],\n  importantText: colors.neutral[4],\n  avatarText: colors.neutral[0],\n  borderLight: colors.neutral[2],\n  borderDark: colors.neutral[3]\n} as const;\n// backgrounds can be colors or gradients\nconst backgrounds = {\n  primary: `linear-gradient(180deg, ${colors.primary[0]} 0%, ${colors.primary[1]} 100%)`,\n  primaryHover: \"rgba(255, 255, 255, 0.1)\",\n  primaryActive: \"rgba(0, 0, 0, 0.1)\",\n  panel: colors.neutral[0],\n  panelHover: colors.neutral[1],\n  content: colors.neutral[1],\n  contentHover: colors.neutral[2],\n  message: colors.neutral[0]\n};\n/* space and sizes */\nconst sizes = [\"0\", \"36px\", \"56px\", \"85px\", \"260px\", \"290px\"] as const;\nconst space = [\n  \"0\",\n  \"10px\",\n  \"12px\",\n  \"14px\",\n  \"16px\",\n  \"21px\",\n  \"24px\",\n  \"32px\",\n  \"40px\"\n] as const;\n/* borders */\nconst radii = [\"0\", \"5px\", \"10px\", \"100vmax\"] as const;\nconst radiiAliases = {\n  square: radii[0],\n  light: radii[1],\n  messageEditor: radii[1],\n  medium: radii[2],\n  strong: radii[2],\n  round: radii[3]\n};\nconst borderWidths = [\"0\", \"1px\", \"5px\"] as const;\nconst borderStyles = [\"solid\"] as const;\nconst borders = [\n  \"none\",\n  `${borderWidths[1]} ${borderStyles[0]}`,\n  `${borderWidths[2]} ${borderStyles[0]}`\n] as const;\nconst bordersAliases = {\n  none: borders[0],\n  light: borders[1],\n  strong: borders[2]\n};\n/* other */\nconst shadows = [\n  \"0 6px 10px rgba(103, 19, 176, 0.06)\",\n  \"0 4px 30px rgba(0, 0, 0, 0.4)\"\n] as const;\nconst custom = {\n  dark: false,\n  companyName: \"PubNub\",\n  tagLine: \"World-Class APIs for In-App Chat\"\n} as const;\n\nexport const appTheme = {\n  breakpoints,\n  mediaQueries,\n  fonts,\n  fontSizes: { ...fontSizes, ...fontSizesAliases },\n  fontWeights: { ...fontWeights, ...fontWeightsAliases },\n  colors: { ...colors, ...colorAliases },\n  backgrounds,\n  sizes,\n  space,\n  radii: { ...radii, ...radiiAliases },\n  borderWidths,\n  borderStyles,\n  borders: { ...borders, ...bordersAliases },\n  shadows,\n  custom\n};\n\nexport type Theme = typeof appTheme;\n","import { createNetworkStatusReducer } from \"pubnub-redux\";\n\n/**\n * Create a reducer to hold the current online status of the user\n */\n\nconst NetworkStatusReducer = createNetworkStatusReducer(false);\nexport { NetworkStatusReducer };\n","import { combineReducers } from \"redux\";\n\nimport { currentConversationStateReducer } from \"features/currentConversation/currentConversationModel\";\nimport { LayoutStateReducer } from \"features/layout/LayoutReducer\";\nimport { UsersReducer } from \"features/users/userModel\";\nimport { AuthenticationStateReducer } from \"features/authentication/authenticationModel\";\nimport { MessageStateReducer } from \"features/messages/messageModel\";\nimport { TypingIndicatorStateReducer } from \"features/typingIndicator/typingIndicatorModel\";\nimport { conversationStateReducer } from \"features/conversations/conversationModel\";\nimport { JoinedConversationsStateReducer } from \"features/joinedConversations/joinedConversationModel\";\nimport { ConversationDraftStateReducer } from \"features/joinedConversations/DraftsModel\";\nimport { ConversationMembersStateReducer } from \"features/conversationMembers/conversationMemberModel\";\nimport { NetworkStatusReducer } from \"features/currentUser/networkStatusModel\";\nimport { MemberPresenceReducer } from \"features/memberPresence/memberPresenceModel\";\nimport { UserDetailStateReducer } from \"features/userDetail/userDetailModel\";\nimport { RtcStateReducer } from \"features/rtc/RtcModel\";\n\n/**\n * Combine all of the reducers in this application\n */\nconst rootReducer = combineReducers({\n  layout: LayoutStateReducer,\n  networkStatus: NetworkStatusReducer,\n  users: UsersReducer,\n  conversations: conversationStateReducer,\n  joinedConversations: JoinedConversationsStateReducer,\n  drafts: ConversationDraftStateReducer,\n  conversationMembers: ConversationMembersStateReducer,\n  memberPresence: MemberPresenceReducer,\n  messages: MessageStateReducer,\n  typingIndicators: TypingIndicatorStateReducer,\n  authentication: AuthenticationStateReducer,\n  currentConversation: currentConversationStateReducer,\n  userDetail: UserDetailStateReducer,\n  rtc: RtcStateReducer\n});\n\nexport default rootReducer;\n\n/**\n * RootState describes the shape of the global Redux store in this application\n */\nexport type RootState = Readonly<ReturnType<typeof rootReducer>>;\n","// Define built-in bootstrap data for this application\nconst preloadedState = {};\n\nexport default preloadedState;\n","import { createStore, applyMiddleware, compose } from \"redux\";\nimport ReduxThunk from \"redux-thunk\";\nimport rootReducer from \"./rootReducer\";\nimport { AppStore, AppThunkContext } from \"./storeTypes\";\nimport preloadedState from \"./preloadedState\";\n\n// Setup Redux Dev Tools\nexport const composeEnhancers =\n  (process.env.NODE_ENV === \"development\" &&\n    window &&\n    (window as any).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) ||\n  compose;\n\n// Note: we do not attempt to make the proper types by passing\n// types to the parameters of createStore.  The type definitions there are tricky\n// to work with and possibly buggy as of Redux 4.0.4.\n// Instead, we create a definition of the final store we want and declare the\n// CreateAppStore to return that type of store.\n\n/**\n * Create a redux store configured for this application\n */\nexport const createAppStore = (thunkContext: AppThunkContext): AppStore => {\n  const storeEnhancer = composeEnhancers(\n    applyMiddleware(ReduxThunk.withExtraArgument(thunkContext))\n  );\n\n  return createStore(rootReducer, preloadedState, storeEnhancer);\n};\n","import React, { useEffect } from \"react\";\nimport GlobalStyles from \"main/styles/GlobalStyles\";\nimport Normalize from \"main/styles/Normalize\";\nimport { ApplicationRouter } from \"./Router\";\nimport { appTheme } from \"./Theme\";\nimport Pubnub from \"pubnub\";\nimport { createPubNubListener } from \"pubnub-redux\";\nimport { PubNubProvider } from \"pubnub-react\";\nimport { Provider } from \"react-redux\";\nimport { createAppStore } from \"main/store\";\nimport keyConfiguration from \"config/pubnub-keys.json\";\nimport { ThemeProvider } from \"styled-components\";\nimport { createTypingIndicatorsListener } from \"features/typingIndicator/typingIndicatorModel\";\n\nconst pubnubConfig = Object.assign(\n  {},\n  {\n    // Ensure that subscriptions will be retained if the network connection is lost\n    restore: true,\n    heartbeatInterval: 0\n  },\n  keyConfiguration\n);\nconst pubnub = new Pubnub(pubnubConfig);\n\nconst store = createAppStore({\n  pubnub: {\n    api: pubnub\n  }\n});\n\nconst leaveApplication = () => {\n  // This is required to show the current user leave immediately rather than\n  // wating for the timeout period\n  pubnub.unsubscribeAll();\n};\n\nconst App = () => {\n  useEffect(() => {\n    // Start listening for messages and events from PubNub\n    pubnub.addListener(createPubNubListener(store.dispatch));\n    pubnub.addListener(createTypingIndicatorsListener(store.dispatch));\n    return leaveApplication;\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener(\"beforeunload\", leaveApplication);\n  }, []);\n\n  return (\n    <ThemeProvider theme={appTheme}>\n      <Provider store={store}>\n        <PubNubProvider client={pubnub}>\n          <Normalize />\n          <GlobalStyles />\n          <ApplicationRouter />\n        </PubNubProvider>\n      </Provider>\n    </ThemeProvider>\n  );\n};\n\nexport { App };\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf(\"javascript\") === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        \"No internet connection found. App is running in offline mode.\"\n      );\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { App } from \"./main/App\";\nimport * as serviceWorker from \"./main/serviceWorker\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","module.exports = __webpack_public_path__ + \"static/media/background.fcad69ea.png\";","module.exports = __webpack_public_path__ + \"static/media/logo.85dc561e.svg\";","module.exports = __webpack_public_path__ + \"static/media/screenshot.547f1a66.png\";"],"sourceRoot":""}